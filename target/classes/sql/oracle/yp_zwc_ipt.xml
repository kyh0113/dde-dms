<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="oracle.yp_zwc_ipt">

<select id="select_zwc_ipt_performance" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_zwc_ipt_performance */
SELECT
	A.BASE_YYYY,
	A.VENDOR_CODE,
	( SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR( S.CODE, 1, 1 ) = 'V' AND S.CODE = A.VENDOR_CODE ) AS VENDOR_NAME,
	A.DEPT_CODE,
	A.DEPT_NAME,
	A.CONTRACT_CODE,
	A.CONTRACT_NAME,
	A.GUBUN_CODE,
	(SELECT S.CODE_NM FROM COM_CODE_DETAIL S WHERE S.CODE = 'YP_SUBC_GUBUN' AND S.CODE_VALUE = A.GUBUN_CODE) AS GUBUN_NAME,
	A.UNIT_CODE,
	( SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR( S.CODE, 1, 1 ) = 'U' AND S.CODE = A.UNIT_CODE ) AS UNIT_NAME,
	DECODE( A.GUBUN_CODE, '1', C.ADJUST_QUANTITY, '2', C.ADJUST_MAN_QTY, '3', C.ADJUST_QUANTITY ) AS A_QTY, /* 물량(1), 저장품(3): 물량, 인력(2): 공수 */
	( SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR( S.CODE, 1, 1 ) = 'U' AND S.CODE = A.UNIT_CODE ) AS A_UNIT_NAME,
	C.ADJUST_UNIT_PRICE AS A_UNIT_PRICE,
	B.ADJUST_SUBCONTRACTING_COST AS A_AMOUNT,
	CASE
		WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE != 'U7' THEN NVL( D.MONTH_STANDARD_AMOUNT, 0 )
		WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE = 'U7' THEN NVL( D.MANHOUR, 0 )
		ELSE NVL( D.QUANTITY_CHANGED, NVL( D.QUANTITY, 0 ) )
	END AS M_QTY,
	( SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR( S.CODE, 1, 1 ) = 'U' AND S.CODE = A.UNIT_CODE ) AS M_UNIT_NAME,
	D.UNIT_PRICE AS M_UNIT_PRICE,
	D.PAY_AMOUNT AS M_AMOUNT,
	D.PAY_AMOUNT - B.ADJUST_SUBCONTRACTING_COST AS M_DIFF,
	NVL( E.ADJUST_SUBCONTRACTING_COST, 0 ) AS CA_AMOUNT,
	CASE
		WHEN F.GUBUN_CODE = '2' AND F.UNIT_CODE != 'U7' THEN NVL( F.MONTH_STANDARD_AMOUNT, 0 )
		WHEN F.GUBUN_CODE = '2' AND F.UNIT_CODE = 'U7' THEN NVL( F.MANHOUR, 0 )
		ELSE NVL( F.QUANTITY, 0 )
	END AS CM_QTY,
	NVL( ( SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR( S.CODE, 1, 1 ) = 'U' AND S.CODE = F.UNIT_CODE ), '-' ) AS CM_UNIT_NAME,
	NVL( F.UNIT_PRICE, 0 ) AS CM_UNIT_PRICE,
	NVL( F.PAY_AMOUNT, 0 ) AS CM_AMOUNT,
	NVL( F.PAY_AMOUNT, 0 ) - NVL( E.ADJUST_SUBCONTRACTING_COST, 0 ) AS CM_DIFF,
	D.PAY_AMOUNT - NVL( F.PAY_AMOUNT, 0 ) AS CT_DIFF
FROM TBL_WORKING_SUBC A
INNER JOIN (
	SELECT
		B.BASE_YYYY, B.VENDOR_CODE, SUBSTR(B.CONTRACT_CODE, 1, 5) AS CONTRACT_CODE,
		SUM( B.ADJUST_SUBCONTRACTING_COST ) AS ADJUST_SUBCONTRACTING_COST /* 월도급비 */
	FROM TBL_WORKING_SUBC_COST_ADJUST B /* 도급비조정안 */
	WHERE 1=1
	GROUP BY
		B.BASE_YYYY, B.VENDOR_CODE, SUBSTR(B.CONTRACT_CODE, 1, 5)
) B /* 도급비조정안 월도급비 수당포함 합계 */
	ON A.BASE_YYYY = B.BASE_YYYY
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND B.BASE_YYYY = SUBSTR( REPLACE( #{SEARCH_YYYYMM}, '/', '' ), 1, 4 )
INNER JOIN (
	SELECT
		C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE,
		SUM( C.ADJUST_MAN_QTY ) AS ADJUST_MAN_QTY, /* 공수 */
		SUM( C.ADJUST_QUANTITY ) AS ADJUST_QUANTITY, /* 물량 */
		SUM( C.ADJUST_UNIT_PRICE ) AS ADJUST_UNIT_PRICE /* 단가 */
	FROM TBL_WORKING_SUBC_COST_ADJUST C /* 도급비조정안 */
	WHERE 1=1
	GROUP BY
		C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
) C /* 도급비조정안 기준( 공수, 물량 ), 단가 수당미포함 합계 */
	ON A.BASE_YYYY = C.BASE_YYYY
	AND A.VENDOR_CODE = C.VENDOR_CODE
	AND A.CONTRACT_CODE = C.CONTRACT_CODE
	AND C.BASE_YYYY = SUBSTR( REPLACE( #{SEARCH_YYYYMM}, '/', '' ), 1, 4 )
INNER JOIN TBL_WORKING_MONTHLY_REPORT D /* 도급월보 집계 */
	ON A.BASE_YYYY = D.BASE_YYYY
	AND A.VENDOR_CODE = D.VENDOR_CODE
	AND A.CONTRACT_CODE = D.CONTRACT_CODE
	AND D.CHECK_YYYYMM = SUBSTR( REPLACE( #{SEARCH_YYYYMM}, '/', '' ), 1, 6 )
LEFT OUTER JOIN (
	SELECT
		SUBSTR( REPLACE( #{SEARCH_YYYYMM}, '/', '' ), 1, 4 ) AS BASE_YYYY,
		E.VENDOR_CODE, SUBSTR(E.CONTRACT_CODE, 1, 5) AS CONTRACT_CODE,
		SUM( E.ADJUST_SUBCONTRACTING_COST ) AS ADJUST_SUBCONTRACTING_COST /* 월도급비 */
	FROM TBL_WORKING_SUBC_COST_ADJUST E /* 도급비조정안( 비교 ) */
	WHERE 1=1
	AND E.BASE_YYYY = SUBSTR( REPLACE( #{COMPARE_YYYYMM}, '/', '' ), 1, 4 )
	GROUP BY
		E.BASE_YYYY, E.VENDOR_CODE, SUBSTR(E.CONTRACT_CODE, 1, 5)
) E /* 도급비조정안( 비교 ) 월도급비 수당포함 합계 */
	ON A.BASE_YYYY = E.BASE_YYYY
	AND A.VENDOR_CODE = E.VENDOR_CODE
	AND A.CONTRACT_CODE = E.CONTRACT_CODE
LEFT OUTER JOIN (
	SELECT
		SUBSTR( REPLACE( #{SEARCH_YYYYMM}, '/', '' ), 1, 4 ) AS BASE_YYYY,
		F1.VENDOR_CODE,
		F1.CONTRACT_CODE,
		F1.GUBUN_CODE,
		F1.UNIT_CODE,
		F2.MONTH_STANDARD_AMOUNT,
		F2.MANHOUR,
		NVL( F2.QUANTITY_CHANGED, F2.QUANTITY ) AS QUANTITY,
		F2.UNIT_PRICE,
		F2.PAY_AMOUNT
	FROM TBL_WORKING_SUBC F1
	INNER JOIN TBL_WORKING_MONTHLY_REPORT F2
		ON F1.BASE_YYYY = F2.BASE_YYYY
		AND F1.VENDOR_CODE = F2.VENDOR_CODE
		AND F1.CONTRACT_CODE = F2.CONTRACT_CODE
		AND F2.CHECK_YYYYMM = SUBSTR( REPLACE( #{COMPARE_YYYYMM}, '/', '' ), 1, 6 )
) F /* 도급월보 집계( 비교 ) */
	ON A.BASE_YYYY = F.BASE_YYYY
	AND A.VENDOR_CODE = F.VENDOR_CODE
	AND A.CONTRACT_CODE = F.CONTRACT_CODE
WHERE 1=1
<if test="VENDOR_CODE != null">
AND A.VENDOR_CODE = #{VENDOR_CODE}
</if>
<if test="DEPT_CODE != null">
AND A.DEPT_CODE = #{DEPT_CODE}
</if>
AND A.BASE_YYYY = SUBSTR( REPLACE( #{SEARCH_YYYYMM}, '/', '' ), 1, 4 )
ORDER BY
	A.VENDOR_CODE, A.CONTRACT_CODE
</select>

<select id="select_tbl_working_daily_monitor_cnt" resultType="double">
/* oracle.yp_zwc_ipt.select_tbl_working_daily_monitor_cnt */
WITH CAL AS
	(
		SELECT
			TO_CHAR( TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +( ROWNUM -1 ), 'YYYYMMDD' ) AS BASE_YYYYMMDD
		FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]>( TO_DATE( REPLACE( #{BASE_YYYY_E}, '/', '' ), 'YYYYMMDD' ) - TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +1 )
	)
	,
	CAL_T AS
	(
		SELECT
			COUNT( TO_CHAR( TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +( ROWNUM -1 ), 'YYYYMMDD' ) ) AS BASE_YYYYMMDD
		FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]>( TO_DATE( REPLACE( #{BASE_YYYY_E}, '/', '' ), 'YYYYMMDD' ) - TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +1 )
	)
SELECT
	COUNT(*)
FROM TBL_WORKING_SUBC M
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT( CAL.BASE_YYYYMMDD ) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON  CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.GUBUN = '1' /* 휴일 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M1 /* 도급일보 근무형태 [휴일]로 저장된 건수 */
	ON  M.BASE_YYYY = M1.BASE_YYYY
	AND M.VENDOR_CODE = M1.VENDOR_CODE
	AND M.CONTRACT_CODE = M1.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT( CAL.BASE_YYYYMMDD ) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON  CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.GUBUN = '0' /* 근무 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M2 /* 도급일보 근무형태 [근무]로 저장된 건수 */
	ON  M.BASE_YYYY = M2.BASE_YYYY
	AND M.VENDOR_CODE = M2.VENDOR_CODE
	AND M.CONTRACT_CODE = M2.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY,
			A.VENDOR_CODE,
			A.CONTRACT_CODE,
			COUNT( A.BASE_YYYYMMDD ) AS CNT
		FROM TBL_WORKING_DAILY_REPORT_DT A
		WHERE 1 = 1
		AND NVL( A.MANHOUR, 0 ) + NVL( A.COLLECTION_MANHOUR, 0 ) > 0 /* 실공수 > 0 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M3 /* 도급일보상세 공수, 보정공수가 존재하는 건수 */
	ON  M.BASE_YYYY = M3.BASE_YYYY
	AND M.VENDOR_CODE = M3.VENDOR_CODE
	AND M.CONTRACT_CODE = M3.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY,
			A.VENDOR_CODE,
			A.CONTRACT_CODE,
			COUNT( A.BASE_YYYYMMDD ) AS CNT
		FROM TBL_WORKING_DAILY_REPORT_DT A
		WHERE 1 = 1
		AND NVL( A.MANHOUR, 0 ) + NVL( A.COLLECTION_MANHOUR, 0 ) > 0 /* 실공수 > 0 */
		AND NVL( A.WORKLOAD, 0 ) > 0 /* 작업량 입력완료 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M4 /* 도급일보상세 공수, 보정공수가 존재하고, 작업량 입력완료 건수 */
	ON  M.BASE_YYYY = M4.BASE_YYYY
	AND M.VENDOR_CODE = M4.VENDOR_CODE
	AND M.CONTRACT_CODE = M4.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT(CAL.BASE_YYYYMMDD) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M5 /* 도급일보 저장된 건수 */
	ON  M.BASE_YYYY = M5.BASE_YYYY
	AND M.VENDOR_CODE = M5.VENDOR_CODE
	AND M.CONTRACT_CODE = M5.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT(CAL.BASE_YYYYMMDD) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.TEAM_LEADER_CONFIRM = 'Y'
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M6 /* 도급일보 팀장승인 건수 */
	ON  M.BASE_YYYY = M6.BASE_YYYY
	AND M.VENDOR_CODE = M6.VENDOR_CODE
	AND M.CONTRACT_CODE = M6.CONTRACT_CODE
WHERE 1 = 1
AND M.BASE_YYYY BETWEEN SUBSTR( REPLACE( #{BASE_YYYY_S}, '/', '' ), 1, 4 ) AND SUBSTR( REPLACE( #{BASE_YYYY_E}, '/', '' ), 1, 4 )
	<if test="DEPT_CODE != null">
AND M.DEPT_CODE = #{DEPT_CODE}
	</if>
ORDER BY
	M.BASE_YYYY, M.VENDOR_CODE, M.CONTRACT_CODE
</select>

<select id="select_tbl_working_daily_monitor" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_tbl_working_daily_monitor */
WITH CAL AS
	(
		SELECT
			TO_CHAR( TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +( ROWNUM -1 ), 'YYYYMMDD' ) AS BASE_YYYYMMDD
		FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]>( TO_DATE( REPLACE( #{BASE_YYYY_E}, '/', '' ), 'YYYYMMDD' ) - TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +1 )
	)
	,
	CAL_T AS
	(
		SELECT
			COUNT( TO_CHAR( TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +( ROWNUM -1 ), 'YYYYMMDD' ) ) AS BASE_YYYYMMDD
		FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]>( TO_DATE( REPLACE( #{BASE_YYYY_E}, '/', '' ), 'YYYYMMDD' ) - TO_DATE( REPLACE( #{BASE_YYYY_S}, '/', '' ), 'YYYYMMDD' ) +1 )
	)
SELECT
	M.BASE_YYYY,
	M.VENDOR_CODE,
	M.CONTRACT_CODE,
	M.CONTRACT_NAME,
	M.DEPT_CODE,
	M.DEPT_NAME,
	( SELECT S.BASE_YYYYMMDD FROM CAL_T S ) - NVL( M1.CNT, 0 ) AS INPUT_TARGET,
	/* 입력대상 = 조회범위일수 - 도급일보 근무형태 휴일 건수 */
	NVL( M2.CNT, 0 ) AS INPUT_CNT,
	CASE
		WHEN ( ( SELECT S.BASE_YYYYMMDD FROM CAL_T S ) - NVL( M1.CNT, 0 ) ) = 0 THEN 0
		ELSE ROUND( NVL( M2.CNT, 0 ) / ( ( SELECT S.BASE_YYYYMMDD FROM CAL_T S ) - NVL( M1.CNT, 0 ) ) * 100, 0 )
	END AS INPUT_RATE,
	NVL( M3.CNT, 0 ) AS WORK_INPUT_TARGET,
	NVL( M4.CNT, 0 ) AS WORK_INPUT_CNT,
	DECODE( NVL( M3.CNT, 0 ), 0, 0, ROUND( NVL( M4.CNT, 0 ) / NVL( M3.CNT, 0 ) * 100, 0 ) ) AS WORK_INPUT_RATE,
	CASE
		WHEN TO_DATE( #{BASE_YYYY_E} ) - TO_DATE( #{BASE_YYYY_S} ) >= 0 THEN ROUND( NVL( M6.CNT, 0 ) / ( TO_DATE( #{BASE_YYYY_E} ) - TO_DATE( #{BASE_YYYY_S} ) + 1 ) * 100, 0 )
		ELSE 0
	END AS TEAM_LEADER_CONFIRM_RATE
FROM TBL_WORKING_SUBC M
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT( CAL.BASE_YYYYMMDD ) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON  CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.GUBUN = '1' /* 휴일 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M1 /* 도급일보 근무형태 [휴일]로 저장된 건수 */
	ON  M.BASE_YYYY = M1.BASE_YYYY
	AND M.VENDOR_CODE = M1.VENDOR_CODE
	AND M.CONTRACT_CODE = M1.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT( CAL.BASE_YYYYMMDD ) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON  CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.GUBUN = '0' /* 근무 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M2 /* 도급일보 근무형태 [근무]로 저장된 건수 */
	ON  M.BASE_YYYY = M2.BASE_YYYY
	AND M.VENDOR_CODE = M2.VENDOR_CODE
	AND M.CONTRACT_CODE = M2.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY,
			A.VENDOR_CODE,
			A.CONTRACT_CODE,
			COUNT( A.BASE_YYYYMMDD ) AS CNT
		FROM TBL_WORKING_DAILY_REPORT_DT A
		WHERE 1 = 1
		AND NVL( A.MANHOUR, 0 ) + NVL( A.COLLECTION_MANHOUR, 0 ) > 0 /* 실공수 > 0 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M3 /* 도급일보상세 공수, 보정공수가 존재하는 건수 */
	ON  M.BASE_YYYY = M3.BASE_YYYY
	AND M.VENDOR_CODE = M3.VENDOR_CODE
	AND M.CONTRACT_CODE = M3.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY,
			A.VENDOR_CODE,
			A.CONTRACT_CODE,
			COUNT( A.BASE_YYYYMMDD ) AS CNT
		FROM TBL_WORKING_DAILY_REPORT_DT A
		WHERE 1 = 1
		AND NVL( A.MANHOUR, 0 ) + NVL( A.COLLECTION_MANHOUR, 0 ) > 0 /* 실공수 > 0 */
		AND NVL( A.WORKLOAD, 0 ) > 0 /* 작업량 입력완료 */
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M4 /* 도급일보상세 공수, 보정공수가 존재하고, 작업량 입력완료 건수 */
	ON  M.BASE_YYYY = M4.BASE_YYYY
	AND M.VENDOR_CODE = M4.VENDOR_CODE
	AND M.CONTRACT_CODE = M4.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT(CAL.BASE_YYYYMMDD) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M5 /* 도급일보 저장된 건수 */
	ON  M.BASE_YYYY = M5.BASE_YYYY
	AND M.VENDOR_CODE = M5.VENDOR_CODE
	AND M.CONTRACT_CODE = M5.CONTRACT_CODE
LEFT OUTER JOIN
	(
		SELECT
			A.BASE_YYYY AS BASE_YYYY,
			A.VENDOR_CODE AS VENDOR_CODE,
			A.CONTRACT_CODE AS CONTRACT_CODE,
			COUNT(CAL.BASE_YYYYMMDD) AS CNT
		FROM CAL
		INNER JOIN TBL_WORKING_DAILY_REPORT A
			ON CAL.BASE_YYYYMMDD = A.BASE_YYYYMMDD
		WHERE 1 = 1
		AND A.TEAM_LEADER_CONFIRM = 'Y'
		AND A.BASE_YYYYMMDD BETWEEN REPLACE( #{BASE_YYYY_S}, '/', '' ) AND REPLACE( #{BASE_YYYY_E}, '/', '' )
		GROUP BY
			A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE
	) M6 /* 도급일보 팀장승인 건수 */
	ON  M.BASE_YYYY = M6.BASE_YYYY
	AND M.VENDOR_CODE = M6.VENDOR_CODE
	AND M.CONTRACT_CODE = M6.CONTRACT_CODE
WHERE 1 = 1
AND M.BASE_YYYY BETWEEN SUBSTR( REPLACE( #{BASE_YYYY_S}, '/', '' ), 1, 4 ) AND SUBSTR( REPLACE( #{BASE_YYYY_E}, '/', '' ), 1, 4 )
	<if test="DEPT_CODE != null">
AND M.DEPT_CODE = #{DEPT_CODE}
	</if>
ORDER BY
	M.BASE_YYYY, M.VENDOR_CODE, M.CONTRACT_CODE
</select>

<select id="zwc_ipt_sum_list_check_a" resultType="HashMap">
/* oracle.yp_zwc_ipt.zwc_ipt_sum_list_check_a - 도급비집계 전자결재 가능여부(모든 도급월보 결재완료 되었는지 확인) */
/* 2020-11-23 jamerl - 조용래 : 결재상태 "F"도 완료로 취급 */
SELECT
	COUNT(*) AS COUNT_TOTAL,
	NVL(SUM(CASE WHEN A.STATUS = 'F' THEN 1 WHEN A.STATUS = 'S' THEN 1 ELSE 0 END), 0) AS COUNT_OK, /* 가능 : 결재완료 */
	NVL(SUM(CASE WHEN A.STATUS != 'F' AND A.STATUS != 'S' AND A.STATUS IS NULL THEN 1 ELSE 0 END), 0) AS COUNT_NO
FROM TBL_WORKING_MONTHLY_REPORT A
INNER JOIN TBL_WORKING_SUBC B
	ON A.BASE_YYYY = B.BASE_YYYY
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND CASE B.GUBUN_CODE
		WHEN '1' THEN '1' 
		WHEN '2' THEN '1' 
		WHEN '3' THEN '0' 
		ELSE 'X' 
	END = #{GUBUN_CODE}
WHERE 1=1
AND A.CHECK_YYYYMM = REPLACE(#{CHECK_YYYYMM}, '/', '')
</select>

<select id="zwc_ipt_sum_list_check_b" resultType="HashMap">
/* oracle.yp_zwc_ipt.zwc_ipt_sum_list_check_b - 도급비집계 전자결재 가능여부(도급비집계 전자결재 상태 확인) */
SELECT
	COUNT(*) AS COUNT_TOTAL,
	NVL(SUM(CASE WHEN NVL(A.STATUS, 'X') = 'X' OR A.STATUS = '5' OR A.STATUS = '7' THEN 1 ELSE 0 END), 0) AS COUNT_OK, /* 가능 : 결재상태 없거나 반려 */
	NVL(SUM(CASE WHEN NVL(A.STATUS, 'X') != 'X' AND A.STATUS != '5' AND A.STATUS != '7' THEN 1 ELSE 0 END), 0) AS COUNT_NO
FROM TBL_WORKING_SUBC_COST_COUNT A
WHERE 1=1
AND A.GUBUN_CODE = #{GUBUN_CODE}
-- 2021-01-06 jamerl - 도급비집계시 저장품, 비저장품의 구분코드는 1, 0으로 들어가 있기때문에 조회조건 변경
/*
AND CASE A.GUBUN_CODE
	WHEN '1' THEN '1' 
	WHEN '2' THEN '1' 
	WHEN '3' THEN '0' 
	ELSE 'X' 
END = ${GUBUN_CODE}
*/
AND A.CHECK_YYYYMM = REPLACE(#{CHECK_YYYYMM}, '/', '')
</select>

<select id="zwc_ipt_mon_create_check" resultType="HashMap">
/* oracle.yp_zwc_ipt.zwc_ipt_mon_create_check - 도급월보 전자결재 가능여부 */
SELECT
	COUNT(*) AS COUNT_TOTAL,
	NVL(SUM(CASE WHEN NVL(Z.STATUS, 'X') = 'X' OR Z.STATUS = '5' OR Z.STATUS = '7' THEN 1 ELSE 0 END), 0) AS COUNT_OK, /* 가능 : 결재상태 없거나 반려 */
	NVL(SUM(CASE WHEN NVL(Z.STATUS, 'X') != 'X' AND Z.STATUS != '5' AND Z.STATUS != '7' THEN 1 ELSE 0 END), 0) AS COUNT_NO
FROM TBL_WORKING_SUBC A /* 계약 */
LEFT OUTER JOIN TBL_WORKING_MONTHLY_REPORT Z
	ON A.BASE_YYYY = Z.BASE_YYYY
	AND A.VENDOR_CODE = Z.VENDOR_CODE
	AND A.CONTRACT_CODE = Z.CONTRACT_CODE
	AND Z.CHECK_YYYYMM = #{BASE_YYYY}
WHERE 1=1
AND A.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4) -- 조회조건 시작일자 4자리 잘라서 사용
AND A.DEPT_CODE = #{DEPT_CODE}
</select>

<select id="zwc_rpt_post_intervention_check" resultType="HashMap">
/* oracle.yp_zwc_ipt.zwc_rpt_post_intervention_check - 도급계약 조정(안) 전자결재 가능여부 */
SELECT
	COUNT(*) AS COUNT_TOTAL,
	NVL(SUM(CASE WHEN NVL(A.STATUS, 'X') = 'X' OR A.STATUS = '5' OR A.STATUS = '7' THEN 1 ELSE 0 END), 0) AS COUNT_OK, /* 가능 : 결재상태 없거나 반려 */
	NVL(SUM(CASE WHEN NVL(A.STATUS, 'X') != 'X' AND A.STATUS != '5' AND A.STATUS != '7' THEN 1 ELSE 0 END), 0) AS COUNT_NO
FROM TBL_WORKING_SUBC_PST_ADJ A
WHERE 1=1
AND A.BASE_YYYY = #{BASE_YYYY}
</select>

<select id="zwc_rst_summary_list_check" resultType="HashMap">
/* oracle.yp_zwc_ipt.zwc_rst_summary_list_check - 소급비집계 전자결재 가능여부 */
SELECT
	COUNT(*) AS COUNT_TOTAL,
	NVL(SUM(CASE WHEN NVL(A.STATUS, 'X') = 'X' OR A.STATUS = '5' OR A.STATUS = '7' THEN 1 ELSE 0 END), 0) AS COUNT_OK, /* 가능 : 결재상태 없거나 반려 */
	NVL(SUM(CASE WHEN NVL(A.STATUS, 'X') != 'X' AND A.STATUS != '5' AND A.STATUS != '7' THEN 1 ELSE 0 END), 0) AS COUNT_NO
FROM TBL_WORKING_RETO_COST_COUNT A
WHERE 1=1
AND CASE A.GUBUN_CODE
	WHEN '1' THEN '1' 
	WHEN '2' THEN '1' 
	WHEN '3' THEN '0' 
	ELSE 'X' 
END = #{GUBUN_CODE}
AND A.CHECK_YYYY = #{CHECK_YYYY}
</select>

<delete id="zwc_ipt_sum_create_delete">
	/* oracle.yp_zwc_ipt.zwc_ipt_sum_create_delete */
	DELETE TBL_WORKING_SUBC_COST_COUNT
	WHERE CHECK_YYYYMM = #{BASE_YYYYMM}
</delete>

<insert id="zwc_ipt_sum_create_exec">
	/* oracle.yp_zwc_ipt.zwc_ipt_sum_create_exec */
	INSERT INTO TBL_WORKING_SUBC_COST_COUNT
	(CHECK_YYYYMM, VENDOR_CODE, GUBUN_CODE, AMOUNT1, AMOUNT2, AMOUNT3, SUB_TOTAL, VAT, TOTAL, SAVE_MONEY_AMOUNT, PAY_AMOUNT, LAST_MONTH_SUBCONTRACTING_COST, VARIATION, MAN_MONTH, REG_EMP, REG_DATE)
	SELECT 
	      F.CHECK_YYYYMM, 
		--F.BASE_YYYY, 
		  F.VENDOR_CODE, 
		  F.GUBUN_CODE, 
		  F.AMOUNT1, 
		  F.AMOUNT2,   
		  F.AMOUNT3, 
		  F.SUB_TOTAL, 
		  F.VAT, 
		  F.TOTAL, 
		--F.SAVE_MONEY_AMOUNT, /* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
		  F.SAVE_MONEY_AMOUNT2, /* 분할입금액 */
		--F.PAY_AMOUNT, /* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
		  F.TOTAL - F.SAVE_MONEY_AMOUNT2 AS PAY_AMOUNT, 
		--NVL(G.PAY_AMOUNT,0) AS LAST_MONTH_SUBCONTRACTING_COST, /* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
		  NVL(G.SUB_TOTAL,0) AS LMONTH_SUBCONTRACTING_COST2, /* 전월 소계 */
		--F.PAY_AMOUNT - NVL(G.PAY_AMOUNT,0) AS VARIATION, /* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
		  F.SUB_TOTAL - NVL(G.SUB_TOTAL,0) AS VARIATION2,  /* 증감 : 소계 - 전월 소계 */
	      F.MANHOUR,
	      #{s_emp_code},
		  SYSDATE
	FROM 
	(
		SELECT 
			D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.GUBUN_CODE, D.AMOUNT1, D.AMOUNT2,	D.AMOUNT3,
			CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2
				 ELSE  D.AMOUNT3 END AS SUB_TOTAL,  --소계
			CASE WHEN D.GUBUN_CODE = '1' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
				 ELSE ROUND(D.AMOUNT3*0.1,0) END AS VAT,  --부가세
			CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
				 ELSE D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) END AS TOTAL,  --합계
			CASE WHEN D.GUBUN_CODE = '1' THEN 
				 CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH1 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH2 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH3 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH4 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH5 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH6 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH7 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH8 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH9 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH10 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH11 / 100,0)
				  ELSE ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH12 / 100,0) END
			 ELSE 
			 	  CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH1 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH2 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH3 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH4 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH5 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH6 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH7 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH8 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH9 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH10 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH11 / 100,0) 
				  ELSE ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH12 / 100,0)  END
			 END AS SAVE_MONEY_AMOUNT, --분할입금액
			 CASE WHEN D.GUBUN_CODE = '1' THEN 
				 CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH1 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH2 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH3 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH4 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH5 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH6 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH7 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH8 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH9 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH10 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH11 / 100,0)
				  ELSE D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) - ROUND((D.AMOUNT1 + D.AMOUNT2 + (D.AMOUNT1 + D.AMOUNT2)*0.1 )* E.MONTH12 / 100,0) END
			 ELSE 
			 	  CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH1 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH2 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH3 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH4 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH5 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH6 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH7 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH8 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH9 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH10 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH11 / 100,0) 
				  ELSE D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) - ROUND((D.AMOUNT3 + (D.AMOUNT3*0.1)) * E.MONTH12 / 100,0)  END
			 END AS PAY_AMOUNT, --지급액
			/* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
			-- 변경 후
			CASE WHEN D.GUBUN_CODE = '1' THEN 
			 CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH1 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH2 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH3 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH4 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH5 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH6 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH7 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH8 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH9 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH10 / 100,0)
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH11 / 100,0)
			  ELSE ROUND((D.AMOUNT1 + D.AMOUNT2 )* E.MONTH12 / 100,0) END
			 ELSE 
			   CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN ROUND((D.AMOUNT3) * E.MONTH1 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN ROUND((D.AMOUNT3) * E.MONTH2 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN ROUND((D.AMOUNT3) * E.MONTH3 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN ROUND((D.AMOUNT3) * E.MONTH4 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN ROUND((D.AMOUNT3) * E.MONTH5 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN ROUND((D.AMOUNT3) * E.MONTH6 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN ROUND((D.AMOUNT3) * E.MONTH7 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN ROUND((D.AMOUNT3) * E.MONTH8 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN ROUND((D.AMOUNT3) * E.MONTH9 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN ROUND((D.AMOUNT3) * E.MONTH10 / 100,0) 
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN ROUND((D.AMOUNT3) * E.MONTH11 / 100,0) 
			  ELSE ROUND((D.AMOUNT3) * E.MONTH12 / 100,0)  END
			 END AS SAVE_MONEY_AMOUNT2, --분할입금액
			 D.MANHOUR
		FROM
		(
			-- 저장품이 아닌경우
			SELECT 
				C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3, SUM(C.MANHOUR) AS MANHOUR
			FROM 
			(
				SELECT 
					A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE,
					CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
					CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2,  --당월물량관리
					A.MANHOUR  --공수
				FROM TBL_WORKING_MONTHLY_REPORT A
				LEFT OUTER JOIN TBL_WORKING_SUBC B
				ON  A.BASE_YYYY     = B.BASE_YYYY 
         		AND A.VENDOR_CODE   = B.VENDOR_CODE 
         		AND A.CONTRACT_CODE = B.CONTRACT_CODE 
				WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
	            AND B.GUBUN_CODE != '3'
			) C
			GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE
			UNION ALL
			-- 저장품인 경우
			SELECT 
				C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3, SUM(C.MANHOUR) AS MANHOUR
			FROM 
			(
				SELECT 
					A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE,
					A.PAY_AMOUNT AS AMOUNT3, --저장품
					A.MANHOUR  --공수
				FROM TBL_WORKING_MONTHLY_REPORT A
				LEFT OUTER JOIN TBL_WORKING_SUBC B
				ON  A.BASE_YYYY     = B.BASE_YYYY 
         		AND A.VENDOR_CODE   = B.VENDOR_CODE 
         		AND A.CONTRACT_CODE = B.CONTRACT_CODE 
				WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
	            AND B.GUBUN_CODE = '3'
			) C
			GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE
		) D LEFT OUTER JOIN 
		(
			SELECT
			    BASE_YYYY, VENDOR_CODE,	MONTH1, MONTH2, MONTH3, MONTH4, MONTH5, MONTH6, MONTH7, MONTH8, MONTH9, MONTH10, MONTH11, MONTH12
			FROM TBL_WORKING_SAVE_MONEY_COST
			WHERE BASE_YYYY = SUBSTR(#{BASE_YYYYMM},1,4)  -- 입력파라메터 (4자리 컷)
		) E
		ON D.BASE_YYYY = E.BASE_YYYY
		AND D.VENDOR_CODE = E.VENDOR_CODE
	) F 
	LEFT OUTER JOIN 
	(
		SELECT 
			D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.GUBUN_CODE,
			 CASE WHEN D.GUBUN_CODE = '1' THEN 
				 CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH1 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH2 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH3/ 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH4 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH5 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH6 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH7 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH8 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH9 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH10 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH11 / 100,0)
				  ELSE D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) + ROUND(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2)*0.1,0) * E.MONTH12 / 100,0) END
			 ELSE 
			 	  CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH1 / 100,0) 
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH2 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH3/ 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH4 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH5 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH6 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH7 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH8 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH9 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH10 / 100,0)
				      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH11 / 100,0)
				  ELSE D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) + ROUND(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) * E.MONTH12 / 100,0) END
			 END AS PAY_AMOUNT --지급액
			/* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
			-- 추가
			,
			CASE WHEN D.GUBUN_CODE = '1' THEN 
			 CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN D.AMOUNT1 + D.AMOUNT2
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN D.AMOUNT1 + D.AMOUNT2
			  ELSE D.AMOUNT1 + D.AMOUNT2 END
			 ELSE 
			   CASE WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '01' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '02' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '03' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '04' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '05' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '06' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '07' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '08' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '09' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '10' THEN D.AMOUNT3
			      WHEN SUBSTR(D.CHECK_YYYYMM,5,6) = '11' THEN D.AMOUNT3
			  ELSE D.AMOUNT3 END
			 END AS SUB_TOTAL --전월 소계
		FROM
		(
			-- 저장품이 아닌경우
			SELECT 
				C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3
			FROM 
			(
				SELECT 
					#{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM}, 1, 4) AS BASE_YYYY, A.VENDOR_CODE,
					CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
					CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2  --당월물량관리
				FROM TBL_WORKING_MONTHLY_REPORT A
				LEFT OUTER JOIN TBL_WORKING_SUBC B
				ON  A.BASE_YYYY     = B.BASE_YYYY 
         		AND A.VENDOR_CODE   = B.VENDOR_CODE 
         		AND A.CONTRACT_CODE = B.CONTRACT_CODE 
				WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터
			) C
			GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE
			UNION ALL
			-- 저장품인 경우
			SELECT 
				C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3
			FROM 
			(
				SELECT 
					#{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM}, 1, 4) AS BASE_YYYY, A.VENDOR_CODE,
					CASE WHEN B.GUBUN_CODE ='3' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT3  --당월물량관리
				FROM TBL_WORKING_MONTHLY_REPORT A
				LEFT OUTER JOIN TBL_WORKING_SUBC B
				ON  A.BASE_YYYY     = B.BASE_YYYY 
         		AND A.VENDOR_CODE   = B.VENDOR_CODE 
         		AND A.CONTRACT_CODE = B.CONTRACT_CODE 
				WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터
			) C
			GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE
		) D LEFT OUTER JOIN 
		(
			SELECT
			    SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, VENDOR_CODE,	MONTH1, MONTH2, MONTH3, MONTH4, MONTH5, MONTH6, MONTH7, MONTH8, MONTH9, MONTH10, MONTH11, MONTH12
			FROM TBL_WORKING_SAVE_MONEY_COST
			WHERE BASE_YYYY = SUBSTR(#{PREV_YYYYMM},1,4)  -- 입력파라메터 (4자리 컷)
		) E
		ON  D.BASE_YYYY   = E.BASE_YYYY
		AND D.VENDOR_CODE = E.VENDOR_CODE
	) G
	ON  F.CHECK_YYYYMM = G.CHECK_YYYYMM
	AND F.BASE_YYYY    = G.BASE_YYYY
	AND F.VENDOR_CODE  = G.VENDOR_CODE
	AND F.GUBUN_CODE   = G.GUBUN_CODE
</insert>

<select id="select_subc_cost_count_cnt" resultType="double">
/* oracle.yp_zwc_ipt.select_subc_cost_count_cnt */
SELECT 
    count(*) AS cnt
FROM TBL_WORKING_SUBC_COST_COUNT A
LEFT OUTER JOIN TBL_WORKING_MASTER B
ON A.VENDOR_CODE = B.CODE
WHERE 1=1
AND CHECK_YYYYMM =  #{check_yyyymm}
AND GUBUN_CODE = #{GUBUN_CODE}
</select>


<select id="select_subc_cost_count" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_subc_cost_count */
SELECT 
    CHECK_YYYYMM,
    A.VENDOR_CODE,
    B.CODE_NAME AS VENDOR_NAME,
    B.REPRESENTATIVE AS REPRESENTATIVE,
    GUBUN_CODE,
    AMOUNT1,
    AMOUNT2,
    AMOUNT3,
    SUB_TOTAL,
    VAT,
    TOTAL,
    SAVE_MONEY_AMOUNT,
    PAY_AMOUNT,
    LAST_MONTH_SUBCONTRACTING_COST,
    VARIATION,
    MAN_MONTH,
    SLIP_NUMBER,
    STATUS,
    F_GETCODENAME('YP_APPR_STATUS', STATUS) AS STATUS_TXT,
    B.SAP_CODE,
    A.BUDAT
FROM TBL_WORKING_SUBC_COST_COUNT A
LEFT OUTER JOIN TBL_WORKING_MASTER B
ON A.VENDOR_CODE = B.CODE
WHERE 1=1
AND CHECK_YYYYMM = REPLACE(#{check_yyyymm}, '/', '')
AND GUBUN_CODE   = #{GUBUN_CODE}
</select>

<select id="select_zwc_ipt_detail_list_dt_cnt" resultType="double">
/* oracle.yp_zwc_ipt.select_zwc_ipt_detail_list_dt_cnt */
SELECT 
   COUNT(*) AS CNT
FROM
(
   -- 저장품이 아닌경우
   SELECT 
      C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST
   FROM 
   (
      SELECT 
         A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, B.DEPT_NAME,
         CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
         CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2,  --당월물량관리
         C.ADJUST_SUBCONTRACTING_COST 
      FROM TBL_WORKING_MONTHLY_REPORT A
      LEFT OUTER JOIN TBL_WORKING_SUBC B
      ON A.BASE_YYYY = B.BASE_YYYY 
      AND A.VENDOR_CODE = B.VENDOR_CODE 
      AND A.CONTRACT_CODE = B.CONTRACT_CODE 
      LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
      ON A.BASE_YYYY = C.BASE_YYYY 
      AND A.VENDOR_CODE = C.VENDOR_CODE 
      AND A.CONTRACT_CODE = C.CONTRACT_CODE  
      WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
      AND A.VENDOR_CODE = #{VENDOR_CODE}
      AND B.GUBUN_CODE !='3'
   ) C
   GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
   UNION ALL
   -- 저장품인 경우
   SELECT 
      C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST
   FROM 
   (
      SELECT 
         A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.DEPT_NAME, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3, C.ADJUST_SUBCONTRACTING_COST --당월물량관리
      FROM TBL_WORKING_MONTHLY_REPORT A
      LEFT OUTER JOIN TBL_WORKING_SUBC B
      ON A.BASE_YYYY = B.BASE_YYYY 
      AND A.VENDOR_CODE = B.VENDOR_CODE 
      AND A.CONTRACT_CODE = B.CONTRACT_CODE 
      LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
      ON A.BASE_YYYY = C.BASE_YYYY 
      AND A.VENDOR_CODE = C.VENDOR_CODE 
      AND A.CONTRACT_CODE = C.CONTRACT_CODE 
      WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
      AND A.VENDOR_CODE = #{VENDOR_CODE}
      AND B.GUBUN_CODE ='3'
   ) C
   GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
) D LEFT OUTER JOIN 
(
   SELECT 
      E.CHECK_YYYYMM, E.BASE_YYYY, E.VENDOR_CODE, E.GUBUN_CODE, E.CONTRACT_CODE, E.CONTRACT_NAME, E.AMOUNT1 AS P_AMOUNT1, E.AMOUNT2 AS P_AMOUNT2, E.AMOUNT3 AS P_AMOUNT3,
      CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2
          ELSE  E.AMOUNT3 END AS P_SUB_TOTAL,  --소계
      CASE WHEN E.GUBUN_CODE = '1' THEN ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
          ELSE ROUND(E.AMOUNT3*0.1,0) END AS P_VAT,  --부가세
      CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2 + ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
          ELSE E.AMOUNT3 + ROUND(E.AMOUNT3*0.1,0) END AS P_TOTAL
   FROM
   (
      -- 저장품이 아닌경우
      SELECT 
         C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3
      FROM 
      (
         SELECT 
            #{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME,
            CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
            CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2  --당월물량관리
         FROM TBL_WORKING_MONTHLY_REPORT A
         LEFT OUTER JOIN TBL_WORKING_SUBC B
         ON A.BASE_YYYY = B.BASE_YYYY 
         AND A.VENDOR_CODE = B.VENDOR_CODE 
         AND A.CONTRACT_CODE = B.CONTRACT_CODE 
         WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
         AND A.VENDOR_CODE = #{VENDOR_CODE}
         AND B.GUBUN_CODE !='3'
      ) C
      GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
      UNION ALL
      -- 저장품인 경우
      SELECT 
         C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3
      FROM 
      (
         SELECT 
            #{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3 --당월물량관리
         FROM TBL_WORKING_MONTHLY_REPORT A
         LEFT OUTER JOIN TBL_WORKING_SUBC B
         ON A.BASE_YYYY = B.BASE_YYYY 
         AND A.VENDOR_CODE = B.VENDOR_CODE 
         AND A.CONTRACT_CODE = B.CONTRACT_CODE 
         WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
         AND A.VENDOR_CODE = #{VENDOR_CODE}
         AND B.GUBUN_CODE ='3'
      ) C
      GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
   ) E
) F 
ON D.CHECK_YYYYMM   = F.CHECK_YYYYMM
AND D.BASE_YYYY     = F.BASE_YYYY
AND D.VENDOR_CODE   = F.VENDOR_CODE
AND D.CONTRACT_CODE = F.CONTRACT_CODE
WHERE 1=1
AND D.GUBUN_CODE = #{GUBUN_CODE}
</select>

<select id="select_zwc_ipt_detail_list_dt" resultType="java.util.LinkedHashMap">
/* oracle.yp_zwc_ipt.select_zwc_ipt_detail_list_dt */
SELECT
	RANK() OVER(ORDER BY D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.CONTRACT_CODE) AS RNO,
	(	SELECT S.STATUS
		FROM TBL_WORKING_MONTHLY_REPORT S
		WHERE S.CHECK_YYYYMM = D.CHECK_YYYYMM
		AND S.BASE_YYYY = D.BASE_YYYY
		AND S.VENDOR_CODE = D.VENDOR_CODE
		AND S.CONTRACT_CODE = D.CONTRACT_CODE
	) AS STATUS,
	(	SELECT F_GETCODENAME('YP_APPR_STATUS', S.STATUS) AS STATUS_TXT
		FROM TBL_WORKING_MONTHLY_REPORT S
		WHERE S.CHECK_YYYYMM = D.CHECK_YYYYMM
		AND S.BASE_YYYY = D.BASE_YYYY
		AND S.VENDOR_CODE = D.VENDOR_CODE
		AND S.CONTRACT_CODE = D.CONTRACT_CODE
	) AS STATUS_TXT,
   D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.GUBUN_CODE, D.DEPT_NAME, D.CONTRACT_CODE, D.CONTRACT_NAME, D.AMOUNT1, D.AMOUNT2, D.AMOUNT3,
   CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2
       ELSE  D.AMOUNT3 END AS SUB_TOTAL,  --소계
   CASE WHEN D.GUBUN_CODE = '1' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
       ELSE ROUND(D.AMOUNT3*0.1,0) END AS VAT,  --부가세
   D.ADJUST_SUBCONTRACTING_COST,
   CASE
		WHEN D.GUBUN_CODE = '1'
			THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
		ELSE
			D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0)
	END AS TOTAL, -- 사용안됨
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN D.AMOUNT1 + D.AMOUNT2
		ELSE
			D.AMOUNT3
	END - D.ADJUST_SUBCONTRACTING_COST AS DIFF,
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2,0)
		ELSE
			NVL(D.AMOUNT3,0)
	END AS P_TOTAL,
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN D.AMOUNT1 + D.AMOUNT2
		ELSE
			D.AMOUNT3
	END -
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2,0)
		ELSE
			NVL(D.AMOUNT3,0)
	END AS VARIATION,
	/* 2021-03-10 jamerl - 조용래 : 물량, 전월물량, 물량증감 표시 요청 */
	D.QUANTITY,
	NVL(F.QUANTITY, 0) AS P_QUANTITY,
	D.QUANTITY - NVL(F.QUANTITY, 0) AS QUANTITY_VARIATION
	/* 2020-11-23 jamerl - 조용래 : 도급비는 소계로 표시해달라고 요청, 관계된 부분 수정
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0)
		ELSE
			D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0)
	END - D.ADJUST_SUBCONTRACTING_COST AS DIFF,
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2 + ROUND((F.P_AMOUNT1 + F.P_AMOUNT2 )*0.1,0),0)
		ELSE
			D.AMOUNT3 + ROUND(F.P_AMOUNT3*0.1,0)
	END AS P_TOTAL,
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN NVL(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0),0)
		ELSE
			NVL(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0),0)
	END - 
	CASE
		WHEN D.GUBUN_CODE = '1'
			THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2 + ROUND((F.P_AMOUNT1 + F.P_AMOUNT2 )*0.1,0),0)
		ELSE
			NVL(D.AMOUNT3 + ROUND(F.P_AMOUNT3*0.1,0),0)
	END AS VARIATION
	*/
FROM
(
   -- 저장품이 아닌경우
   SELECT 
      C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST,
		SUM( C.QUANTITY ) AS QUANTITY
   FROM 
   (
      SELECT 
         A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, B.DEPT_NAME,
         CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
         CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2,  --당월물량관리
         C.ADJUST_SUBCONTRACTING_COST,
			NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
      FROM TBL_WORKING_MONTHLY_REPORT A
      LEFT OUTER JOIN TBL_WORKING_SUBC B
      ON A.BASE_YYYY = B.BASE_YYYY 
      AND A.VENDOR_CODE = B.VENDOR_CODE 
      AND A.CONTRACT_CODE = B.CONTRACT_CODE 
      LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
      ON A.BASE_YYYY = C.BASE_YYYY 
      AND A.VENDOR_CODE = C.VENDOR_CODE 
      AND A.CONTRACT_CODE = C.CONTRACT_CODE  
      WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
      AND A.VENDOR_CODE = #{VENDOR_CODE}
      AND B.GUBUN_CODE !='3'
   ) C
   GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
   UNION ALL
   -- 저장품인 경우
   SELECT 
      C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST,
		SUM( C.QUANTITY ) AS QUANTITY
   FROM 
   (
      SELECT 
         A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.DEPT_NAME, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3, C.ADJUST_SUBCONTRACTING_COST /* 당월물량관리 */,
			NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
      FROM TBL_WORKING_MONTHLY_REPORT A
      LEFT OUTER JOIN TBL_WORKING_SUBC B
      ON A.BASE_YYYY = B.BASE_YYYY 
      AND A.VENDOR_CODE = B.VENDOR_CODE 
      AND A.CONTRACT_CODE = B.CONTRACT_CODE 
      LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
      ON A.BASE_YYYY = C.BASE_YYYY 
      AND A.VENDOR_CODE = C.VENDOR_CODE 
      AND A.CONTRACT_CODE = C.CONTRACT_CODE 
      WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
      AND A.VENDOR_CODE = #{VENDOR_CODE}
      AND B.GUBUN_CODE ='3'
   ) C
   GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
) D LEFT OUTER JOIN 
(
   SELECT 
      E.CHECK_YYYYMM, E.BASE_YYYY, E.VENDOR_CODE, E.GUBUN_CODE, E.CONTRACT_CODE, E.CONTRACT_NAME, E.AMOUNT1 AS P_AMOUNT1, E.AMOUNT2 AS P_AMOUNT2, E.AMOUNT3 AS P_AMOUNT3,
      CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2
          ELSE  E.AMOUNT3 END AS P_SUB_TOTAL,  --소계
      CASE WHEN E.GUBUN_CODE = '1' THEN ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
          ELSE ROUND(E.AMOUNT3*0.1,0) END AS P_VAT,  --부가세
      CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2 + ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
          ELSE E.AMOUNT3 + ROUND(E.AMOUNT3*0.1,0) END AS P_TOTAL,
		E.QUANTITY
   FROM
   (
      -- 저장품이 아닌경우
      SELECT 
         C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3,
			SUM( C.QUANTITY ) AS QUANTITY
      FROM 
      (
         SELECT 
            #{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME,
            CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  /* 당월협력업체(인력) */
            CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2  /* 당월물량관리 */,
				NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
         FROM TBL_WORKING_MONTHLY_REPORT A
         LEFT OUTER JOIN TBL_WORKING_SUBC B
         ON A.BASE_YYYY = B.BASE_YYYY 
         AND A.VENDOR_CODE = B.VENDOR_CODE 
         AND A.CONTRACT_CODE = B.CONTRACT_CODE 
         WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
         AND A.VENDOR_CODE = #{VENDOR_CODE}
         AND B.GUBUN_CODE !='3'
      ) C
      GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
      UNION ALL
      -- 저장품인 경우
      SELECT 
         C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3,
			SUM( C.QUANTITY ) AS QUANTITY
      FROM 
      (
         SELECT 
            #{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3 /* 당월물량관리 */,
				NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
         FROM TBL_WORKING_MONTHLY_REPORT A
         LEFT OUTER JOIN TBL_WORKING_SUBC B
         ON A.BASE_YYYY = B.BASE_YYYY 
         AND A.VENDOR_CODE = B.VENDOR_CODE 
         AND A.CONTRACT_CODE = B.CONTRACT_CODE 
         WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
         AND A.VENDOR_CODE = #{VENDOR_CODE}
         AND B.GUBUN_CODE ='3'
      ) C
      GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
   ) E
) F 
ON D.CHECK_YYYYMM   = F.CHECK_YYYYMM
AND D.BASE_YYYY     = F.BASE_YYYY
AND D.VENDOR_CODE   = F.VENDOR_CODE
AND D.CONTRACT_CODE = F.CONTRACT_CODE
WHERE 1=1
AND D.GUBUN_CODE = #{GUBUN_CODE}
</select>

<select id="select_zwc_ipt_detail_list" resultType="java.util.LinkedHashMap">
/* oracle.yp_zwc_ipt.select_zwc_ipt_detail_list */
	SELECT 
		RANK() OVER(ORDER BY D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.CONTRACT_CODE) AS RNO,
		(	SELECT S.STATUS
			FROM TBL_WORKING_MONTHLY_REPORT S
			WHERE S.CHECK_YYYYMM = D.CHECK_YYYYMM
			AND S.BASE_YYYY = D.BASE_YYYY
			AND S.VENDOR_CODE = D.VENDOR_CODE
			AND S.CONTRACT_CODE = D.CONTRACT_CODE
		) AS STATUS,
		(	SELECT F_GETCODENAME('YP_APPR_STATUS', S.STATUS) AS STATUS_TXT
			FROM TBL_WORKING_MONTHLY_REPORT S
			WHERE S.CHECK_YYYYMM = D.CHECK_YYYYMM
			AND S.BASE_YYYY = D.BASE_YYYY
			AND S.VENDOR_CODE = D.VENDOR_CODE
			AND S.CONTRACT_CODE = D.CONTRACT_CODE
		) AS STATUS_TXT,
		D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.GUBUN_CODE, D.DEPT_NAME, D.CONTRACT_CODE, D.CONTRACT_NAME, D.AMOUNT1, D.AMOUNT2, D.AMOUNT3,
		CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2
			 ELSE  D.AMOUNT3 END AS SUB_TOTAL,  --소계
		CASE WHEN D.GUBUN_CODE = '1' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
			 ELSE ROUND(D.AMOUNT3*0.1,0) END AS VAT,  --부가세
		D.ADJUST_SUBCONTRACTING_COST,
		CASE
			WHEN D.GUBUN_CODE = '1'
				THEN D.AMOUNT1 + D.AMOUNT2
			ELSE
				D.AMOUNT3
		END - D.ADJUST_SUBCONTRACTING_COST AS DIFF,
		/* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
		/*
		-- 변경 전
		CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
			 ELSE D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) END AS TOTAL,
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2 + ROUND((F.P_AMOUNT1 + F.P_AMOUNT2 )*0.1,0),0) 
			 ELSE D.AMOUNT3 + ROUND(F.P_AMOUNT3*0.1,0) END AS P_TOTAL,
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0),0) 
			 ELSE NVL(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0),0) END - 
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2 + ROUND((F.P_AMOUNT1 + F.P_AMOUNT2 )*0.1,0),0) 
			 ELSE NVL(D.AMOUNT3 + ROUND(F.P_AMOUNT3*0.1,0),0) END AS VARIATION
		*/
		/* 2021-01-06 jamerl - 조용래 : 도급비 집계표 수정 요청 건 */
		-- 변경 후
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(D.AMOUNT1 + D.AMOUNT2,0)
		 ELSE NVL(D.AMOUNT3,0)
		END AS TOTAL, /* 도급비 */
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2,0) 
		 ELSE NVL(F.P_AMOUNT3,0)
		END AS P_TOTAL, /* 전월 소계 */
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(D.AMOUNT1 + D.AMOUNT2,0)
		 ELSE NVL(D.AMOUNT3,0) END - 
		CASE WHEN D.GUBUN_CODE = '1' THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2,0) 
		 ELSE NVL(D.AMOUNT3,0)
		END AS VARIATION /* 소계 - 전월 소계*/,
		/* 2021-03-10 jamerl - 조용래 : 물량, 전월물량, 물량증감 표시 요청 */
		D.QUANTITY,
		NVL(F.QUANTITY, 0) AS P_QUANTITY,
		D.QUANTITY - NVL(F.QUANTITY, 0) AS QUANTITY_VARIATION
	FROM
	(
		-- 저장품이 아닌경우
		SELECT 
			C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3
			, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST, SUM( C.QUANTITY ) AS QUANTITY
		FROM 
		(
			SELECT 
				A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, B.DEPT_NAME,
				CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
				CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2  --당월물량관리
				, NVL( C.ADJUST_SUBCONTRACTING_COST, 0) AS ADJUST_SUBCONTRACTING_COST, NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
			FROM TBL_WORKING_MONTHLY_REPORT A
			LEFT OUTER JOIN TBL_WORKING_SUBC B
			ON A.BASE_YYYY = B.BASE_YYYY 
			AND A.VENDOR_CODE = B.VENDOR_CODE 
			AND A.CONTRACT_CODE = B.CONTRACT_CODE
			LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
				ON A.BASE_YYYY = C.BASE_YYYY 
				AND A.VENDOR_CODE = C.VENDOR_CODE 
				AND A.CONTRACT_CODE = C.CONTRACT_CODE
			WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
			AND A.VENDOR_CODE = #{VENDOR_CODE}
			AND B.GUBUN_CODE !='3'
		) C
		GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
		UNION ALL
		-- 저장품인 경우
		SELECT 
			C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3
			, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST, SUM( C.QUANTITY ) AS QUANTITY
		FROM 
		(
			SELECT 
				A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.DEPT_NAME, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3 --당월물량관리
				, NVL( C.ADJUST_SUBCONTRACTING_COST, 0) AS ADJUST_SUBCONTRACTING_COST, NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
			FROM TBL_WORKING_MONTHLY_REPORT A
			LEFT OUTER JOIN TBL_WORKING_SUBC B
			ON A.BASE_YYYY = B.BASE_YYYY 
			AND A.VENDOR_CODE = B.VENDOR_CODE 
			AND A.CONTRACT_CODE = B.CONTRACT_CODE
			LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
				ON A.BASE_YYYY = C.BASE_YYYY 
				AND A.VENDOR_CODE = C.VENDOR_CODE 
				AND A.CONTRACT_CODE = C.CONTRACT_CODE 
			WHERE A.CHECK_YYYYMM = #{BASE_YYYYMM}  -- 입력파라메터
			AND A.VENDOR_CODE = #{VENDOR_CODE}
			AND B.GUBUN_CODE ='3'
		) C
		GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
	) D LEFT OUTER JOIN 
	(
		SELECT 
			E.CHECK_YYYYMM, E.BASE_YYYY, E.VENDOR_CODE, E.GUBUN_CODE, E.CONTRACT_CODE, E.CONTRACT_NAME, E.AMOUNT1 AS P_AMOUNT1, E.AMOUNT2 AS P_AMOUNT2, E.AMOUNT3 AS P_AMOUNT3,
			CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2
				 ELSE  E.AMOUNT3 END AS P_SUB_TOTAL,  --소계
			CASE WHEN E.GUBUN_CODE = '1' THEN ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
				 ELSE ROUND(E.AMOUNT3*0.1,0) END AS P_VAT,  --부가세
			CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2 + ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
				 ELSE E.AMOUNT3 + ROUND(E.AMOUNT3*0.1,0) END AS P_TOTAL,
			E.QUANTITY
		FROM
		(
			-- 저장품이 아닌경우
			SELECT 
				C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3,
				SUM( C.QUANTITY ) AS QUANTITY
			FROM 
			(
				SELECT 
					#{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME,
					CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
					CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2  --당월물량관리
					, NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
				FROM TBL_WORKING_MONTHLY_REPORT A
				LEFT OUTER JOIN TBL_WORKING_SUBC B
				ON A.BASE_YYYY = B.BASE_YYYY 
				AND A.VENDOR_CODE = B.VENDOR_CODE 
				AND A.CONTRACT_CODE = B.CONTRACT_CODE 
				WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
				AND A.VENDOR_CODE = #{VENDOR_CODE}
				AND B.GUBUN_CODE !='3'
			) C
			GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
			UNION ALL
			-- 저장품인 경우
			SELECT 
				C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3,
				SUM( C.QUANTITY ) AS QUANTITY
			FROM 
			(
				SELECT 
					#{BASE_YYYYMM} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYYMM},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3 --당월물량관리
					, NVL( A.QUANTITY_CHANGED, A.QUANTITY) AS QUANTITY
				FROM TBL_WORKING_MONTHLY_REPORT A
				LEFT OUTER JOIN TBL_WORKING_SUBC B
				ON A.BASE_YYYY = B.BASE_YYYY 
				AND A.VENDOR_CODE = B.VENDOR_CODE 
				AND A.CONTRACT_CODE = B.CONTRACT_CODE 
				WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
				AND A.VENDOR_CODE = #{VENDOR_CODE}
				AND B.GUBUN_CODE ='3'
			) C
			GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
		) E
	) F
	ON D.CHECK_YYYYMM   = F.CHECK_YYYYMM
	AND D.BASE_YYYY     = F.BASE_YYYY
	AND D.VENDOR_CODE   = F.VENDOR_CODE
	AND D.CONTRACT_CODE = F.CONTRACT_CODE
	WHERE 1=1
	AND D.GUBUN_CODE = #{GUBUN_CODE}
</select>

<!-- 도급일보 등록 -->
<select id="select_cb_working_master_v" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_cb_working_master_v */
SELECT
	A.CODE,
	A.CODE_NAME
FROM TBL_WORKING_MASTER A
WHERE 1=1
AND A.USE_YN = 'Y'
AND SUBSTR(A.CODE, 1, 1) = 'V'
AND A.ENTERPRISE_GUBUN IN ('1', '2') -- 조업 및 정비 거래처
ORDER BY A.BASE_YYYY, TO_NUMBER(REGEXP_REPLACE(A.CODE, '[^0-9]'))
</select>

<select id="select_cb_tbl_working_subc" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_cb_tbl_working_subc */
SELECT
	A.BASE_YYYY,
	A.CONTRACT_CODE AS CODE,
	'(' || A.BASE_YYYY || ') ' || A.CONTRACT_NAME AS CODE_NAME
FROM TBL_WORKING_SUBC A
WHERE 1=1
<if test="VENDOR_CODE != null">
AND A.VENDOR_CODE = #{VENDOR_CODE}
</if>
<if test="BASE_YYYY != null">
AND A.BASE_YYYY = #{BASE_YYYY}
</if>
ORDER BY A.BASE_YYYY, TO_NUMBER(REGEXP_REPLACE(A.CONTRACT_CODE, '[^0-9]'))
</select>

<select id="select_tbl_working_daily_report_cnt" resultType="double">
/* oracle.yp_zwc_ipt.select_tbl_working_daily_report_cnt */
SELECT
	COUNT(*) AS CNT
FROM (
	SELECT
		A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, CAL.BASE_YYYYMMDD
	FROM TBL_WORKING_SUBC A
	INNER JOIN (
		SELECT BASE_YYYYMMDD
		FROM (
			SELECT TO_CHAR(TO_DATE(REPLACE(#{BASE_YYYY_S}, '/', ''),'YYYYMMDD') + (LEVEL-1),'YYYYMMDD') AS BASE_YYYYMMDD
			FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> (TO_DATE(REPLACE(#{BASE_YYYY_E}, '/', ''),'YYYYMMDD') - TO_DATE(REPLACE(#{BASE_YYYY_S}, '/', ''),'YYYYMMDD') + 1)
		) S
		WHERE 1=1
	) CAL
		ON 1=1
	WHERE 1=1
	AND A.BASE_YYYY = SUBSTR(#{BASE_YYYY_S}, 1, 4) -- 조회조건 시작일자 4자리 잘라서 사용
	<!-- 계약등록시 부서와 로그인시 부서 체계가 서로 상이함 - 정해지기 전까지 주석처리 -->
	<if test="DEPT_CODE != null">
	AND A.DEPT_CODE = #{DEPT_CODE}
	</if>
	<if test="VENDOR_CODE != null">
	AND A.VENDOR_CODE = #{VENDOR_CODE}
	</if>
	<if test="CONTRACT_CODE != null">
	AND A.CONTRACT_CODE = #{CONTRACT_CODE}
	AND A.BASE_YYYY = #{BASE_YYYY}
	</if>
)
</select>

<select id="select_tbl_working_daily_report" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_tbl_working_daily_report */
SELECT
	NVL(B.GUBUN, '0') AS GUBUN,
	NVL(B.GUBUN, '0') AS GUBUN_ORI,
	A.BASE_YYYY,
	A.VENDOR_CODE,
	A.CONTRACT_CODE,
	A.WORKING_GUBUN AS WORKING_GUBUN,
	CAL.BASE_YYYYMMDD AS BASE_YYYYMMDD_VIEW,
	B.BASE_YYYYMMDD AS BASE_YYYYMMDD,
	A.CONTRACT_NAME AS CONTRACT_NAME,
	A.GUBUN_CODE AS GUBUN_CODE,
	(SELECT S.CODE_NM FROM COM_CODE_DETAIL S WHERE S.CODE = 'YP_SUBC_GUBUN' AND S.CODE_VALUE = A.GUBUN_CODE) AS GUBUN_NAME,
	A.UNIT_CODE AS UNIT_CODE,
	(SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR(S.CODE, 1, 1) = 'U' AND S.CODE = A.UNIT_CODE) AS UNIT_NAME,
	B.EXTENSION_HOUR AS EXTENSION_HOUR,
	B.NIGHT_HOUR AS NIGHT_HOUR,
	B.SATURDAY_HOUR AS SATURDAY_HOUR,
	B.HOLIDAY_HOUR AS HOLIDAY_HOUR,
	/* 2020-10-19 jamerl - 태그업체 테이블 준비되기 전까지 보정공수 합을 사용하도록 조치 */
	B.MANHOUR AS MANHOUR,
	B.COLLECTION_MANHOUR AS COLLECTION_MANHOUR,
	/* 2020-10-19 jamerl - 태그업체 테이블 준비되면 아래 로직 부활 */
<!-- 	MAX(D.MANHOUR) AS MANHOUR, -->
<!-- 	CASE WHEN COUNT(C.WORKLOAD) > 0 THEN MAX(NVL(D.MANHOUR, 0)) - SUM(NVL(C.MANHOUR, 0)) + SUM(NVL(C.COLLECTION_MANHOUR, 0)) ELSE NULL END AS COLLECTION_MANHOUR, -->
	B.WORKLOAD AS WORKLOAD,
	B.TEAM_LEADER_CONFIRM
FROM TBL_WORKING_SUBC A
INNER JOIN (
	SELECT BASE_YYYYMMDD
	FROM (
		SELECT TO_CHAR(TO_DATE(REPLACE(#{BASE_YYYY_S}, '/', ''),'YYYYMMDD') + (LEVEL-1),'YYYYMMDD') AS BASE_YYYYMMDD
		FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> (TO_DATE(REPLACE(#{BASE_YYYY_E}, '/', ''),'YYYYMMDD') - TO_DATE(REPLACE(#{BASE_YYYY_S}, '/', ''),'YYYYMMDD') + 1)
	) S
	WHERE 1=1
) CAL
	ON 1=1
LEFT OUTER JOIN TBL_WORKING_DAILY_REPORT B
	ON A.BASE_YYYY = B.BASE_YYYY
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND CAL.BASE_YYYYMMDD = B.BASE_YYYYMMDD
<!-- LEFT OUTER JOIN ( -->
<!-- 	SELECT -->
<!-- 		DT.BASE_YYYY, -->
<!-- 		DT.VENDOR_CODE, -->
<!-- 		DT.CONTRACT_CODE, -->
<!-- 		DT.BASE_YYYYMMDD, -->
<!-- 		DECODE(DT.COLLECTION_MANHOUR, NULL, 0, DT.MANHOUR) AS MANHOUR, -->
<!-- 		DT.COLLECTION_MANHOUR, -->
<!-- 		DT.WORKLOAD -->
<!-- 	FROM TBL_WORKING_DAILY_REPORT_DT DT -->
<!-- ) C -->
<!-- 	ON C.BASE_YYYY = A.BASE_YYYY -->
<!-- 	AND C.VENDOR_CODE = A.VENDOR_CODE -->
<!-- 	AND C.CONTRACT_CODE = A.CONTRACT_CODE -->
<!-- 	AND CAL.BASE_YYYYMMDD = C.BASE_YYYYMMDD -->
<!-- /* 2020-10-19 jamerl - 태그업체 테이블 준비되면 아우터 조인 추가 예정 */ -->
<!-- LEFT OUTER JOIN ( -->
<!-- 	SELECT -->
<!-- 		S.BASE_YYYY, -->
<!-- 		S.VENDOR_CODE, -->
<!-- 		S.CONTRACT_CODE, -->
<!-- 		COUNT(S.SUBC_CODE) AS MANHOUR -->
<!-- 	FROM TBL_WORKING_SUBCWORKER_MAP S -->
<!-- 	GROUP BY S.BASE_YYYY, S.VENDOR_CODE, S.CONTRACT_CODE -->
<!-- ) D -->
<!-- 	ON A.BASE_YYYY = D.BASE_YYYY -->
<!-- 	AND A.VENDOR_CODE = D.VENDOR_CODE -->
<!-- 	AND A.CONTRACT_CODE = D.CONTRACT_CODE -->
WHERE 1=1
AND A.BASE_YYYY = SUBSTR(#{BASE_YYYY_S}, 1, 4) -- 조회조건 시작일자 4자리 잘라서 사용
<!-- 계약등록시 부서와 로그인시 부서 체계가 서로 상이함 - 정해지기 전까지 주석처리 -->
<if test="COST_CODE != null">
AND A.COST_CODE = #{COST_CODE}
</if>
<if test="DEPT_CODE != null">
AND A.DEPT_CODE = #{DEPT_CODE}
</if>
<if test="VENDOR_CODE != null">
AND A.VENDOR_CODE = #{VENDOR_CODE}
</if>
<if test="CONTRACT_CODE != null">
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.BASE_YYYY = #{BASE_YYYY}
</if>
ORDER BY A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, CAL.BASE_YYYYMMDD
</select>

<select id="select_tbl_working_daily_report_dt_cnt" resultType="double">
/* oracle.yp_zwc_ipt.select_tbl_working_daily_report_dt_cnt */
SELECT
	COUNT(*) AS CNT
FROM (
	SELECT
		A.*
	FROM (
	<choose>
		<when test='"Y".equalsIgnoreCase( WORKING_GUBUN ) or "3".equalsIgnoreCase( GUBUN_CODE )'>
		/*
			WORKING_GUBUN : ${WORKING_GUBUN}
			GUBUN_CODE : ${GUBUN_CODE}
		*/
		-- 2020-10-21 jamerl - 조용래 : 조업계약 및 저장품 계약은 상갑반, 갑반, 을반, 병반 하드코딩 요청
		SELECT
			#{BASE_YYYY} AS BASE_YYYY,
			#{VENDOR_CODE} AS VENDOR_CODE,
			#{CONTRACT_CODE} AS CONTRACT_CODE,
			S.CODE AS WORKTYPE_CODE,
			#{BASE_YYYYMMDD} AS BASE_YYYYMMDD, -- 파라미터
			'' AS WORKER,
			0 AS MANHOUR
		FROM TBL_WORKING_MASTER S
		WHERE 1=1
		AND S.CODE LIKE 'W%'
		AND S.CODE IN ('W1','W2','W3','W4')
		</when>
		<otherwise>
		/*
			WORKING_GUBUN : ${WORKING_GUBUN}
			GUBUN_CODE : ${GUBUN_CODE}
		*/
		SELECT
			S.BASE_YYYY,
			S.VENDOR_CODE,
			S.CONTRACT_CODE,
			S.WORKTYPE_CODE,
			#{BASE_YYYYMMDD} AS BASE_YYYYMMDD,
			NULL AS WORKER,
			0 AS MANHOUR
		FROM TBL_WORKING_SUBC_CTN_DT S
		WHERE 1=1
		AND S.BASE_YYYY = #{BASE_YYYY}
		AND S.VENDOR_CODE = #{VENDOR_CODE}
		AND S.CONTRACT_CODE = #{CONTRACT_CODE}
		AND S.MAN_QTY > 0
<!-- 		SELECT -->
<!-- 			S.BASE_YYYY, -->
<!-- 			S.VENDOR_CODE, -->
<!-- 			S.CONTRACT_CODE, -->
<!-- 			S.WORKTYPE_CODE, -->
<!-- 			#{BASE_YYYYMMDD} AS BASE_YYYYMMDD, /* 파라미터 */ -->
<!-- 			SUBSTR( XMLAGG( XMLELEMENT( SUBC_CODE, ',' || S.SUBC_CODE ) ORDER BY S.BASE_YYYY, S.VENDOR_CODE, S.CONTRACT_CODE, S.SUBC_CODE ).EXTRACT( '//text()' ).GETSTRINGVAL(), 2 ) AS WORKER, -->
<!-- 			COUNT(S.SUBC_CODE) AS MANHOUR -->
<!-- 		FROM TBL_WORKING_SUBCWORKER_MAP S -->
<!-- 		GROUP BY S.BASE_YYYY, S.VENDOR_CODE, S.CONTRACT_CODE, S.WORKTYPE_CODE -->
		</otherwise>
	</choose>
	) A
	LEFT OUTER JOIN TBL_WORKING_DAILY_REPORT_DT B
		ON A.BASE_YYYY = B.BASE_YYYY
		AND A.VENDOR_CODE = B.VENDOR_CODE
		AND A.CONTRACT_CODE = B.CONTRACT_CODE
		AND A.WORKTYPE_CODE = B.WORKTYPE_CODE
	WHERE 1=1
	AND A.BASE_YYYY = #{BASE_YYYY}
	AND A.VENDOR_CODE = #{VENDOR_CODE}
	AND A.CONTRACT_CODE = #{CONTRACT_CODE}
	ORDER BY TO_NUMBER(REGEXP_REPLACE(A.WORKTYPE_CODE, '[^0-9]'))
)
</select>

<select id="select_tbl_working_daily_report_dt" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_tbl_working_daily_report_dt */
SELECT
	E.TEAM_LEADER_CONFIRM,
	A.BASE_YYYY,
	C.CONTRACT_NAME,
	A.VENDOR_CODE,
	A.CONTRACT_CODE,
	A.WORKTYPE_CODE,
	DECODE(A.WORKTYPE_CODE, 'WCTR', '조업계약', (SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR(S.CODE, 1, 1) = 'W' AND S.CODE = A.WORKTYPE_CODE)) AS WORKTYPE_NAME,
	A.BASE_YYYYMMDD,
	A.WORKER,
	B.WORKER AS WORKER_DT,
	-- A.MANHOUR,
	NVL(D.MANHOUR, 0) AS MANHOUR,
	B.COLLECTION_MANHOUR AS COLLECTION_MANHOUR,
	NVL(B.WORKLOAD, 0) AS WORKLOAD,
	B.NOTE
FROM (
<choose>
	<when test='"Y".equalsIgnoreCase( WORKING_GUBUN ) or "3".equalsIgnoreCase( GUBUN_CODE )'>
	/*
		WORKING_GUBUN : ${WORKING_GUBUN}
		GUBUN_CODE : ${GUBUN_CODE}
	*/
	-- 2020-10-21 jamerl - 조용래 : 조업계약 및 저장품 계약은 상갑반, 갑반, 을반, 병반 하드코딩 요청
	SELECT
		#{BASE_YYYY} AS BASE_YYYY,
		#{VENDOR_CODE} AS VENDOR_CODE,
		#{CONTRACT_CODE} AS CONTRACT_CODE,
		S.CODE AS WORKTYPE_CODE,
		#{BASE_YYYYMMDD} AS BASE_YYYYMMDD, -- 파라미터
		'' AS WORKER,
		0 AS MANHOUR
	FROM TBL_WORKING_MASTER S
	WHERE 1=1
	AND S.CODE LIKE 'W%'
	AND S.CODE IN ('W1','W2','W3','W4')
	</when>
	<otherwise>
	/*
		WORKING_GUBUN : ${WORKING_GUBUN}
		GUBUN_CODE : ${GUBUN_CODE}
	*/
	-- 2020-11-03 jamerl - 조용래 : 무조건 상갑반, 갑반, 을반, 병반으로 표시되도록 요청
	SELECT
		#{BASE_YYYY} AS BASE_YYYY,
		#{VENDOR_CODE} AS VENDOR_CODE,
		#{CONTRACT_CODE} AS CONTRACT_CODE,
		S.CODE AS WORKTYPE_CODE,
		#{BASE_YYYYMMDD} AS BASE_YYYYMMDD, -- 파라미터
		'' AS WORKER,
		0 AS MANHOUR
	FROM TBL_WORKING_MASTER S
	WHERE 1=1
	AND S.CODE LIKE 'W%'
	AND S.CODE IN ('W1','W2','W3','W4')
	</otherwise>
</choose>
) A
LEFT OUTER JOIN TBL_WORKING_DAILY_REPORT_DT B
	ON A.BASE_YYYY = B.BASE_YYYY
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.WORKTYPE_CODE = B.WORKTYPE_CODE
	AND A.BASE_YYYYMMDD = B.BASE_YYYYMMDD
INNER JOIN TBL_WORKING_SUBC C
	ON A.BASE_YYYY = C.BASE_YYYY
	AND A.VENDOR_CODE = C.VENDOR_CODE
	AND A.CONTRACT_CODE = C.CONTRACT_CODE
LEFT OUTER JOIN (
	SELECT
		M.BASE_YYYY AS BASE_YYYY,
		M.VENDOR_CODE AS VENDOR_CODE,
		M.CONTRACT_CODE AS CONTRACT_CODE,
		M.BASE_YYYYMMDD AS BASE_YYYYMMDD,
		M.C_WORKTYPE_CODE AS WORKTYPE_CODE,
		COUNT(M.C_WORKTYPE_CODE) AS MANHOUR
	FROM (
		SELECT
			CASE
				WHEN X.WORKTYPE_CODE = 'W1'
					THEN 'W1'
				WHEN TO_DATE(X.BASE_YYYYMMDD || '0500', 'YYYY-MM-DD HH24:MI:SS') <![CDATA[<=]]> X.A_START_DATE AND X.A_START_DATE <![CDATA[<=]]> TO_DATE(X.BASE_YYYYMMDD || '1000', 'YYYY-MM-DD HH24:MI:SS')
					THEN 'W2'
				WHEN TO_DATE(X.BASE_YYYYMMDD || '1200', 'YYYY-MM-DD HH24:MI:SS') <![CDATA[<=]]> X.A_START_DATE AND X.A_START_DATE <![CDATA[<=]]> TO_DATE(X.BASE_YYYYMMDD || '1700', 'YYYY-MM-DD HH24:MI:SS')
					THEN 'W3'
				WHEN TO_DATE(X.BASE_YYYYMMDD || '2100', 'YYYY-MM-DD HH24:MI:SS') <![CDATA[<=]]> X.A_START_DATE AND X.A_START_DATE <![CDATA[<=]]> TO_DATE(X.BASE_YYYYMMDD || '0000', 'YYYY-MM-DD HH24:MI:SS') + 1
					THEN 'W4'
				ELSE
					NULL
			END AS C_WORKTYPE_CODE,
			X.BASE_YYYY,
			X.CONTRACT_CODE,
			X.VENDOR_CODE,
			X.BASE_YYYYMMDD,
			X.A_START_DATE,
			X.A_END_DATE
		FROM (
			SELECT
				A.BASE_YYYY,
				A.CONTRACT_CODE,
				A.VENDOR_CODE,
				B.WORKTYPE_CODE,
				TO_CHAR(C.A_START_DATE, 'YYYYMMDD') AS BASE_YYYYMMDD,
				C.A_START_DATE,
				C.A_END_DATE
			FROM TBL_WORKING_SUBC A
			LEFT OUTER JOIN TBL_WORKING_SUBCWORKER_MAP B
				ON  A.BASE_YYYY = B.BASE_YYYY
				AND A.CONTRACT_CODE = B.CONTRACT_CODE
				AND A.VENDOR_CODE = B.VENDOR_CODE
				AND B.WORKTYPE_CODE = 'W1'
			INNER JOIN (
				SELECT
					C.SABUN,
					TO_CHAR( C.A_START_DATE, 'YYYYMMDD' ),
					MIN( C.A_START_DATE ) AS A_START_DATE,
					MAX( C.A_END_DATE ) AS A_END_DATE
				FROM TBL_ACCESS C 
				GROUP BY C.SABUN, TO_CHAR( C.A_START_DATE, 'YYYYMMDD' )
			) C	/* 2021-03-08 jamerl - 조용래 : TBL_WK_ACCESS에서 TBL_ACCESS의 출퇴근 시간을 사용하도록 변경 */
				/* 2021-03-30 jamerl - 조용래 : 여러번 출퇴근 데이터가 쌓이는 경우가 발생되어 TBL_ACCESS를 사번, 일자로 그룹지어 카운팅 되도록 변경 */
				ON B.SUBC_CODE = C.SABUN
			WHERE 1=1
			AND C.A_START_DATE IS NOT NULL
				UNION ALL
			/* 2021-03-24 jamerl - 조용래 : 수시/저장품( S.WORKTYPE_CODE = 'W98' )은 공수 산출 대상에서 제외 */
			SELECT
				A.BASE_YYYY,
				A.CONTRACT_CODE,
				A.VENDOR_CODE,
				B.WORKTYPE_CODE,
				TO_CHAR(C.A_START_DATE, 'YYYYMMDD') AS BASE_YYYYMMDD,
				C.A_START_DATE,
				C.A_END_DATE
			FROM TBL_WORKING_SUBC A
			LEFT OUTER JOIN TBL_WORKING_SUBCWORKER_MAP B
				ON  A.BASE_YYYY = B.BASE_YYYY
				AND A.CONTRACT_CODE = B.CONTRACT_CODE
				AND A.VENDOR_CODE = B.VENDOR_CODE
				AND B.WORKTYPE_CODE = 'W99'
			INNER JOIN (
				SELECT
					C.SABUN,
					TO_CHAR( C.A_START_DATE, 'YYYYMMDD' ),
					MIN( C.A_START_DATE ) AS A_START_DATE,
					MAX( C.A_END_DATE ) AS A_END_DATE
				FROM TBL_ACCESS C
				GROUP BY C.SABUN, TO_CHAR( C.A_START_DATE, 'YYYYMMDD' )
			) C	/* 2021-03-08 jamerl - 조용래 : TBL_WK_ACCESS에서 TBL_ACCESS의 출퇴근 시간을 사용하도록 변경 */
				/* 2021-03-30 jamerl - 조용래 : 여러번 출퇴근 데이터가 쌓이는 경우가 발생되어 TBL_ACCESS를 사번, 일자로 그룹지어 카운팅 되도록 변경 */
				ON B.SUBC_CODE = C.SABUN
			WHERE 1=1
			AND C.A_START_DATE IS NOT NULL
		) X
		WHERE 1=1
	) M
	WHERE 1=1
	GROUP BY M.BASE_YYYY, M.VENDOR_CODE, M.CONTRACT_CODE, M.BASE_YYYYMMDD, M.C_WORKTYPE_CODE
) D
	ON 1=1
	AND A.BASE_YYYY = D.BASE_YYYY
	AND A.VENDOR_CODE = D.VENDOR_CODE
	AND A.CONTRACT_CODE = D.CONTRACT_CODE
	AND A.BASE_YYYYMMDD = D.BASE_YYYYMMDD
	AND A.WORKTYPE_CODE = D.WORKTYPE_CODE
LEFT OUTER JOIN TBL_WORKING_DAILY_REPORT E
	ON B.BASE_YYYY = E.BASE_YYYY
	AND B.BASE_YYYYMMDD = E.BASE_YYYYMMDD
	AND B.VENDOR_CODE = E.VENDOR_CODE
	AND B.CONTRACT_CODE = E.CONTRACT_CODE
WHERE 1=1
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
ORDER BY TO_NUMBER(REGEXP_REPLACE(A.WORKTYPE_CODE, '[^0-9]'))
</select>

<select id="pre_select_tbl_working_monthly_status" resultType="integer">
/* oracle.yp_zwc_ipt.pre_select_tbl_working_monthly_status */
SELECT
	COUNT(*)
FROM TBL_WORKING_MONTHLY_REPORT A
WHERE 1=1
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.CHECK_YYYYMM = SUBSTR(#{BASE_YYYYMMDD}, 1, 6)
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND NVL(A.STATUS, 'NULL') NOT IN ('5', '7', 'NULL') -- 반려, 신규 이외는 재집계 불가
</select>

<update id="update_tbl_working_daily_report_tlc">
/* oracle.yp_zwc_ipt.merge_tbl_working_daily_report_tlc */
UPDATE TBL_WORKING_DAILY_REPORT SET
	<choose>
		<when test='"Y".equalsIgnoreCase( TEAM_LEADER_CONFIRM_STR )'>
	TEAM_LEADER_CONFIRM_DT = SYSDATE,
		</when>
		<otherwise>
	TEAM_LEADER_CONFIRM_DT = NULL,
		</otherwise>
	</choose>
	TEAM_LEADER_CONFIRM = #{TEAM_LEADER_CONFIRM_STR}
WHERE 1=1
AND BASE_YYYY = #{BASE_YYYY}
AND CONTRACT_CODE = #{CONTRACT_CODE}
AND VENDOR_CODE = #{VENDOR_CODE}
AND BASE_YYYYMMDD = #{BASE_YYYYMMDD}
</update>

<update id="merge_tbl_working_daily_report">
/* oracle.yp_zwc_ipt.merge_tbl_working_daily_report */
MERGE INTO TBL_WORKING_DAILY_REPORT A
USING (
	SELECT
		#{BASE_YYYY} AS BASE_YYYY,
		#{VENDOR_CODE} AS VENDOR_CODE,
		#{CONTRACT_CODE} AS CONTRACT_CODE,
		#{BASE_YYYYMMDD_VIEW} AS BASE_YYYYMMDD,
		#{GUBUN} AS GUBUN,
		#{NIGHT_HOUR} AS NIGHT_HOUR,
		#{EXTENSION_HOUR} AS EXTENSION_HOUR,
		#{SATURDAY_HOUR} AS SATURDAY_HOUR,
		#{HOLIDAY_HOUR} AS HOLIDAY_HOUR,
		#{s_emp_code} AS REG_EMP,
		SYSDATE AS REG_DATE,
		#{s_emp_code} AS UPD_EMP,
		SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.BASE_YYYY = B.BASE_YYYY
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.BASE_YYYYMMDD = B.BASE_YYYYMMDD
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYY,
	CONTRACT_CODE,
	VENDOR_CODE,
	BASE_YYYYMMDD,
	GUBUN,
	<if test='GUBUN != null and "1".equalsIgnoreCase( GUBUN )'>
	/* 2021-03-24 jamerl - 조용래 : 휴일 저장시 투입공수, 공수, 작업량 0 처리 */
	MANHOUR,
	COLLECTION_MANHOUR,
	WORKLOAD,
	</if>
	NIGHT_HOUR,
	EXTENSION_HOUR,
	SATURDAY_HOUR,
	HOLIDAY_HOUR,
	REG_EMP,
	REG_DATE
) VALUES (
	B.BASE_YYYY,
	B.CONTRACT_CODE,
	B.VENDOR_CODE,
	B.BASE_YYYYMMDD,
	B.GUBUN,
	<if test='GUBUN != null and "1".equalsIgnoreCase( GUBUN )'>
	/* 2021-03-24 jamerl - 조용래 : 휴일 저장시 투입공수, 공수, 작업량 0 처리 */
	0,
	0,
	0,
	</if>
	B.NIGHT_HOUR,
	B.EXTENSION_HOUR,
	B.SATURDAY_HOUR,
	B.HOLIDAY_HOUR,
	B.REG_EMP,
	B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	GUBUN = B.GUBUN,
	<if test='GUBUN != null and "1".equalsIgnoreCase( GUBUN )'>
	/* 2021-03-24 jamerl - 조용래 : 휴일 저장시 투입공수, 공수, 작업량 0 처리 */
	MANHOUR = 0,
	COLLECTION_MANHOUR = 0,
	WORKLOAD = 0,
	</if>
	NIGHT_HOUR = B.NIGHT_HOUR,
	EXTENSION_HOUR = B.EXTENSION_HOUR,
	SATURDAY_HOUR = B.SATURDAY_HOUR,
	HOLIDAY_HOUR = B.HOLIDAY_HOUR,
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<update id="merge_tbl_working_daily_report_dt">
/* oracle.yp_zwc_ipt.merge_tbl_working_daily_report_dt */
MERGE INTO TBL_WORKING_DAILY_REPORT_DT A
USING (
	SELECT
		#{BASE_YYYY} AS BASE_YYYY,
		#{CONTRACT_CODE} AS CONTRACT_CODE,
		#{VENDOR_CODE} AS VENDOR_CODE,
		#{BASE_YYYYMMDD} AS BASE_YYYYMMDD,
		#{WORKTYPE_CODE} AS WORKTYPE_CODE,
		#{WORKER} AS WORKER,
		#{MANHOUR} AS MANHOUR,
		#{COLLECTION_MANHOUR} AS COLLECTION_MANHOUR,
		#{WORKLOAD} AS WORKLOAD,
		#{NOTE} AS NOTE,
		#{s_emp_code} AS REG_EMP,
		SYSDATE AS REG_DATE,
		#{s_emp_code} AS UPD_EMP,
		SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.BASE_YYYY = B.BASE_YYYY
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.BASE_YYYYMMDD = B.BASE_YYYYMMDD
	AND A.WORKTYPE_CODE = B.WORKTYPE_CODE
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYY,
	CONTRACT_CODE,
	VENDOR_CODE,
	BASE_YYYYMMDD,
	WORKTYPE_CODE,
	WORKER,
	MANHOUR,
	COLLECTION_MANHOUR,
	WORKLOAD,
	NOTE,
	REG_EMP,
	REG_DATE
) VALUES (
	B.BASE_YYYY,
	B.CONTRACT_CODE,
	B.VENDOR_CODE,
	B.BASE_YYYYMMDD,
	B.WORKTYPE_CODE,
	B.WORKER,
	B.MANHOUR,
	B.COLLECTION_MANHOUR,
	B.WORKLOAD,
	B.NOTE,
	B.REG_EMP,
	B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	WORKER = B.WORKER,
	MANHOUR = B.MANHOUR,
	COLLECTION_MANHOUR = B.COLLECTION_MANHOUR,
	WORKLOAD = B.WORKLOAD,
	NOTE = B.NOTE,
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<select id="pre_update_tbl_working_daily_report" resultType="int">
/* oracle.yp_zwc_ipt.pre_update_tbl_working_daily_report */
SELECT COUNT(*) AS CNT
FROM TBL_WORKING_DAILY_REPORT A
WHERE 1=1
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.BASE_YYYYMMDD = #{BASE_YYYYMMDD}
</select>

<update id="update_tbl_working_daily_report">
/* oracle.yp_zwc_ipt.update_tbl_working_daily_report */
UPDATE TBL_WORKING_DAILY_REPORT A SET
	/* 2021-03-24 jamerl - 조용래 : 휴일 저장시 투입공수, 공수, 작업량 0 처리 */
	A.MANHOUR = CASE WHEN A.GUBUN = '0' THEN #{SUM_MANHOUR} ELSE 0 END,
	A.COLLECTION_MANHOUR = CASE WHEN A.GUBUN = '0' THEN #{SUM_COLLECTION_MANHOUR} ELSE 0 END,
	A.WORKLOAD = CASE WHEN A.GUBUN = '0' THEN #{SUM_WORKLOAD} ELSE 0 END
WHERE 1=1
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.BASE_YYYYMMDD = #{BASE_YYYYMMDD}
</update>

<select id="select_tbl_working_monthly_report_cnt" resultType="double">
/* oracle.yp_zwc_ipt.select_tbl_working_monthly_report_cnt */
SELECT COUNT(*) AS CNT
FROM TBL_WORKING_SUBC A /* 계약 */
LEFT OUTER JOIN (
	SELECT
		B.BASE_YYYY, B.VENDOR_CODE, B.CONTRACT_CODE,
		SUM(B.EXTENSION_HOUR) AS EXTENSION_HOUR,
		SUM(B.NIGHT_HOUR) AS NIGHT_HOUR,
		SUM(B.SATURDAY_HOUR) AS SATURDAY_HOUR,
		SUM(B.HOLIDAY_HOUR) AS HOLIDAY_HOUR,
		SUM(NVL(B.MANHOUR, 0)) AS MANHOUR,
		SUM(NVL(B.COLLECTION_MANHOUR, 0)) AS COLLECTION_MANHOUR,
		SUM(NVL(B.WORKLOAD, 0)) AS WORKLOAD
	FROM TBL_WORKING_DAILY_REPORT B
	WHERE 1=1
	AND B.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4)
<if test="VENDOR_CODE != null">
	AND B.VENDOR_CODE = #{VENDOR_CODE}
</if>
	AND SUBSTR(B.BASE_YYYYMMDD, 1, 6) = REPLACE(#{BASE_YYYY}, '/', '')
<if test="CONTRACT_CODE != null">
	AND B.CONTRACT_CODE = #{CONTRACT_CODE} AND B.BASE_YYYY = #{CONTRACT_BASE_YYYY}
</if>
	GROUP BY B.BASE_YYYY, B.VENDOR_CODE, B.CONTRACT_CODE
) B /* 연장, 야간, 토요, 휴일 */
	ON A.BASE_YYYY = B.BASE_YYYY
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
<!-- LEFT OUTER JOIN ( -->
<!-- 	SELECT -->
<!-- 		C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, -->
<!-- 		SUM(C.MANHOUR) AS MANHOUR, -->
<!-- 		SUM(C.COLLECTION_MANHOUR) AS COLLECTION_MANHOUR, -->
<!-- 		SUM(C.WORKLOAD) AS WORKLOAD -->
<!-- 	FROM ( -->
<!-- 		SELECT -->
<!-- 			C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, -->
<!-- 			C.MANHOUR, -->
<!-- 			CASE WHEN NVL(C.COLLECTION_MANHOUR, 0) = 0 THEN C.MANHOUR ELSE C.COLLECTION_MANHOUR END AS COLLECTION_MANHOUR, -->
<!-- 			C.WORKLOAD AS WORKLOAD -->
<!-- 		FROM TBL_WORKING_DAILY_REPORT_DT C -->
<!-- 		WHERE 1=1 -->
<!-- 		AND C.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4) -->
<!-- <if test="VENDOR_CODE != null"> -->
<!-- 		AND C.VENDOR_CODE = #{VENDOR_CODE} -->
<!-- </if> -->
<!-- 		AND SUBSTR(C.BASE_YYYYMMDD, 1, 6) = REPLACE(#{BASE_YYYY}, '/', '') -->
<!-- <if test="CONTRACT_CODE != null"> -->
<!-- 		AND C.CONTRACT_CODE = #{CONTRACT_CODE} AND C.BASE_YYYY = #{CONTRACT_BASE_YYYY} -->
<!-- </if> -->
<!-- 	) C -->
<!-- 	GROUP BY C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE -->
<!-- ) C /* 실공수, 물량 */ -->
<!-- 	ON A.BASE_YYYY = C.BASE_YYYY -->
<!-- 	AND A.VENDOR_CODE = C.VENDOR_CODE -->
<!-- 	AND A.CONTRACT_CODE = C.CONTRACT_CODE -->
INNER JOIN TBL_WORKING_SUBC_CTN D
	ON A.BASE_YYYY = D.BASE_YYYY
	AND A.VENDOR_CODE = D.VENDOR_CODE
	AND A.CONTRACT_CODE = D.CONTRACT_CODE
LEFT OUTER JOIN TBL_WORKING_MONTHLY_REPORT Z
	ON A.BASE_YYYY = Z.BASE_YYYY
	AND A.VENDOR_CODE = Z.VENDOR_CODE
	AND A.CONTRACT_CODE = Z.CONTRACT_CODE
	AND Z.CHECK_YYYYMM = #{BASE_YYYY}
WHERE 1=1
AND A.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4) -- 조회조건 시작일자 4자리 잘라서 사용
<if test="VENDOR_CODE != null">
AND A.VENDOR_CODE = #{VENDOR_CODE}
</if>
<if test="CONTRACT_CODE != null">
AND A.CONTRACT_CODE = #{CONTRACT_CODE} AND A.BASE_YYYY = #{CONTRACT_BASE_YYYY}
</if>
<!-- 계약등록시 부서와 로그인시 부서 체계가 서로 상이함 - 정해지기 전까지 주석처리 -->
<if test="DEPT_CODE != null">
AND A.DEPT_CODE = #{DEPT_CODE}
</if>
</select>

<select id="select_tbl_working_monthly_report" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_tbl_working_monthly_report */
SELECT
	X.*,
	/* 2021-03-03 jamerl - 조용래 : 지급액 재계산은 별도의 버튼 이벤트를 통해 산출하도록 변경 */
	NVL(X.PAY_AMOUNT_VIEW, 0) AS PAY_AMOUNT
	/*
	NVL(X.PAY_AMOUNT_VIEW, 
		NVL(X.SUBCONTRACTING_COST, 0) + 
		NVL(EXTENSION_AMOUNT, 0) + 
		NVL(NIGHT_AMOUNT, 0) + 
		NVL(SATURDAY_AMOUNT, 0) + 
		NVL(HOLIDAY_AMOUNT, 0) + 
		NVL(REWARD_AMOUNT, 0) + 
		NVL(ADDITIONAL_AMOUNT, 0) 
		- NVL(PENALTY_AMOUNT, 0) -- 패널티는 빼기
	) AS PAY_AMOUNT
	*/
FROM (
	SELECT
		B.TLC_YN, /* 2021-03-09 jamerl - 조용래 : 도급일보 승인받지 않은 데이터(TEAM_LEADER_CONFIRM : N) 존재시 조회제거 */
		Z.CHECK_YYYYMM 			AS CHECK_YYYYMM,
		A.BASE_YYYY 			AS BASE_YYYY,
		A.VENDOR_CODE 			AS VENDOR_CODE,
		(SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR(S.CODE, 1, 1) = 'V' AND S.CODE = A.VENDOR_CODE) AS VENDOR_NAME,
		A.UNIT_CODE AS UNIT_CODE,
		(SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR(S.CODE, 1, 1) = 'U' AND S.CODE = A.UNIT_CODE) AS UNIT_NAME,
		A.CONTRACT_CODE 		AS CONTRACT_CODE,
		A.CONTRACT_NAME 		AS CONTRACT_NAME,
		A.DEPT_CODE AS DEPT_CODE,
		A.DEPT_NAME AS DEPT_NAME,
		B.COLLECTION_MANHOUR 	AS MANHOUR,
		D.UNIT_PRICE 			AS UNIT_PRICE,
		NVL(Z.UNIT_PRICE, 0) 	AS UNIT_PRICE_V, /* 2021-08-02 jamerl - 조용래 : 집계된 단가 출력 */
		D.MONTH_STANDARD_AMOUNT AS MONTH_STANDARD_AMOUNT,
		A.GUBUN_CODE			AS GUBUN_CODE,
		CASE 
			WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE = 'U7' THEN B.COLLECTION_MANHOUR /* 2020-11-06 jamerl - 조용래 : 구분 인력, 단위 공 케이스에 [공수] 출력 적용 */
			ELSE B.WORKLOAD /* 2020-11-06 jamerl - 조용래 : 나머지 케이스는 모두 [작업량] 출력 적용 */
		END AS QUANTITY,
		Z.QUANTITY_CHANGED		AS QUANTITY_CHANGED,
		/*
		ROUND(NVL(Z.SUBCONTRACTING_COST, D.UNIT_PRICE * 
			CASE
				WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE != 'U7' THEN D.MONTH_STANDARD_AMOUNT -- [단가 X 월도급비]
				WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE = 'U7' THEN B.COLLECTION_MANHOUR -- 2020-11-06 jamerl - 조용래 : 구분 인력, 단위 공 케이스에 [단가 X 공수] 수식 적용
				ELSE B.WORKLOAD -- [단가 * 작업량]
			END
		), 0) AS SUBCONTRACTING_COST,
		*/
		ROUND(NVL(Z.SUBCONTRACTING_COST, 0), 0) AS SUBCONTRACTING_COST_V, /* 2021-03-03 jamerl - 조용래 : 집계된 월도급비 출력 */
		ROUND(
			D.UNIT_PRICE * 
			CASE
				WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE != 'U7' THEN D.MONTH_STANDARD_AMOUNT /* [단가 X 월도급비] */
				WHEN A.GUBUN_CODE = '2' AND A.UNIT_CODE = 'U7' THEN B.COLLECTION_MANHOUR /* 2020-11-06 jamerl - 조용래 : 구분 인력, 단위 공 케이스에 [단가 X 공수] 수식 적용 */
				ELSE B.WORKLOAD /* [단가 * 작업량] */
			END
		, 0) AS SUBCONTRACTING_COST, -- 2021-02-02 jamerl - 조용래 : 기초 데이터를 이용한 수식으로 값이 출력되도록 요청
		B.EXTENSION_HOUR 		AS EXTENSION_HOUR,
		-- NVL(Z.EXTENSION_AMOUNT, B.EXTENSION_HOUR * D.OVERTIME_EXTENSION) AS EXTENSION_AMOUNT,
		B.EXTENSION_HOUR * D.OVERTIME_EXTENSION AS EXTENSION_AMOUNT, -- 2021-02-02 jamerl - 조용래 : 기초 데이터를 이용한 수식으로 값이 출력되도록 요청
		B.NIGHT_HOUR 			AS NIGHT_HOUR,
		-- NVL(Z.NIGHT_AMOUNT, B.NIGHT_HOUR * D.OVERTIME_NIGHT) AS NIGHT_AMOUNT,
		B.NIGHT_HOUR * D.OVERTIME_NIGHT AS NIGHT_AMOUNT, -- 2021-02-02 jamerl - 조용래 : 기초 데이터를 이용한 수식으로 값이 출력되도록 요청
		B.SATURDAY_HOUR 		AS SATURDAY_MANHOUR,
		-- NVL(Z.SATURDAY_AMOUNT, B.SATURDAY_HOUR * D.OVERTIME_SATURDAY) AS SATURDAY_AMOUNT,
		B.SATURDAY_HOUR * D.OVERTIME_SATURDAY AS SATURDAY_AMOUNT, -- 2021-02-02 jamerl - 조용래 : 기초 데이터를 이용한 수식으로 값이 출력되도록 요청
		B.HOLIDAY_HOUR 			AS HOLIDAY_MANHOUR,
		-- NVL(Z.HOLIDAY_AMOUNT, B.HOLIDAY_HOUR * D.OVERTIME_HOLIDAY) AS HOLIDAY_AMOUNT,
		B.HOLIDAY_HOUR * D.OVERTIME_HOLIDAY AS HOLIDAY_AMOUNT, -- 2021-02-02 jamerl - 조용래 : 기초 데이터를 이용한 수식으로 값이 출력되도록 요청
		Z.REWARD_RATE, Z.REWARD_AMOUNT, 
		<!-- 2020-11-06 jamerl - 조용래: 기본값 자동세팅 로직 제거 요청 -->
		<!-- 
		NVL(Z.REWARD_RATE,
			CASE WHEN A.GUBUN_CODE = '1'
				THEN 
				CASE WHEN ROUND(B.WORKLOAD / DECODE(D.MONTH_STANDARD_AMOUNT, 0, NULL, D.MONTH_STANDARD_AMOUNT) * 100, 0) <![CDATA[<]]> 95 
					THEN ROUND(B.WORKLOAD / DECODE(D.MONTH_STANDARD_AMOUNT, 0, NULL, D.MONTH_STANDARD_AMOUNT) * 100, 0) 
					ELSE NULL 
				END
				ELSE NULL
			END
		) AS REWARD_RATE,
		NVL(Z.REWARD_AMOUNT,
			CASE WHEN A.GUBUN_CODE = '1'
				THEN
				CASE WHEN ROUND(B.WORKLOAD / DECODE(D.MONTH_STANDARD_AMOUNT, 0, NULL, D.MONTH_STANDARD_AMOUNT) * 100, 0) <![CDATA[<]]> 95 
					THEN	ROUND(NVL(Z.REWARD_AMOUNT, (D.MONTH_STANDARD_AMOUNT * 0.95 - B.WORKLOAD) * D.UNIT_PRICE), 0) 
					ELSE NULL 
				END
				ELSE NULL
			END
		) AS REWARD_AMOUNT,
		 -->
		Z.REWARD_REASON 		AS REWARD_REASON,
		Z.ADDITIONAL_AMOUNT 	AS ADDITIONAL_AMOUNT,
		Z.ADDITIONAL_BASIS 		AS ADDITIONAL_BASIS,
		Z.ADDITIONAL_REASON 	AS ADDITIONAL_REASON,
		Z.PENALTY_AMOUNT 		AS PENALTY_AMOUNT,
		Z.PENALTY_BASIS 		AS PENALTY_BASIS,
		Z.PENALTY_REASON 		AS PENALTY_REASON,
		Z.PAY_AMOUNT 			AS PAY_AMOUNT_VIEW,
		Z.STATUS,
		F_GETCODENAME('YP_APPR_STATUS', Z.STATUS) AS STATUS_TXT
	FROM TBL_WORKING_SUBC A /* 계약 */
	LEFT OUTER JOIN (
		SELECT
			MIN(B.TEAM_LEADER_CONFIRM) AS TLC_YN, /* 2021-03-09 jamerl - 조용래 : 도급일보 승인받지 않은 데이터(TEAM_LEADER_CONFIRM : N) 존재시 조회제거 */
			B.BASE_YYYY, B.VENDOR_CODE, B.CONTRACT_CODE,
			SUM(B.EXTENSION_HOUR) AS EXTENSION_HOUR,
			SUM(B.NIGHT_HOUR) AS NIGHT_HOUR,
			SUM(B.SATURDAY_HOUR) AS SATURDAY_HOUR,
			SUM(B.HOLIDAY_HOUR) AS HOLIDAY_HOUR,
			SUM(NVL(B.MANHOUR, 0)) AS MANHOUR,
			SUM(NVL(B.COLLECTION_MANHOUR, 0)) AS COLLECTION_MANHOUR,
			SUM(NVL(B.WORKLOAD, 0)) AS WORKLOAD
		FROM TBL_WORKING_DAILY_REPORT B
		WHERE 1=1
		AND B.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4)
	<if test="VENDOR_CODE != null">
		AND B.VENDOR_CODE = #{VENDOR_CODE}
	</if>
		AND SUBSTR(B.BASE_YYYYMMDD, 1, 6) = REPLACE(#{BASE_YYYY}, '/', '')
	<if test="CONTRACT_CODE != null">
		AND B.CONTRACT_CODE = #{CONTRACT_CODE} AND B.BASE_YYYY = #{CONTRACT_BASE_YYYY}
	</if>
		GROUP BY B.BASE_YYYY, B.VENDOR_CODE, B.CONTRACT_CODE
	) B /* 연장, 야간, 토요, 휴일 */
		ON A.BASE_YYYY = B.BASE_YYYY
		AND A.VENDOR_CODE = B.VENDOR_CODE
		AND A.CONTRACT_CODE = B.CONTRACT_CODE
<!-- 	LEFT OUTER JOIN ( -->
<!-- 		SELECT -->
<!-- 			C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, -->
<!-- 			SUM(C.MANHOUR) AS MANHOUR, -->
<!-- 			SUM(C.COLLECTION_MANHOUR) AS COLLECTION_MANHOUR, -->
<!-- 			SUM(C.WORKLOAD) AS WORKLOAD -->
<!-- 		FROM ( -->
<!-- 			SELECT -->
<!-- 				C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, -->
<!-- 				C.MANHOUR, -->
<!-- 				CASE WHEN NVL(C.COLLECTION_MANHOUR, 0) = 0 THEN C.MANHOUR ELSE C.COLLECTION_MANHOUR END AS COLLECTION_MANHOUR, -->
<!-- 				C.WORKLOAD AS WORKLOAD -->
<!-- 			FROM TBL_WORKING_DAILY_REPORT_DT C -->
<!-- 			WHERE 1=1 -->
<!-- 			AND C.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4) -->
<!-- 	<if test="VENDOR_CODE != null"> -->
<!-- 			AND C.VENDOR_CODE = #{VENDOR_CODE} -->
<!-- 	</if> -->
<!-- 			AND SUBSTR(C.BASE_YYYYMMDD, 1, 6) = REPLACE(#{BASE_YYYY}, '/', '') -->
<!-- 	<if test="CONTRACT_CODE != null"> -->
<!-- 			AND C.CONTRACT_CODE = #{CONTRACT_CODE} AND C.BASE_YYYY = #{CONTRACT_BASE_YYYY} -->
<!-- 	</if> -->
<!-- 		) C -->
<!-- 		GROUP BY C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE -->
<!-- 	) C /* 실공수, 물량 */ -->
<!-- 		ON A.BASE_YYYY = C.BASE_YYYY -->
<!-- 		AND A.VENDOR_CODE = C.VENDOR_CODE -->
<!-- 		AND A.CONTRACT_CODE = C.CONTRACT_CODE -->
	INNER JOIN TBL_WORKING_SUBC_CTN D
		ON A.BASE_YYYY = D.BASE_YYYY
		AND A.VENDOR_CODE = D.VENDOR_CODE
		AND A.CONTRACT_CODE = D.CONTRACT_CODE
	LEFT OUTER JOIN TBL_WORKING_MONTHLY_REPORT Z
		ON A.BASE_YYYY = Z.BASE_YYYY
		AND A.VENDOR_CODE = Z.VENDOR_CODE
		AND A.CONTRACT_CODE = Z.CONTRACT_CODE
		AND Z.CHECK_YYYYMM = REPLACE(#{BASE_YYYY}, '/', '')
	WHERE 1=1
	AND A.BASE_YYYY = SUBSTR(#{BASE_YYYY}, 1, 4) -- 조회조건 시작일자 4자리 잘라서 사용
	AND B.TLC_YN = 'Y' /* 2021-03-09 jamerl - 조용래 : 도급일보 승인받지 않은 데이터(TEAM_LEADER_CONFIRM : N) 존재시 조회제거 */
	<if test="VENDOR_CODE != null">
	AND A.VENDOR_CODE = #{VENDOR_CODE}
	</if>
	<if test="CONTRACT_CODE != null">
	AND A.CONTRACT_CODE = #{CONTRACT_CODE} AND A.BASE_YYYY = #{CONTRACT_BASE_YYYY}
	</if>
	<!-- 계약등록시 부서와 로그인시 부서 체계가 서로 상이함 - 정해지기 전까지 주석처리 -->
	<if test="DEPT_CODE != null">
	AND A.DEPT_CODE = #{DEPT_CODE}
	</if>
	<choose>
		<when test='GUBUN_CODE_AGGREGATION != null and "0".equalsIgnoreCase( GUBUN_CODE_AGGREGATION )'>
	AND A.GUBUN_CODE = '3' -- 저장품(0)
		</when>
		<when test='GUBUN_CODE_AGGREGATION != null and "1".equalsIgnoreCase( GUBUN_CODE_AGGREGATION )'>
	AND A.GUBUN_CODE <![CDATA[<>]]> '3' -- 저장품 외(1)
		</when>
	</choose>
) X
ORDER BY X.CHECK_YYYYMM, X.BASE_YYYY, X.VENDOR_CODE, X.CONTRACT_CODE
</select>

<select id="pre_select_tbl_working_monthly_report" resultType="integer">
/* oracle.yp_zwc_ipt.pre_select_tbl_working_monthly_report */
SELECT COUNT(*) AS CNT
FROM TBL_WORKING_MONTHLY_REPORT A
WHERE 1=1
AND A.CHECK_YYYYMM = #{CHECK_YYYYMM}
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND NVL(A.STATUS, 'NULL') NOT IN ('5', '7', 'NULL') -- 반려, 신규 이외는 재집계 불가
</select>

<delete id="delete_tbl_working_monthly_report">
/* oracle.yp_zwc_ipt.delete_tbl_working_monthly_report */
DELETE TBL_WORKING_MONTHLY_REPORT A
WHERE 1=1
AND A.CHECK_YYYYMM = #{CHECK_YYYYMM}
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</delete>

<insert id="insert_tbl_working_monthly_report">
/* oracle.yp_zwc_ipt.insert_tbl_working_monthly_report */
INSERT INTO TBL_WORKING_MONTHLY_REPORT
(
	CHECK_YYYYMM,
	BASE_YYYY,
	VENDOR_CODE,
	CONTRACT_CODE,
	MANHOUR,
	UNIT_PRICE,
	MONTH_STANDARD_AMOUNT,
	QUANTITY,
	QUANTITY_CHANGED,
	SUBCONTRACTING_COST,
	EXTENSION_HOUR,
	EXTENSION_AMOUNT,
	NIGHT_HOUR,
	NIGHT_AMOUNT,
	SATURDAY_MANHOUR,
	SATURDAY_AMOUNT,
	HOLIDAY_MANHOUR,
	HOLIDAY_AMOUNT,
	REWARD_RATE,
	REWARD_AMOUNT,
	REWARD_REASON,
	ADDITIONAL_AMOUNT,
	ADDITIONAL_BASIS,
	ADDITIONAL_REASON,
	PENALTY_AMOUNT,
	PENALTY_BASIS,
	PENALTY_REASON,
	PAY_AMOUNT,
	REG_EMP,
	REG_DATE
) VALUES (
	#{CHECK_YYYYMM},
	#{BASE_YYYY},
	#{VENDOR_CODE},
	#{CONTRACT_CODE},
	#{MANHOUR},
	REPLACE( #{UNIT_PRICE}, ',', ''),
	REPLACE( #{MONTH_STANDARD_AMOUNT}, ',', ''),
	REPLACE( #{QUANTITY}, ',', ''),
	REPLACE( #{QUANTITY_CHANGED}, ',', ''),
	REPLACE( #{SUBCONTRACTING_COST}, ',', ''),
	#{EXTENSION_HOUR},
	REPLACE( #{EXTENSION_AMOUNT}, ',', ''),
	#{NIGHT_HOUR},
	REPLACE( #{NIGHT_AMOUNT}, ',', ''),
	#{SATURDAY_MANHOUR},
	REPLACE( #{SATURDAY_AMOUNT}, ',', ''),
	#{HOLIDAY_MANHOUR},
	REPLACE( #{HOLIDAY_AMOUNT}, ',', ''),
	#{REWARD_RATE},
	REPLACE( #{REWARD_AMOUNT}, ',', ''),
	#{REWARD_REASON},
	REPLACE( #{ADDITIONAL_AMOUNT}, ',', ''),
	#{ADDITIONAL_BASIS},
	#{ADDITIONAL_REASON},
	REPLACE( #{PENALTY_AMOUNT}, ',', ''),
	#{PENALTY_BASIS},
	#{PENALTY_REASON},
	/* REPLACE( '${PAY_AMOUNT}', ',', ''), *//* 2021-03-03 jamerl - 조용래 : 집계시 지급액은 항상 수식계산 되도록 변경  */
	TO_NUMBER( REPLACE( NVL( #{SUBCONTRACTING_COST}, 0), ',', '')) + 
	TO_NUMBER( REPLACE( NVL( #{EXTENSION_AMOUNT}, 0), ',', '')) + 
	TO_NUMBER( REPLACE( NVL( #{NIGHT_AMOUNT}, 0), ',', '')) + 
	TO_NUMBER( REPLACE( NVL( #{SATURDAY_AMOUNT}, 0), ',', '')) + 
	TO_NUMBER( REPLACE( NVL( #{HOLIDAY_AMOUNT}, 0), ',', '')) + 
	TO_NUMBER( REPLACE( NVL( #{REWARD_AMOUNT}, 0), ',', '')) + 
	TO_NUMBER( REPLACE( NVL( #{ADDITIONAL_AMOUNT}, 0), ',', '')) - 
	TO_NUMBER( REPLACE( NVL( #{PENALTY_AMOUNT}, 0), ',', '')), 
	#{s_emp_code},
	SYSDATE
)
</insert>

<update id="update_tbl_working_monthly_report">
/* oracle.yp_zwc_ipt.update_tbl_working_monthly_report */
UPDATE TBL_WORKING_MONTHLY_REPORT A SET
	A.MANHOUR = #{MANHOUR},
	A.UNIT_PRICE = REPLACE( #{UNIT_PRICE}, ',', ''),
	A.MONTH_STANDARD_AMOUNT = REPLACE( #{MONTH_STANDARD_AMOUNT}, ',', ''),
	A.QUANTITY = REPLACE( #{QUANTITY}, ',', ''),
	A.QUANTITY_CHANGED = REPLACE( #{QUANTITY_CHANGED}, ',', ''),
	A.SUBCONTRACTING_COST = REPLACE( #{SUBCONTRACTING_COST}, ',', ''),
	A.EXTENSION_HOUR = #{EXTENSION_HOUR},
	A.EXTENSION_AMOUNT = REPLACE( #{EXTENSION_AMOUNT}, ',', ''),
	A.NIGHT_HOUR = #{NIGHT_HOUR},
	A.NIGHT_AMOUNT = REPLACE( #{NIGHT_AMOUNT}, ',', ''),
	A.SATURDAY_MANHOUR = #{SATURDAY_MANHOUR},
	A.SATURDAY_AMOUNT = REPLACE( #{SATURDAY_AMOUNT}, ',', ''),
	A.HOLIDAY_MANHOUR = #{HOLIDAY_MANHOUR},
	A.HOLIDAY_AMOUNT = REPLACE( #{HOLIDAY_AMOUNT}, ',', ''),
	A.REWARD_RATE = #{REWARD_RATE},
	A.REWARD_AMOUNT = REPLACE( #{REWARD_AMOUNT}, ',', ''),
	A.REWARD_REASON = #{REWARD_REASON},
	A.ADDITIONAL_AMOUNT = REPLACE( #{ADDITIONAL_AMOUNT}, ',', ''),
	A.ADDITIONAL_BASIS = #{ADDITIONAL_BASIS},
	A.ADDITIONAL_REASON = #{ADDITIONAL_REASON},
	A.PENALTY_AMOUNT = REPLACE( #{PENALTY_AMOUNT}, ',', ''),
	A.PENALTY_BASIS = #{PENALTY_BASIS},
	A.PENALTY_REASON = #{PENALTY_REASON},
	A.PAY_AMOUNT = REPLACE( #{PAY_AMOUNT}, ',', ''),
	A.UPD_EMP = #{s_emp_code},
	A.UPD_DATE = SYSDATE
WHERE 1=1
AND A.CHECK_YYYYMM = #{CHECK_YYYYMM}
AND A.BASE_YYYY = #{BASE_YYYY}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</update>

<select id="zwc_ipt_contract_bill_representative" resultType="String">
/* oracle.yp_zwc_ipt.zwc_ipt_contract_bill_representative */
SELECT
	NVL(A.REPRESENTATIVE, '　　　　　') AS REPRESENTATIVE
FROM TBL_WORKING_MASTER A
WHERE 1=1
AND A.CODE LIKE 'V%'
AND A.ENTERPRISE_GUBUN IN ('1', '2')
AND A.CODE = #{VENDOR_CODE}
</select>

<select id="select_zwc_ipt_doc_create_dt_list" resultType="HashMap">
/* oracle.yp_zwc_ipt.select_zwc_ipt_doc_create_dt_list */
SELECT TB.*
FROM (
SELECT 
   D.CHECK_YYYYMM, D.BASE_YYYY, D.VENDOR_CODE, D.GUBUN_CODE, D.DEPT_NAME, D.CONTRACT_CODE, D.CONTRACT_NAME, D.AMOUNT1, D.AMOUNT2, D.AMOUNT3,
   CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2
       ELSE  D.AMOUNT3 END AS SUB_TOTAL,  --소계
   CASE WHEN D.GUBUN_CODE = '1' THEN ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
       ELSE ROUND(D.AMOUNT3*0.1,0) END AS VAT,  --부가세
   D.ADJUST_SUBCONTRACTING_COST,
   CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
       ELSE D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) END AS TOTAL,
   CASE WHEN D.GUBUN_CODE = '1' THEN D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0) 
       ELSE D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0) END - D.ADJUST_SUBCONTRACTING_COST AS DIFF,
   CASE WHEN D.GUBUN_CODE = '1' THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2 + ROUND((F.P_AMOUNT1 + F.P_AMOUNT2 )*0.1,0),0) 
       ELSE D.AMOUNT3 + ROUND(F.P_AMOUNT3*0.1,0) END AS P_TOTAL,
   CASE WHEN D.GUBUN_CODE = '1' THEN NVL(D.AMOUNT1 + D.AMOUNT2 + ROUND((D.AMOUNT1 + D.AMOUNT2 )*0.1,0),0) 
       ELSE NVL(D.AMOUNT3 + ROUND(D.AMOUNT3*0.1,0),0) END - 
   CASE WHEN D.GUBUN_CODE = '1' THEN NVL(F.P_AMOUNT1 + F.P_AMOUNT2 + ROUND((F.P_AMOUNT1 + F.P_AMOUNT2 )*0.1,0),0) 
       ELSE NVL(D.AMOUNT3 + ROUND(F.P_AMOUNT3*0.1,0),0) END AS VARIATION,
   DECODE(D.UNIT_NAME,'톤','TON',D.UNIT_NAME) AS UNIT_NAME, 
   D.COST_CODE, D.GUBUN_CODE2, NVL(D.MENINS1,0) AS MENINS1, NVL(D.MENINS2,0) AS MENINS2, NVL(D.MENINS3,0) AS MENINS3, NVL(D.MENINS1,0) + NVL(D.MENINS2,0) + NVL(D.MENINS3,0) as MENINS
FROM
(
   -- 저장품이 아닌경우
   SELECT 
      C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST,
      MAX(C.UNIT_NAME) AS UNIT_NAME, MAX(C.COST_CODE) AS COST_CODE, MAX(C.GUBUN_CODE2) AS GUBUN_CODE2, SUM(C.MENINS1) AS MENINS1,SUM(C.MENINS2) AS MENINS2,SUM(C.MENINS3) AS MENINS3
   FROM 
   (
      SELECT 
         A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, B.DEPT_NAME,
         CASE WHEN B.GUBUN_CODE ='2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1,  --당월협력업체(인력)
         CASE WHEN B.GUBUN_CODE ='1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2,  --당월물량관리
         C.ADJUST_SUBCONTRACTING_COST,
         (SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR(S.CODE, 1, 1) = 'U' AND S.CODE = B.UNIT_CODE) AS UNIT_NAME,
         B.COST_CODE, B.GUBUN_CODE AS GUBUN_CODE2, 
         CASE WHEN B.GUBUN_CODE ='2' THEN A.MONTH_STANDARD_AMOUNT ELSE 0 END MENINS1,  --당월협력업체(인력)
         CASE WHEN B.GUBUN_CODE ='1' THEN NVL(A.QUANTITY_CHANGED, A.QUANTITY) ELSE 0 END MENINS2,  --당월물량관리
         CASE WHEN B.GUBUN_CODE ='3' THEN A.QUANTITY ELSE 0 END MENINS3  --저장품, 20231108 저장품의 경우에도 실적물량(일보)로 표현, 총무팀 김경준 과장
         ,A.QUANTITY_CHANGED, A.QUANTITY
      FROM TBL_WORKING_MONTHLY_REPORT A
      LEFT OUTER JOIN TBL_WORKING_SUBC B
      ON A.BASE_YYYY = B.BASE_YYYY 
      AND A.VENDOR_CODE = B.VENDOR_CODE 
      AND A.CONTRACT_CODE = B.CONTRACT_CODE 
      LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
      ON A.BASE_YYYY = C.BASE_YYYY 
      AND A.VENDOR_CODE = C.VENDOR_CODE 
      AND A.CONTRACT_CODE = C.CONTRACT_CODE  
      WHERE A.CHECK_YYYYMM = #{BASE_YYYY}  -- 입력파라메터
      AND A.VENDOR_CODE    = #{VENDOR_CODE}
      AND B.GUBUN_CODE    !='3'
   ) C
   GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
   UNION ALL
   -- 저장품인 경우
   SELECT 
      C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.DEPT_NAME) AS DEPT_NAME, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3, SUM(C.ADJUST_SUBCONTRACTING_COST) AS ADJUST_SUBCONTRACTING_COST,
      MAX(C.UNIT_NAME) AS UNIT_NAME, MAX(C.COST_CODE) AS COST_CODE, MAX(C.GUBUN_CODE2) AS GUBUN_CODE2, SUM(C.MENINS1) AS MENINS1,SUM(C.MENINS2) AS MENINS2,SUM(C.MENINS3) AS MENINS3
   FROM 
   (
      SELECT 
         A.CHECK_YYYYMM, A.BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.DEPT_NAME, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3, C.ADJUST_SUBCONTRACTING_COST,
         (SELECT S.CODE_NAME FROM TBL_WORKING_MASTER S WHERE SUBSTR(S.CODE, 1, 1) = 'U' AND S.CODE = B.UNIT_CODE) AS UNIT_NAME, B.COST_CODE, B.GUBUN_CODE AS GUBUN_CODE2, 
         CASE WHEN B.GUBUN_CODE ='2' THEN A.MONTH_STANDARD_AMOUNT ELSE 0 END MENINS1,  --당월협력업체(인력)
         CASE WHEN B.GUBUN_CODE ='1' THEN NVL(A.QUANTITY_CHANGED, A.QUANTITY) ELSE 0 END MENINS2,  --당월물량관리
         CASE WHEN B.GUBUN_CODE ='3' THEN A.QUANTITY ELSE 0 END MENINS3 --저장품, 20231108 저장품의 경우에도 실적물량(일보)로 표현, 총무팀 김경준 과장
      FROM TBL_WORKING_MONTHLY_REPORT A
      LEFT OUTER JOIN TBL_WORKING_SUBC B
      ON A.BASE_YYYY = B.BASE_YYYY 
      AND A.VENDOR_CODE = B.VENDOR_CODE 
      AND A.CONTRACT_CODE = B.CONTRACT_CODE 
      LEFT OUTER JOIN TBL_WORKING_SUBC_COST_ADJUST C
      ON A.BASE_YYYY = C.BASE_YYYY 
      AND A.VENDOR_CODE = C.VENDOR_CODE 
      AND A.CONTRACT_CODE = C.CONTRACT_CODE 
      WHERE A.CHECK_YYYYMM = #{BASE_YYYY}  -- 입력파라메터
      AND A.VENDOR_CODE    = #{VENDOR_CODE}
      AND B.GUBUN_CODE     ='3'
   ) C
   GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
) D LEFT OUTER JOIN 
(
   SELECT 
      E.CHECK_YYYYMM, E.BASE_YYYY, E.VENDOR_CODE, E.GUBUN_CODE, E.CONTRACT_CODE, E.CONTRACT_NAME, E.AMOUNT1 AS P_AMOUNT1, E.AMOUNT2 AS P_AMOUNT2, E.AMOUNT3 AS P_AMOUNT3,
      CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2
          ELSE  E.AMOUNT3 END AS P_SUB_TOTAL,  --소계
      CASE WHEN E.GUBUN_CODE = '1' THEN ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
          ELSE ROUND(E.AMOUNT3*0.1,0) END AS P_VAT,  --부가세
      CASE WHEN E.GUBUN_CODE = '1' THEN E.AMOUNT1 + E.AMOUNT2 + ROUND((E.AMOUNT1 + E.AMOUNT2 )*0.1,0) 
          ELSE E.AMOUNT3 + ROUND(E.AMOUNT3*0.1,0) END AS P_TOTAL
   FROM
   (
      -- 저장품이 아닌경우
      SELECT 
         C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME,  '1' AS GUBUN_CODE, SUM(C.AMOUNT1) AS AMOUNT1, SUM(C.AMOUNT2) AS AMOUNT2, 0 AS AMOUNT3
      FROM 
      (
         SELECT 
            #{BASE_YYYY} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYY},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME,
            CASE WHEN B.GUBUN_CODE = '2' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT1, --당월협력업체(인력)
            CASE WHEN B.GUBUN_CODE = '1' THEN A.PAY_AMOUNT ELSE 0 END AMOUNT2 --당월물량관리
         FROM TBL_WORKING_MONTHLY_REPORT A
         LEFT OUTER JOIN TBL_WORKING_SUBC B
         ON A.BASE_YYYY = B.BASE_YYYY 
         AND A.VENDOR_CODE = B.VENDOR_CODE 
         AND A.CONTRACT_CODE = B.CONTRACT_CODE 
         WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM} -- 입력파라메터 (-1개월)
         AND A.VENDOR_CODE    = #{VENDOR_CODE}
         AND B.GUBUN_CODE !='3'
      ) C
      GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
      UNION ALL
      -- 저장품인 경우
      SELECT 
         C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE, MAX(C.CONTRACT_NAME) AS CONTRACT_NAME, '0' AS GUBUN_CODE, 0 AS AMOUNT1, 0 AS AMOUNT2, SUM(C.AMOUNT3) AS AMOUNT3
      FROM 
      (
         SELECT 
            #{BASE_YYYY} AS CHECK_YYYYMM, SUBSTR(#{BASE_YYYY},1,4) AS BASE_YYYY, A.VENDOR_CODE, A.CONTRACT_CODE, B.CONTRACT_NAME, A.PAY_AMOUNT AMOUNT3 --당월물량관리
         FROM TBL_WORKING_MONTHLY_REPORT A
         LEFT OUTER JOIN TBL_WORKING_SUBC B
         ON A.BASE_YYYY = B.BASE_YYYY 
         AND A.VENDOR_CODE = B.VENDOR_CODE 
         AND A.CONTRACT_CODE = B.CONTRACT_CODE 
         WHERE A.CHECK_YYYYMM = #{PREV_YYYYMM}  -- 입력파라메터 (-1개월)
         AND A.VENDOR_CODE    = #{VENDOR_CODE}
         AND B.GUBUN_CODE     ='3'
      ) C
      GROUP BY C.CHECK_YYYYMM, C.BASE_YYYY, C.VENDOR_CODE, C.CONTRACT_CODE
   ) E
) F 
ON D.CHECK_YYYYMM   = F.CHECK_YYYYMM
AND D.BASE_YYYY     = F.BASE_YYYY
AND D.VENDOR_CODE   = F.VENDOR_CODE
AND D.CONTRACT_CODE = F.CONTRACT_CODE
WHERE 1=1
AND D.GUBUN_CODE = #{GUBUN_CODE_AGGREGATION}
) TB
WHERE 1=1
AND TB.SUB_TOTAL <![CDATA[>]]> 0 <!-- 20201207_KHJ 조용래 대리 요청으로 합계 0원인 계약들은 제외 -->
</select>

<update id="updateDocumentNumber">
/* oracle.yp_zwc_ipt.updateDocumentNumber */
UPDATE TBL_WORKING_SUBC_COST_COUNT
SET   SLIP_NUMBER  = #{doc_no},	/* 전표번호 저장 */
      BUDAT        = REPLACE(#{BUDAT}, '/', '')   /* 전표 전기일 저장 */
WHERE CHECK_YYYYMM = REPLACE(#{CHECK_YYYYMM}, '/', '')
AND   VENDOR_CODE  = #{VENDOR_CODE}
AND   GUBUN_CODE   = #{GUBUN_CODE}
</update>

<select id="DocumentCheckList" resultType="HashMap">
/* oracle.yp_zwc_ipt.DocumentCheckList */
SELECT 
    CHECK_YYYYMM,
    A.VENDOR_CODE,
    GUBUN_CODE,
    NVL(SLIP_NUMBER,'') as SLIP_NUMBER,
    A.BUDAT
FROM TBL_WORKING_SUBC_COST_COUNT A
LEFT OUTER JOIN TBL_WORKING_MASTER B
ON A.VENDOR_CODE = B.CODE
WHERE 1=1
AND CHECK_YYYYMM = REPLACE(#{check_yyyymm}, '/', '')
AND GUBUN_CODE   = #{GUBUN_CODE}
AND SLIP_NUMBER IS NOT NULL
</select>

<update id="DocumentNumberInit">
/* oracle.yp_zwc_ipt.DocumentNumberInit */
UPDATE TBL_WORKING_SUBC_COST_COUNT
SET   SLIP_NUMBER = NULL,
      BUDAT = NULL
WHERE SLIP_NUMBER = #{SLIP_NUMBER}
AND   BUDAT       = #{BUDAT}
</update>

<update id="zwc_ipt_mon_create_status_reset">
/* oracle.yp_zwc_ipt.zwc_ipt_mon_create_status_reset */
MERGE INTO TBL_WORKING_MONTHLY_REPORT A
USING (
	SELECT
		A.CHECK_YYYYMM,
		A.BASE_YYYY,
		A.VENDOR_CODE,
		A.CONTRACT_CODE,
		A.STATUS,
		A.EA_DOC_NO,
		A.EA_FORM_ID,
		A.EA_GW_ID,
		A.EA_DATE
	FROM TBL_WORKING_MONTHLY_REPORT A
	INNER JOIN TBL_WORKING_SUBC B
		ON A.BASE_YYYY = B.BASE_YYYY
		AND A.VENDOR_CODE = B.VENDOR_CODE
		AND A.CONTRACT_CODE = B.CONTRACT_CODE
		AND B.DEPT_CODE = #{DEPT_CODE}
	WHERE 1=1
	AND A.CHECK_YYYYMM = #{CHECK_YYYYMM}
) B
ON (	A.CHECK_YYYYMM = B.CHECK_YYYYMM
	AND A.BASE_YYYY = B.BASE_YYYY
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
)
WHEN MATCHED THEN
UPDATE SET
	STATUS = NULL,
	EA_DOC_NO = NULL,
	EA_FORM_ID = NULL,
	EA_GW_ID = NULL,
	EA_DATE = NULL
</update>

<update id="zwc_ipt_sum_list_status_reset">
/* oracle.yp_zwc_ipt.zwc_ipt_sum_list_status_reset */
MERGE INTO TBL_WORKING_SUBC_COST_COUNT A
USING (
	SELECT
		A.CHECK_YYYYMM,
		A.VENDOR_CODE,
		A.GUBUN_CODE
	FROM TBL_WORKING_SUBC_COST_COUNT A
	WHERE 1=1
	AND A.CHECK_YYYYMM = #{CHECK_YYYYMM}
	AND A.GUBUN_CODE = #{GUBUN_CODE}
) B
ON (	A.CHECK_YYYYMM = B.CHECK_YYYYMM
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.GUBUN_CODE = B.GUBUN_CODE
)
WHEN MATCHED THEN
UPDATE SET
	STATUS = NULL,
	EA_DOC_NO = NULL,
	EA_FORM_ID = NULL,
	EA_GW_ID = NULL,
	EA_DATE = NULL
</update>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="oracle.yp_zcs_ipt2">

<select id="select_zcs_ipt2_daily_rpt1" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_rpt1 */
SELECT
	  ROW_NUMBER() OVER(ORDER BY M.DATA_TYPE, M.WORK_START_DT DESC, M.ORDER_NUMBER, M.COST_CODE ) AS RN
	, M.DBYN, M.RELEASE_YN
	, M.CONTRACT_CODE
	, M.VENDOR_CODE
	, M.ORDER_NUMBER
	, M.WORK_DT
	, M.DATA_TYPE
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, M.WORK_CONTENTS
	, M.COST_CODE
	, M.COST_NAME
	, M.WORK_START_DT
	, M.WORK_START_TIME
	, M.WORK_END_DT
	, M.WORK_END_TIME
	, M.MANHOUR
	, M.MANHOUR_CORRECTION
	, M.MANHOUR_SUM
	, M.MEMO
	, M.CONFIRM_YN
	, M.CONFIRM_EMP
	, M.CONFIRM_DT
	, M.APRV_YN
	, M.APRV_EMP
	, M.APRV_DT
FROM (
	SELECT
		  RANK() OVER(PARTITION BY A.CONTRACT_CODE, A.VENDOR_CODE, A.ORDER_NUMBER ORDER BY A.DBYN DESC) AS RK  /* 저장데이터 우선순위 */
		, A.*
	FROM (
		SELECT
			  'N' AS DBYN, 'N' AS RELEASE_YN
			, #{CONTRACT_CODE} AS CONTRACT_CODE
			, #{VENDOR_CODE} AS VENDOR_CODE
			, TO_CHAR( B.AUFNR ) AS ORDER_NUMBER /* 오더번호 */
			, NVL( MAX( A.AUFTEXT ), '돌발작업' ) AS WORK_CONTENTS /* 작업내역 */
			, A.KOSTL AS COST_CODE /* 코스트센터 */
			, MAX( A.KTEXT ) AS COST_NAME /* 코스트센터명 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'YYYYMMDD' ) AS WORK_DT /* 작업일 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'YYYY/MM/DD' ) AS WORK_START_DT /* 시작일자 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'HH24:MI:SS' ) AS WORK_START_TIME /* 시작시간 */
			, TO_CHAR( MAX( B.W_END_DATE ), 'YYYY/MM/DD' ) AS WORK_END_DT /* 종료일자 */
			, TO_CHAR( MAX( B.W_END_DATE ), 'HH24:MI:SS' ) AS WORK_END_TIME /* 종료시간 */
			, CASE
				WHEN COUNT( D.MHOUR ) = 0 THEN 0
				ELSE TRUNC( SUM( NVL( D.MHOUR, 0 ) ) / COUNT( D.MHOUR ), 2 )
			END AS MANHOUR /* 공수 */
			, 0 AS MANHOUR_CORRECTION /* 보정 */
			, CASE
				WHEN COUNT( D.MHOUR ) = 0 THEN 0
				ELSE TRUNC( SUM( NVL( D.MHOUR, 0 ) ) / COUNT( D.MHOUR ), 2 )
			END AS MANHOUR_SUM /* 공수합계 */
			, '' AS MEMO /* 비고 */
			, 'A' AS DATA_TYPE
			, 'N' AS CONFIRM_YN
			, NULL AS CONFIRM_EMP
			, NULL AS CONFIRM_DT
			, 'N' AS APRV_YN
			, NULL AS APRV_EMP
			, NULL AS APRV_DT
		FROM TBL_WK_ACCESS B
		LEFT OUTER JOIN TBL_WK A
			ON A.AUFNR = B.AUFNR
		INNER JOIN T_SECOM_PERSON C
			ON B.CARD_NO = C.CARDNO
			AND B.SABUN = C.SABUN
			AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
			AND C.TEAM = #{VENDOR_NAME}
		INNER JOIN (
			SELECT
				B.AUFNR, /* 오더번호 */
				A.KOSTL, /* 코스트센터 */
				/* 2021-03-29 jamerl - 최승빈 : 소수점 두자리 반올림 한 값을 SUM 하여 사용하도록 의사결정 */
				SUM( ROUND( ( CAST( B.W_END_DATE AS DATE ) - CAST( B.W_START_DATE AS DATE ) ), 2 ) * 24 / 8 ) AS MHOUR /* 공수 */
			FROM TBL_WK_ACCESS B
			LEFT OUTER JOIN TBL_WK A
				ON A.AUFNR = B.AUFNR
			INNER JOIN T_SECOM_PERSON C
				ON B.CARD_NO = C.CARDNO
				AND B.SABUN = C.SABUN
				AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
				AND C.TEAM = #{VENDOR_NAME}
			WHERE 1=1
			AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
			AND B.W_END_DATE IS NOT NULL
--			AND A.WORK_STATUS = '2' /* 작업완료 */ /* 2022-01-03 jamerl - 최승빈 : 조건에서 제거 */
			GROUP BY
				B.AUFNR, A.KOSTL
		) D
			ON B.AUFNR = D.AUFNR
			AND NVL( A.KOSTL, '-' ) = NVL( D.KOSTL, '-' ) /* TBL_WK에 코스트센터코드가 NULL인 경우 조인걸 수 있도록 변경 */
		WHERE 1=1
		AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
		AND B.W_END_DATE IS NOT NULL
--		AND A.WORK_STATUS = '2' /* 작업완료 */ /* 2022-01-03 jamerl - 최승빈 : 조건에서 제거 */
		GROUP BY B.AUFNR, A.KOSTL
	UNION ALL
		SELECT
			  'Y' AS DBYN, RELEASE_YN AS RELEASE_YN
			, CONTRACT_CODE
			, VENDOR_CODE
			, ORDER_NUMBER
			, WORK_CONTENTS
			, COST_CODE
			, COST_NAME
			, WORK_DT
			, WORK_START_DT
			, WORK_START_TIME
			, WORK_END_DT
			, WORK_END_TIME
			, MANHOUR
			, MANHOUR_CORRECTION
			, MANHOUR_SUM
			, MEMO
			, DATA_TYPE
			, CONFIRM_YN
			, CONFIRM_EMP
			, TO_CHAR( CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
			, APRV_YN
			, APRV_EMP
			, TO_CHAR( APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
		FROM TBL_CONST_DAILY_RPT1 Y
		WHERE 1=1
		AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
		AND Y.VENDOR_CODE = #{VENDOR_CODE}
		AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
	) A
) M
WHERE 1=1
AND M.RK = 1 /* 저장데이터 우선 출력 */
</select>

<delete id="delete_zcs_ipt2_daily_rpt1">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_daily_rpt1 */
DELETE FROM TBL_CONST_DAILY_RPT1 A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</delete>

<update id="merge_zcs_ipt2_daily_rpt1">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_daily_rpt1 */
MERGE INTO TBL_CONST_DAILY_RPT1 A USING (
	SELECT
		  #{CONTRACT_CODE} AS CONTRACT_CODE
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_DT} AS WORK_DT
		, #{DATA_TYPE} AS DATA_TYPE
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, #{WORK_START_DT} AS WORK_START_DT
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_DT} AS WORK_END_DT
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{MANHOUR} AS MANHOUR
		, #{MANHOUR_CORRECTION} AS MANHOUR_CORRECTION
		, #{MANHOUR_SUM} AS MANHOUR_SUM
		, #{MEMO} AS MEMO
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.ORDER_NUMBER = B.ORDER_NUMBER
	AND A.WORK_DT = B.WORK_DT
	AND A.DATA_TYPE = B.DATA_TYPE
)
WHEN NOT MATCHED THEN
INSERT (
	  CONTRACT_CODE
	, VENDOR_CODE
	, ORDER_NUMBER
	, WORK_DT
	, DATA_TYPE
	, WORK_CONTENTS
	, COST_CODE
	, COST_NAME
	, WORK_START_DT
	, WORK_START_TIME
	, WORK_END_DT
	, WORK_END_TIME
	, MANHOUR
	, MANHOUR_CORRECTION
	, MANHOUR_SUM
	, MEMO
	, REG_EMP
	, REG_DATE
) VALUES (
	  B.CONTRACT_CODE
	, B.VENDOR_CODE
	, B.ORDER_NUMBER
	, B.WORK_DT
	, B.DATA_TYPE
	, B.WORK_CONTENTS
	, B.COST_CODE
	, B.COST_NAME
	, B.WORK_START_DT
	, B.WORK_START_TIME
	, B.WORK_END_DT
	, B.WORK_END_TIME
	, B.MANHOUR
	, B.MANHOUR_CORRECTION
	, B.MANHOUR_SUM
	, B.MEMO
	, B.REG_EMP
	, B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	  UPD_EMP = B.UPD_EMP
	, UPD_DATE = B.UPD_DATE
	, MANHOUR = B.MANHOUR
	, MANHOUR_CORRECTION = B.MANHOUR_CORRECTION
	, MANHOUR_SUM = B.MANHOUR_SUM
	, MEMO = B.MEMO
<if test='"M".equalsIgnoreCase( DATA_TYPE )'>
	, WORK_START_TIME = B.WORK_START_TIME
	, WORK_END_TIME = B.WORK_END_TIME
</if>
</update>

<select id="pre_select_zcs_ipt2_daily_rpt1" resultType="integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_daily_rpt1 */
SELECT COUNT(*)
FROM TBL_CONST_DAILY_RPT1 A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.APRV_YN = 'Y'
</select>

<update id="update_confirm_zcs_ipt2_daily_rpt1">
/* oracle.yp_zcs_ipt2.update_confirm_zcs_ipt2_daily_rpt1 */
UPDATE TBL_CONST_DAILY_RPT1 A SET
	  A.CONFIRM_YN = 'Y'
	, A.CONFIRM_EMP = #{s_emp_code}
	, A.CONFIRM_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="update_cancel_zcs_ipt2_daily_rpt1">
/* oracle.yp_zcs_ipt2.update_cancel_zcs_ipt2_daily_rpt1 */
UPDATE TBL_CONST_DAILY_RPT1 A SET
	  A.CONFIRM_YN = 'N'
	, A.CONFIRM_EMP = NULL
	, A.CONFIRM_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<select id="select_zcs_ipt2_daily_aprv1" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_aprv1 */
SELECT
	  ROW_NUMBER() OVER(ORDER BY Y.DATA_TYPE, Y.WORK_START_DT DESC, Y.ORDER_NUMBER, Y.COST_CODE ) AS RN
	, Y.CONTRACT_CODE, Y.RELEASE_YN
	, Y.VENDOR_CODE
	, Y.ORDER_NUMBER
	, Y.WORK_CONTENTS
	, Y.COST_CODE
	, Y.COST_NAME
	, Y.WORK_DT
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, Y.WORK_START_DT
	, Y.WORK_START_TIME
	, Y.WORK_END_DT
	, Y.WORK_END_TIME
	, Y.MANHOUR
	, Y.MANHOUR_CORRECTION
	, Y.MANHOUR_SUM
	, Y.MEMO
	, Y.DATA_TYPE
	, Y.CONFIRM_YN
	, Y.CONFIRM_EMP
	, TO_CHAR( Y.CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
	, Y.APRV_YN
	, Y.APRV_EMP
	, TO_CHAR( Y.APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
FROM TBL_CONST_DAILY_RPT1 Y
WHERE 1=1
AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
AND Y.VENDOR_CODE = #{VENDOR_CODE}
AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
AND Y.CONFIRM_YN = 'Y' /* 확정데이터 */
</select>

<update id="update_aprv_zcs_ipt2_daily_aprv1">
/* oracle.yp_zcs_ipt2.update_aprv_zcs_ipt2_daily_aprv1 */
UPDATE TBL_CONST_DAILY_RPT1 A SET
	  A.APRV_YN = 'Y'
	, A.APRV_EMP = #{s_emp_code}
	, A.MANHOUR = #{MANHOUR}
	, A.MANHOUR_CORRECTION = #{MANHOUR_CORRECTION}
	, A.MANHOUR_SUM = #{MANHOUR_SUM}
	, A.MEMO = #{MEMO}
	, A.APRV_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="update_reject_zcs_ipt2_daily_aprv1">
/* oracle.yp_zcs_ipt2.update_reject_zcs_ipt2_daily_aprv1 */
UPDATE TBL_CONST_DAILY_RPT1 A SET
	  A.APRV_YN = 'N'
	, A.APRV_EMP = NULL
	, A.APRV_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="lock_zcs_ipt2_daily_aprv1">
/* oracle.yp_zcs_ipt2.lock_zcs_ipt2_daily_aprv1 */
UPDATE TBL_CONST_DAILY_RPT1 A SET
	  A.RELEASE_YN = 'N'
	, A.RELEASE_EMP = NULL
	, A.RELEASE_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="release_zcs_ipt2_daily_aprv1">
/* oracle.yp_zcs_ipt2.release_zcs_ipt2_daily_aprv1 */
UPDATE TBL_CONST_DAILY_RPT1 A SET
	  A.RELEASE_YN = 'Y'
	, A.RELEASE_EMP = #{s_emp_code}
	, A.RELEASE_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<select id="select_zcs_ipt2_daily_rpt2_tag" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_rpt2_tag */
SELECT
	  ROW_NUMBER() OVER(ORDER BY M.DATA_TYPE, M.WORK_START_DT DESC, M.ORDER_NUMBER, M.COST_CODE ) AS RN
	, M.DBYN, M.RELEASE_YN
	, M.CONTRACT_CODE
	, M.VENDOR_CODE
	, M.ORDER_NUMBER
	, M.WORK_DT
	, M.DATA_TYPE
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, M.WORK_CONTENTS
	, M.COST_CODE
	, M.COST_NAME
	, M.WORK_START_DT
	, M.WORK_START_TIME
	, M.WORK_END_DT
	, M.WORK_END_TIME
	, M.MANHOUR
	, M.MANHOUR_CORRECTION
	, M.MANHOUR_SUM
	, M.MEMO
	, M.CONFIRM_YN
	, M.CONFIRM_EMP
	, M.CONFIRM_DT
	, M.APRV_YN
	, M.APRV_EMP
	, M.APRV_DT
FROM (
	SELECT
		  RANK() OVER(PARTITION BY A.CONTRACT_CODE, A.VENDOR_CODE, A.ORDER_NUMBER ORDER BY A.DBYN DESC) AS RK  /* 저장데이터 우선순위 */
		, A.*
	FROM (
		SELECT
			  'N' AS DBYN, 'N' AS RELEASE_YN
			, #{CONTRACT_CODE} AS CONTRACT_CODE
			, #{VENDOR_CODE} AS VENDOR_CODE
			, TO_CHAR( B.AUFNR ) AS ORDER_NUMBER /* 오더번호 */
			, NVL( MAX( A.AUFTEXT ), '돌발작업' ) AS WORK_CONTENTS /* 작업내역 */
			, A.KOSTL AS COST_CODE /* 코스트센터 */
			, MAX( A.KTEXT ) AS COST_NAME /* 코스트센터명 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'YYYYMMDD' ) AS WORK_DT /* 작업일 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'YYYY/MM/DD' ) AS WORK_START_DT /* 시작일자 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'HH24:MI:SS' ) AS WORK_START_TIME /* 시작시간 */
			, TO_CHAR( MAX( B.W_END_DATE ), 'YYYY/MM/DD' ) AS WORK_END_DT /* 종료일자 */
			, TO_CHAR( MAX( B.W_END_DATE ), 'HH24:MI:SS' ) AS WORK_END_TIME /* 종료시간 */
			, CASE
				WHEN COUNT( D.MHOUR ) = 0 THEN 0
				ELSE TRUNC( SUM( NVL( D.MHOUR, 0 ) ) / COUNT( D.MHOUR ), 2 )
			END AS MANHOUR /* 공수 */
			, 0 AS MANHOUR_CORRECTION /* 보정 */
			, CASE
				WHEN COUNT( D.MHOUR ) = 0 THEN 0
				ELSE TRUNC( SUM( NVL( D.MHOUR, 0 ) ) / COUNT( D.MHOUR ), 2 )
			END AS MANHOUR_SUM /* 공수합계 */
			, '' AS MEMO /* 비고 */
			, 'A' AS DATA_TYPE
			, 'N' AS CONFIRM_YN
			, NULL AS CONFIRM_EMP
			, NULL AS CONFIRM_DT
			, 'N' AS APRV_YN
			, NULL AS APRV_EMP
			, NULL AS APRV_DT
		FROM TBL_WK_ACCESS B
		LEFT OUTER JOIN TBL_WK A
			ON A.AUFNR = B.AUFNR
		INNER JOIN T_SECOM_PERSON C
			ON B.CARD_NO = C.CARDNO
			AND B.SABUN = C.SABUN
			AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
			AND C.TEAM = #{VENDOR_NAME}
		INNER JOIN (
			SELECT
				B.AUFNR, /* 오더번호 */
				A.KOSTL, /* 코스트센터 */
				/* 2021-03-29 jamerl - 최승빈 : 소수점 두자리 반올림 한 값을 SUM 하여 사용하도록 의사결정 */
				SUM( ROUND( ( CAST( B.W_END_DATE AS DATE ) - CAST( B.W_START_DATE AS DATE ) ), 2 ) * 24 / 8 ) AS MHOUR /* 공수 */
			FROM TBL_WK_ACCESS B
			LEFT OUTER JOIN TBL_WK A
				ON A.AUFNR = B.AUFNR
			INNER JOIN T_SECOM_PERSON C
				ON B.CARD_NO = C.CARDNO
				AND B.SABUN = C.SABUN
				AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
				AND C.TEAM = #{VENDOR_NAME}
			WHERE 1=1
			AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
			AND B.W_END_DATE IS NOT NULL
--			AND A.WORK_STATUS = '2' /* 작업완료 */ /* 2022-01-03 jamerl - 최승빈 : 조건에서 제거 */
			GROUP BY
				B.AUFNR, A.KOSTL
		) D
			ON B.AUFNR = D.AUFNR
			AND NVL( A.KOSTL, '-' ) = NVL( D.KOSTL, '-' ) /* TBL_WK에 코스트센터코드가 NULL인 경우 조인걸 수 있도록 변경 */
		WHERE 1=1
		AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
		AND B.W_END_DATE IS NOT NULL
--		AND A.WORK_STATUS = '2' /* 작업완료 */ /* 2022-01-03 jamerl - 최승빈 : 조건에서 제거 */
		GROUP BY B.AUFNR, A.KOSTL
	UNION ALL
		SELECT
			  'Y' AS DBYN, RELEASE_YN AS RELEASE_YN
			, CONTRACT_CODE
			, VENDOR_CODE
			, ORDER_NUMBER
			, WORK_CONTENTS
			, COST_CODE
			, COST_NAME
			, WORK_DT
			, WORK_START_DT
			, WORK_START_TIME
			, WORK_END_DT
			, WORK_END_TIME
			, MANHOUR
			, MANHOUR_CORRECTION
			, MANHOUR_SUM
			, MEMO
			, DATA_TYPE
			, CONFIRM_YN
			, CONFIRM_EMP
			, TO_CHAR( CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
			, APRV_YN
			, APRV_EMP
			, TO_CHAR( APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
		FROM TBL_CONST_DAILY_RPT2_TAG Y
		WHERE 1=1
		AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
		AND Y.VENDOR_CODE = #{VENDOR_CODE}
		AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
	) A
) M
WHERE 1=1
AND M.RK = 1 /* 저장데이터 우선 출력 */
</select>

<select id="select_zcs_ipt2_daily_rpt2" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_rpt2 */
SELECT
	  ROW_NUMBER() OVER(ORDER BY M.DATA_TYPE, M.WORK_START_TIME DESC, M.ORDER_NUMBER, M.COST_CODE ) AS RN
	, M.DBYN, M.RELEASE_YN
	, M.CONTRACT_CODE
	, M.VENDOR_CODE
	, M.ORDER_NUMBER
	, M.WORK_DT
	, M.DATA_TYPE
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, M.WORK_CONTENTS
	, M.COST_CODE
	, M.COST_NAME
	, M.WORK_START_TIME
	, M.WORK_END_TIME
	, M.QTY
	, M.CONFIRM_YN
	, M.CONFIRM_EMP
	, M.CONFIRM_DT
	, M.APRV_YN
	, M.APRV_EMP
	, M.APRV_DT
FROM (
	SELECT
		  RANK() OVER(PARTITION BY A.CONTRACT_CODE, A.VENDOR_CODE, A.ORDER_NUMBER ORDER BY A.DBYN DESC) AS RK  /* 저장데이터 우선순위 */
		, A.*
	FROM (
		SELECT
			  'Y' AS DBYN, RELEASE_YN AS RELEASE_YN
			, CONTRACT_CODE
			, VENDOR_CODE
			, ORDER_NUMBER
			, WORK_CONTENTS
			, COST_CODE
			, COST_NAME
			, WORK_DT
			, WORK_START_TIME
			, WORK_END_TIME
			, QTY
			, DATA_TYPE
			, CONFIRM_YN
			, CONFIRM_EMP
			, TO_CHAR( CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
			, APRV_YN
			, APRV_EMP
			, TO_CHAR( APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
		FROM TBL_CONST_DAILY_RPT2 Y
		WHERE 1=1
		AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
		AND Y.VENDOR_CODE = #{VENDOR_CODE}
		AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
	) A
) M
WHERE 1=1
AND M.RK = 1 /* 저장데이터 우선 출력 */
</select>

<select id="select_tbl_construction_subc_emp_cost" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_tbl_construction_subc_emp_cost */
SELECT
	A.CONTENTS
FROM TBL_CONSTRUCTION_SUBC_EMP_COST A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
ORDER BY A.SEQ
</select>

<delete id="delete_zcs_ipt2_daily_rpt2">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_daily_rpt2 */
DELETE FROM TBL_CONST_DAILY_RPT2 A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</delete>

<delete id="delete_zcs_ipt2_daily_rpt2_tag">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_daily_rpt2_tag */
DELETE FROM TBL_CONST_DAILY_RPT2_TAG A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</delete>

<update id="merge_zcs_ipt2_daily_rpt2">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_daily_rpt2 */
MERGE INTO TBL_CONST_DAILY_RPT2 A USING (
	SELECT
		  #{CONTRACT_CODE} AS CONTRACT_CODE
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_DT} AS WORK_DT
		, #{DATA_TYPE} AS DATA_TYPE
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, #{QTY} AS QTY
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.ORDER_NUMBER = B.ORDER_NUMBER
	AND A.WORK_DT = B.WORK_DT
	AND A.DATA_TYPE = B.DATA_TYPE
)
WHEN NOT MATCHED THEN
INSERT (
	  CONTRACT_CODE
	, VENDOR_CODE
	, ORDER_NUMBER
	, WORK_DT
	, DATA_TYPE
	, WORK_CONTENTS
	, WORK_START_TIME
	, WORK_END_TIME
	, COST_CODE
	, COST_NAME
	, QTY
	, REG_EMP
	, REG_DATE
) VALUES (
	  B.CONTRACT_CODE
	, B.VENDOR_CODE
	, B.ORDER_NUMBER
	, B.WORK_DT
	, B.DATA_TYPE
	, B.WORK_CONTENTS
	, B.WORK_START_TIME
	, B.WORK_END_TIME
	, B.COST_CODE
	, B.COST_NAME
	, B.QTY
	, B.REG_EMP
	, B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	  UPD_EMP = B.UPD_EMP
	, UPD_DATE = B.UPD_DATE
	, QTY = B.QTY
	, WORK_CONTENTS = B.WORK_CONTENTS
	, WORK_START_TIME = B.WORK_START_TIME
	, WORK_END_TIME = B.WORK_END_TIME
</update>

<update id="merge_zcs_ipt2_daily_rpt2_tag">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_daily_rpt2_tag */
MERGE INTO TBL_CONST_DAILY_RPT2_TAG A USING (
	SELECT
		  #{CONTRACT_CODE} AS CONTRACT_CODE
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_DT} AS WORK_DT
		, #{DATA_TYPE} AS DATA_TYPE
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, #{WORK_START_DT} AS WORK_START_DT
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_DT} AS WORK_END_DT
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{MANHOUR} AS MANHOUR
		, #{MANHOUR_CORRECTION} AS MANHOUR_CORRECTION
		, #{MANHOUR_SUM} AS MANHOUR_SUM
		, #{MEMO} AS MEMO
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.ORDER_NUMBER = B.ORDER_NUMBER
	AND A.WORK_DT = B.WORK_DT
	AND A.DATA_TYPE = B.DATA_TYPE
)
WHEN NOT MATCHED THEN
INSERT (
	  CONTRACT_CODE
	, VENDOR_CODE
	, ORDER_NUMBER
	, WORK_DT
	, DATA_TYPE
	, WORK_CONTENTS
	, COST_CODE
	, COST_NAME
	, WORK_START_DT
	, WORK_START_TIME
	, WORK_END_DT
	, WORK_END_TIME
	, MANHOUR
	, MANHOUR_CORRECTION
	, MANHOUR_SUM
	, MEMO
	, REG_EMP
	, REG_DATE
) VALUES (
	  B.CONTRACT_CODE
	, B.VENDOR_CODE
	, B.ORDER_NUMBER
	, B.WORK_DT
	, B.DATA_TYPE
	, B.WORK_CONTENTS
	, B.COST_CODE
	, B.COST_NAME
	, B.WORK_START_DT
	, B.WORK_START_TIME
	, B.WORK_END_DT
	, B.WORK_END_TIME
	, B.MANHOUR
	, B.MANHOUR_CORRECTION
	, B.MANHOUR_SUM
	, B.MEMO
	, B.REG_EMP
	, B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	  UPD_EMP = B.UPD_EMP
	, UPD_DATE = B.UPD_DATE
	, MANHOUR = B.MANHOUR
	, MANHOUR_CORRECTION = B.MANHOUR_CORRECTION
	, MANHOUR_SUM = B.MANHOUR_SUM
	, MEMO = B.MEMO
<if test='"M".equalsIgnoreCase( DATA_TYPE )'>
	, WORK_START_TIME = B.WORK_START_TIME
	, WORK_END_TIME = B.WORK_END_TIME
</if>
</update>

<select id="pre_select_zcs_ipt2_daily_rpt2" resultType="integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_daily_rpt2 */
SELECT COUNT(*)
FROM TBL_CONST_DAILY_RPT2 A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.APRV_YN = 'Y'
</select>

<select id="pre_select_zcs_ipt2_daily_rpt2_tag" resultType="integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_daily_rpt2_tag */
SELECT COUNT(*)
FROM TBL_CONST_DAILY_RPT2_TAG A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.APRV_YN = 'Y'
</select>

<update id="update_confirm_zcs_ipt2_daily_rpt2">
/* oracle.yp_zcs_ipt2.update_confirm_zcs_ipt2_daily_rpt2 */
UPDATE TBL_CONST_DAILY_RPT2 A SET
	  A.CONFIRM_YN = 'Y'
	, A.CONFIRM_EMP = #{s_emp_code}
	, A.CONFIRM_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="update_cancel_zcs_ipt2_daily_rpt2">
/* oracle.yp_zcs_ipt2.update_cancel_zcs_ipt2_daily_rpt2 */
UPDATE TBL_CONST_DAILY_RPT2 A SET
	  A.CONFIRM_YN = 'N'
	, A.CONFIRM_EMP = NULL
	, A.CONFIRM_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="update_confirm_zcs_ipt2_daily_rpt2_tag">
/* oracle.yp_zcs_ipt2.update_confirm_zcs_ipt2_daily_rpt2_tag */
UPDATE TBL_CONST_DAILY_RPT2_TAG A SET
	  A.CONFIRM_YN = 'Y'
	, A.CONFIRM_EMP = #{s_emp_code}
	, A.CONFIRM_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="update_cancel_zcs_ipt2_daily_rpt2_tag">
/* oracle.yp_zcs_ipt2.update_cancel_zcs_ipt2_daily_rpt2_tag */
UPDATE TBL_CONST_DAILY_RPT2_TAG A SET
	  A.CONFIRM_YN = 'N'
	, A.CONFIRM_EMP = NULL
	, A.CONFIRM_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<select id="select_zcs_ipt2_daily_aprv2" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_aprv2 */
SELECT
	  ROW_NUMBER() OVER(ORDER BY Y.DATA_TYPE, Y.WORK_START_DT DESC, Y.ORDER_NUMBER, Y.COST_CODE ) AS RN
	, Y.CONTRACT_CODE, Y.RELEASE_YN
	, Y.VENDOR_CODE
	, Y.ORDER_NUMBER
	, Y.WORK_CONTENTS
	, Y.COST_CODE
	, Y.COST_NAME
	, Y.WORK_DT
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, Y.QTY
	, Y.WORK_START_TIME
	, Y.WORK_END_TIME
	, Y.DATA_TYPE
	, Y.CONFIRM_YN
	, Y.CONFIRM_EMP
	, TO_CHAR( Y.CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
	, Y.APRV_YN
	, Y.APRV_EMP
	, TO_CHAR( Y.APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
FROM TBL_CONST_DAILY_RPT2 Y
WHERE 1=1
AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
AND Y.VENDOR_CODE = #{VENDOR_CODE}
AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
AND Y.CONFIRM_YN = 'Y' /* 확정데이터 */
</select>

<select id="select_zcs_ipt2_daily_aprv2_tag" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_aprv2_tag */
SELECT
	  ROW_NUMBER() OVER(ORDER BY Y.DATA_TYPE, Y.WORK_START_DT DESC, Y.ORDER_NUMBER, Y.COST_CODE ) AS RN
	, Y.CONTRACT_CODE, Y.RELEASE_YN
	, Y.VENDOR_CODE
	, Y.ORDER_NUMBER
	, Y.WORK_CONTENTS
	, Y.COST_CODE
	, Y.COST_NAME
	, Y.WORK_DT
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, Y.WORK_START_DT
	, Y.WORK_START_TIME
	, Y.WORK_END_DT
	, Y.WORK_END_TIME
	, Y.MANHOUR
	, Y.MANHOUR_CORRECTION
	, Y.MANHOUR_SUM
	, Y.MEMO
	, Y.DATA_TYPE
	, Y.CONFIRM_YN
	, Y.CONFIRM_EMP
	, TO_CHAR( Y.CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
	, Y.APRV_YN
	, Y.APRV_EMP
	, TO_CHAR( Y.APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
FROM TBL_CONST_DAILY_RPT2_TAG Y
WHERE 1=1
AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
AND Y.VENDOR_CODE = #{VENDOR_CODE}
AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
AND Y.CONFIRM_YN = 'Y' /* 확정데이터 */
</select>

<update id="update_aprv_zcs_ipt2_daily_aprv2">
/* oracle.yp_zcs_ipt2.update_aprv_zcs_ipt2_daily_aprv2 */
UPDATE TBL_CONST_DAILY_RPT2 A SET
	  A.APRV_YN = 'Y'
	, A.APRV_EMP = #{s_emp_code}
	, A.APRV_DT = SYSDATE
	, A.QTY = #{QTY}
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="update_aprv_zcs_ipt2_daily_aprv2_tag">
/* oracle.yp_zcs_ipt2.update_aprv_zcs_ipt2_daily_aprv2_tag */
UPDATE TBL_CONST_DAILY_RPT2_TAG A SET
	  A.APRV_YN = 'Y'
	, A.APRV_EMP = #{s_emp_code}
	, A.APRV_DT = SYSDATE
	, A.MANHOUR = #{MANHOUR}
	, A.MANHOUR_CORRECTION = #{MANHOUR_CORRECTION}
	, A.MANHOUR_SUM = #{MANHOUR_SUM}
	, A.MEMO = #{MEMO}
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="update_reject_zcs_ipt2_daily_aprv2">
/* oracle.yp_zcs_ipt2.update_reject_zcs_ipt2_daily_aprv2 */
UPDATE TBL_CONST_DAILY_RPT2 A SET
	  A.APRV_YN = 'N'
	, A.APRV_EMP = NULL
	, A.APRV_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="update_reject_zcs_ipt2_daily_aprv2_tag">
/* oracle.yp_zcs_ipt2.update_reject_zcs_ipt2_daily_aprv2_tag */
UPDATE TBL_CONST_DAILY_RPT2_TAG A SET
	  A.APRV_YN = 'N'
	, A.APRV_EMP = NULL
	, A.APRV_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="lock_zcs_ipt2_daily_aprv2">
/* oracle.yp_zcs_ipt2.lock_zcs_ipt2_daily_aprv2 */
UPDATE TBL_CONST_DAILY_RPT2 A SET
	  A.RELEASE_YN = 'N'
	, A.RELEASE_EMP = NULL
	, A.RELEASE_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="release_zcs_ipt2_daily_aprv2">
/* oracle.yp_zcs_ipt2.release_zcs_ipt2_daily_aprv2 */
UPDATE TBL_CONST_DAILY_RPT2 A SET
	  A.RELEASE_YN = 'Y'
	, A.RELEASE_EMP = #{s_emp_code}
	, A.RELEASE_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="lock_zcs_ipt2_daily_aprv2_tag">
/* oracle.yp_zcs_ipt2.lock_zcs_ipt2_daily_aprv2_tag */
UPDATE TBL_CONST_DAILY_RPT2_TAG A SET
	  A.RELEASE_YN = 'N'
	, A.RELEASE_EMP = NULL
	, A.RELEASE_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="release_zcs_ipt2_daily_aprv2_tag">
/* oracle.yp_zcs_ipt2.release_zcs_ipt2_daily_aprv2_tag */
UPDATE TBL_CONST_DAILY_RPT2_TAG A SET
	  A.RELEASE_YN = 'Y'
	, A.RELEASE_EMP = #{s_emp_code}
	, A.RELEASE_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<select id="select_zcs_ipt2_daily_rpt3" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_rpt3 */
SELECT
	  ROW_NUMBER() OVER(ORDER BY M.DATA_TYPE, M.WORK_START_DT DESC, M.ORDER_NUMBER, M.COST_CODE ) AS RN
	, M.DBYN, M.RELEASE_YN
	, M.CONTRACT_CODE
	, M.VENDOR_CODE
	, M.ORDER_NUMBER
	, M.WORK_DT
	, M.DATA_TYPE
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( M.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, M.WORK_CONTENTS
	, M.COST_CODE
	, M.COST_NAME
	, M.WORK_START_DT
	, M.WORK_START_TIME
	, M.WORK_END_DT
	, M.WORK_END_TIME
	, M.MANHOUR
	, M.MANHOUR_CORRECTION
	, M.MANHOUR_SUM
	, M.MEMO
	, M.CONFIRM_YN
	, M.CONFIRM_EMP
	, M.CONFIRM_DT
	, M.APRV_YN
	, M.APRV_EMP
	, M.APRV_DT
FROM (
	SELECT
		  RANK() OVER(PARTITION BY A.CONTRACT_CODE, A.VENDOR_CODE, A.ORDER_NUMBER ORDER BY A.DBYN DESC) AS RK  /* 저장데이터 우선순위 */
		, A.*
	FROM (
		SELECT
			  'N' AS DBYN, 'N' AS RELEASE_YN
			, #{CONTRACT_CODE} AS CONTRACT_CODE
			, #{VENDOR_CODE} AS VENDOR_CODE
			, TO_CHAR( B.AUFNR ) AS ORDER_NUMBER /* 오더번호 */
			, NVL( MAX( A.AUFTEXT ), '돌발작업' ) AS WORK_CONTENTS /* 작업내역 */
			, A.KOSTL AS COST_CODE /* 코스트센터 */
			, MAX( A.KTEXT ) AS COST_NAME /* 코스트센터명 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'YYYYMMDD' ) AS WORK_DT /* 작업일 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'YYYY/MM/DD' ) AS WORK_START_DT /* 시작일자 */
			, TO_CHAR( MIN( B.W_START_DATE ), 'HH24:MI:SS' ) AS WORK_START_TIME /* 시작시간 */
			, TO_CHAR( MAX( B.W_END_DATE ), 'YYYY/MM/DD' ) AS WORK_END_DT /* 종료일자 */
			, TO_CHAR( MAX( B.W_END_DATE ), 'HH24:MI:SS' ) AS WORK_END_TIME /* 종료시간 */
			, CASE
				WHEN COUNT( D.MHOUR ) = 0 THEN 0
				ELSE TRUNC( SUM( NVL( D.MHOUR, 0 ) ) / COUNT( D.MHOUR ), 2 )
			END AS MANHOUR /* 공수 */
			, 0 AS MANHOUR_CORRECTION /* 보정 */
			, CASE
				WHEN COUNT( D.MHOUR ) = 0 THEN 0
				ELSE TRUNC( SUM( NVL( D.MHOUR, 0 ) ) / COUNT( D.MHOUR ), 2 )
			END AS MANHOUR_SUM /* 공수합계 */
			, '' AS MEMO /* 비고 */
			, 'A' AS DATA_TYPE
			, 'N' AS CONFIRM_YN
			, NULL AS CONFIRM_EMP
			, NULL AS CONFIRM_DT
			, 'N' AS APRV_YN
			, NULL AS APRV_EMP
			, NULL AS APRV_DT
		FROM TBL_WK_ACCESS B
		LEFT OUTER JOIN TBL_WK A
			ON A.AUFNR = B.AUFNR
		INNER JOIN T_SECOM_PERSON C
			ON B.CARD_NO = C.CARDNO
			AND B.SABUN = C.SABUN
			AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
			AND C.TEAM = #{VENDOR_NAME}
		INNER JOIN (
			SELECT
				B.AUFNR, /* 오더번호 */
				A.KOSTL, /* 코스트센터 */
				/* 2021-03-29 jamerl - 최승빈 : 소수점 두자리 반올림 한 값을 SUM 하여 사용하도록 의사결정 */
				SUM( ROUND( ( CAST( B.W_END_DATE AS DATE ) - CAST( B.W_START_DATE AS DATE ) ), 2 ) * 24 / 8 ) AS MHOUR /* 공수 */
			FROM TBL_WK_ACCESS B
			LEFT OUTER JOIN TBL_WK A
				ON A.AUFNR = B.AUFNR
			INNER JOIN T_SECOM_PERSON C
				ON B.CARD_NO = C.CARDNO
				AND B.SABUN = C.SABUN
				AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
				AND C.TEAM = #{VENDOR_NAME}
			WHERE 1=1
			AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
			AND B.W_END_DATE IS NOT NULL
--			AND A.WORK_STATUS = '2' /* 작업완료 */ /* 2022-01-03 jamerl - 최승빈 : 조건에서 제거 */
			GROUP BY
				B.AUFNR, A.KOSTL
		) D
			ON B.AUFNR = D.AUFNR
			AND NVL( A.KOSTL, '-' ) = NVL( D.KOSTL, '-' ) /* TBL_WK에 코스트센터코드가 NULL인 경우 조인걸 수 있도록 변경 */
		WHERE 1=1
		AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
		AND B.W_END_DATE IS NOT NULL
--		AND A.WORK_STATUS = '2' /* 작업완료 */ /* 2022-01-03 jamerl - 최승빈 : 조건에서 제거 */
		GROUP BY B.AUFNR, A.KOSTL
	UNION ALL
		SELECT
			  'Y' AS DBYN, RELEASE_YN AS RELEASE_YN
			, CONTRACT_CODE
			, VENDOR_CODE
			, ORDER_NUMBER
			, WORK_CONTENTS
			, COST_CODE
			, COST_NAME
			, WORK_DT
			, WORK_START_DT
			, WORK_START_TIME
			, WORK_END_DT
			, WORK_END_TIME
			, MANHOUR
			, MANHOUR_CORRECTION
			, MANHOUR_SUM
			, MEMO
			, DATA_TYPE
			, CONFIRM_YN
			, CONFIRM_EMP
			, TO_CHAR( CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
			, APRV_YN
			, APRV_EMP
			, TO_CHAR( APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
		FROM TBL_CONST_DAILY_RPT3 Y
		WHERE 1=1
		AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
		AND Y.VENDOR_CODE = #{VENDOR_CODE}
		AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
	) A
) M
WHERE 1=1
AND M.RK = 1 /* 저장데이터 우선 출력 */
</select>

<delete id="delete_zcs_ipt2_daily_rpt3">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_daily_rpt3 */
DELETE FROM TBL_CONST_DAILY_RPT3 A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</delete>

<update id="merge_zcs_ipt2_daily_rpt3">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_daily_rpt3 */
MERGE INTO TBL_CONST_DAILY_RPT3 A USING (
	SELECT
		  #{CONTRACT_CODE} AS CONTRACT_CODE
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_DT} AS WORK_DT
		, #{DATA_TYPE} AS DATA_TYPE
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, #{WORK_START_DT} AS WORK_START_DT
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_DT} AS WORK_END_DT
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{MANHOUR} AS MANHOUR
		, #{MANHOUR_CORRECTION} AS MANHOUR_CORRECTION
		, #{MANHOUR_SUM} AS MANHOUR_SUM
		, #{MEMO} AS MEMO
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.ORDER_NUMBER = B.ORDER_NUMBER
	AND A.WORK_DT = B.WORK_DT
	AND A.DATA_TYPE = B.DATA_TYPE
)
WHEN NOT MATCHED THEN
INSERT (
	  CONTRACT_CODE
	, VENDOR_CODE
	, ORDER_NUMBER
	, WORK_DT
	, DATA_TYPE
	, WORK_CONTENTS
	, COST_CODE
	, COST_NAME
	, WORK_START_DT
	, WORK_START_TIME
	, WORK_END_DT
	, WORK_END_TIME
	, MANHOUR
	, MANHOUR_CORRECTION
	, MANHOUR_SUM
	, MEMO
	, REG_EMP
	, REG_DATE
) VALUES (
	  B.CONTRACT_CODE
	, B.VENDOR_CODE
	, B.ORDER_NUMBER
	, B.WORK_DT
	, B.DATA_TYPE
	, B.WORK_CONTENTS
	, B.COST_CODE
	, B.COST_NAME
	, B.WORK_START_DT
	, B.WORK_START_TIME
	, B.WORK_END_DT
	, B.WORK_END_TIME
	, B.MANHOUR
	, B.MANHOUR_CORRECTION
	, B.MANHOUR_SUM
	, B.MEMO
	, B.REG_EMP
	, B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	  UPD_EMP = B.UPD_EMP
	, UPD_DATE = B.UPD_DATE
	, MANHOUR = B.MANHOUR
	, MANHOUR_CORRECTION = B.MANHOUR_CORRECTION
	, MANHOUR_SUM = B.MANHOUR_SUM
	, MEMO = B.MEMO
<if test='"M".equalsIgnoreCase( DATA_TYPE )'>
	, WORK_START_TIME = B.WORK_START_TIME
	, WORK_END_TIME = B.WORK_END_TIME
</if>
</update>

<select id="pre_select_zcs_ipt2_daily_rpt3" resultType="integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_daily_rpt3 */
SELECT COUNT(*)
FROM TBL_CONST_DAILY_RPT3 A
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.APRV_YN = 'Y'
</select>

<update id="update_confirm_zcs_ipt2_daily_rpt3">
/* oracle.yp_zcs_ipt2.update_confirm_zcs_ipt2_daily_rpt3 */
UPDATE TBL_CONST_DAILY_RPT3 A SET
	  A.CONFIRM_YN = 'Y'
	, A.CONFIRM_EMP = #{s_emp_code}
	, A.CONFIRM_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="update_cancel_zcs_ipt2_daily_rpt3">
/* oracle.yp_zcs_ipt2.update_cancel_zcs_ipt2_daily_rpt3 */
UPDATE TBL_CONST_DAILY_RPT3 A SET
	  A.CONFIRM_YN = 'N'
	, A.CONFIRM_EMP = NULL
	, A.CONFIRM_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<select id="select_zcs_ipt2_daily_aprv3" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_daily_aprv3 */
SELECT
	  ROW_NUMBER() OVER(ORDER BY Y.DATA_TYPE, Y.WORK_START_DT DESC, Y.ORDER_NUMBER, Y.COST_CODE ) AS RN
	, Y.CONTRACT_CODE, Y.RELEASE_YN
	, Y.VENDOR_CODE
	, Y.ORDER_NUMBER
	, Y.WORK_CONTENTS
	, Y.COST_CODE
	, Y.COST_NAME
	, Y.WORK_DT
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( Y.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, Y.WORK_START_DT
	, Y.WORK_START_TIME
	, Y.WORK_END_DT
	, Y.WORK_END_TIME
	, Y.MANHOUR
	, Y.MANHOUR_CORRECTION
	, Y.MANHOUR_SUM
	, Y.MEMO
	, Y.DATA_TYPE
	, Y.CONFIRM_YN
	, Y.CONFIRM_EMP
	, TO_CHAR( Y.CONFIRM_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS CONFIRM_DT
	, Y.APRV_YN
	, Y.APRV_EMP
	, TO_CHAR( Y.APRV_DT, 'YYYY/MM/DD HH24:MI:SS' ) AS APRV_DT
FROM TBL_CONST_DAILY_RPT3 Y
WHERE 1=1
AND Y.CONTRACT_CODE = #{CONTRACT_CODE}
AND Y.VENDOR_CODE = #{VENDOR_CODE}
AND Y.WORK_DT = REPLACE( #{WORK_DT}, '/', '' )
AND Y.CONFIRM_YN = 'Y' /* 확정데이터 */
</select>

<update id="update_aprv_zcs_ipt2_daily_aprv3">
/* oracle.yp_zcs_ipt2.update_aprv_zcs_ipt2_daily_aprv3 */
UPDATE TBL_CONST_DAILY_RPT3 A SET
	  A.APRV_YN = 'Y'
	, A.APRV_EMP = #{s_emp_code}
	, A.APRV_DT = SYSDATE
	, A.MANHOUR = #{MANHOUR}
	, A.MANHOUR_CORRECTION = #{MANHOUR_CORRECTION}
	, A.MANHOUR_SUM = #{MANHOUR_SUM}
	, A.MEMO = #{MEMO}
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="update_reject_zcs_ipt2_daily_aprv3">
/* oracle.yp_zcs_ipt2.update_reject_zcs_ipt2_daily_aprv3 */
UPDATE TBL_CONST_DAILY_RPT3 A SET
	  A.APRV_YN = 'N'
	, A.APRV_EMP = NULL
	, A.APRV_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
AND A.CONFIRM_YN = 'Y' /* 확정데이터 */
</update>

<update id="lock_zcs_ipt2_daily_aprv3">
/* oracle.yp_zcs_ipt2.lock_zcs_ipt2_daily_aprv3 */
UPDATE TBL_CONST_DAILY_RPT3 A SET
	  A.RELEASE_YN = 'N'
	, A.RELEASE_EMP = NULL
	, A.RELEASE_DT = NULL
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<update id="release_zcs_ipt2_daily_aprv3">
/* oracle.yp_zcs_ipt2.release_zcs_ipt2_daily_aprv3 */
UPDATE TBL_CONST_DAILY_RPT3 A SET
	  A.RELEASE_YN = 'Y'
	, A.RELEASE_EMP = #{s_emp_code}
	, A.RELEASE_DT = SYSDATE
WHERE 1=1
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.ORDER_NUMBER = #{ORDER_NUMBER}
AND A.WORK_DT = #{WORK_DT}
AND A.DATA_TYPE = #{DATA_TYPE}
</update>

<select id="select_grid_daily_rpt_view" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_grid_daily_rpt_view */
SELECT X.*
FROM (
	SELECT
		  B.PAY_STANDARD
		, CASE B.PAY_STANDARD WHEN '1' THEN '공수' WHEN '2' THEN '작업' WHEN '3' THEN '월정액' ELSE '기타' END AS PAY_STANDARD_TXT
		, A.CONTRACT_CODE
		, B.CONTRACT_NAME
		, A.VENDOR_CODE
		, ( SELECT S.ENT_NAME FROM TBL_ENTERPRISE S WHERE S.VENDOR_CODE = A.VENDOR_CODE ) AS VENDOR_NAME
		, ( SELECT S.ENT_CODE FROM TBL_ENTERPRISE S WHERE S.VENDOR_CODE = A.VENDOR_CODE ) AS ENT_CODE
		, B.CONTRACT_PEOPLE_CNT
		, B.DAILY_REQ_PEOPLE_CNT
		, A.WORK_DT
		, TO_CHAR( TO_DATE( A.WORK_DT, 'YYYYMMDD' ), 'YYYY/MM/DD' ) AS WORK_DT_VIEW
		, CASE WHEN A.CNT = A.CNT_CONFIRM THEN '확정' ELSE '미확정' END CONFIRM_CHK
		, CASE WHEN A.CNT = A.CNT_APRV THEN '승인' ELSE '미승인' END APRV_CHK
		, A.CNT_CONFIRM
		, A.CNT_APRV
		, A.CNT
	FROM (
		SELECT
			  A.CONTRACT_CODE
			, A.VENDOR_CODE
			, A.WORK_DT
			, COUNT( DECODE( A.CONFIRM_YN, 'Y', 1 ) ) AS CNT_CONFIRM
			, COUNT( DECODE( A.APRV_YN, 'Y', 1 ) ) AS CNT_APRV
			, COUNT( * ) AS CNT
		FROM TBL_CONST_DAILY_RPT1 A
		WHERE 1=1
		AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '') AND REPLACE( #{WORK_DT_E}, '/', '')
		<if test="CONTRACT_CODE != null">
		AND A.CONTRACT_CODE = #{CONTRACT_CODE}
		</if>
		<if test="VENDOR_CODE != null">
		AND A.VENDOR_CODE = #{VENDOR_CODE}
		</if>
		GROUP BY A.CONTRACT_CODE, A.VENDOR_CODE, A.WORK_DT
		UNION ALL
		SELECT
			  A.CONTRACT_CODE
			, A.VENDOR_CODE
			, A.WORK_DT
			, COUNT( DECODE( A.CONFIRM_YN, 'Y', 1 ) ) AS CNT_CONFIRM
			, COUNT( DECODE( A.APRV_YN, 'Y', 1 ) ) AS CNT_APRV
			, COUNT( * ) AS CNT
		FROM TBL_CONST_DAILY_RPT2 A
		WHERE 1=1
		AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '') AND REPLACE( #{WORK_DT_E}, '/', '')
		<if test="CONTRACT_CODE != null">
		AND A.CONTRACT_CODE = #{CONTRACT_CODE}
		</if>
		<if test="VENDOR_CODE != null">
		AND A.VENDOR_CODE = #{VENDOR_CODE}
		</if>
		GROUP BY A.CONTRACT_CODE, A.VENDOR_CODE, A.WORK_DT
		UNION ALL
		SELECT
			  A.CONTRACT_CODE
			, A.VENDOR_CODE
			, A.WORK_DT
			, COUNT( DECODE( A.CONFIRM_YN, 'Y', 1 ) ) AS CNT_CONFIRM
			, COUNT( DECODE( A.APRV_YN, 'Y', 1 ) ) AS CNT_APRV
			, COUNT( * ) AS CNT
		FROM TBL_CONST_DAILY_RPT3 A
		WHERE 1=1
		AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '') AND REPLACE( #{WORK_DT_E}, '/', '')
		<if test="CONTRACT_CODE != null">
		AND A.CONTRACT_CODE = #{CONTRACT_CODE}
		</if>
		<if test="VENDOR_CODE != null">
		AND A.VENDOR_CODE = #{VENDOR_CODE}
		</if>
		GROUP BY A.CONTRACT_CODE, A.VENDOR_CODE, A.WORK_DT
	) A
	INNER JOIN TBL_CONSTRUCTION_SUBC B
		ON A.CONTRACT_CODE = B.CONTRACT_CODE
		AND A.VENDOR_CODE = B.VENDOR_CODE
		<if test="PAY_STANDARD != null">
		AND B.PAY_STANDARD = #{PAY_STANDARD}
		</if>
	WHERE 1=1
) X
WHERE 1=1
<if test="APRV_CHK != null">
AND X.APRV_CHK = #{APRV_CHK}
</if>
</select>

<select id="select_grid_daily_rpt_view_cnt" resultType="double">
/* oracle.yp_zcs_ipt2.select_grid_daily_rpt_view_cnt */
SELECT COUNT( * ) AS CNT
FROM (
	SELECT
		  B.PAY_STANDARD 
		, A.CONTRACT_CODE
		, B.CONTRACT_NAME
		, A.VENDOR_CODE
		, ( SELECT S.ENT_NAME FROM TBL_ENTERPRISE S WHERE S.VENDOR_CODE = A.VENDOR_CODE ) AS VENDOR_NAME
		, ( SELECT S.ENT_CODE FROM TBL_ENTERPRISE S WHERE S.VENDOR_CODE = A.VENDOR_CODE ) AS ENT_CODE
		, B.CONTRACT_PEOPLE_CNT
		, B.DAILY_REQ_PEOPLE_CNT
		, A.WORK_DT
		, TO_CHAR( TO_DATE( A.WORK_DT, 'YYYYMMDD' ), 'YYYY/MM/DD' ) AS WORK_DT_VIEW
		, CASE WHEN A.CNT = A.CNT_CONFIRM THEN '확정' ELSE '미확정' END CONFIRM_CHK
		, CASE WHEN A.CNT = A.CNT_APRV THEN '승인' ELSE '미승인' END APRV_CHK
		, A.CNT_CONFIRM
		, A.CNT_APRV
		, A.CNT
	FROM (
		SELECT
			  A.CONTRACT_CODE
			, A.VENDOR_CODE
			, A.WORK_DT
			, COUNT( DECODE( A.CONFIRM_YN, 'Y', 1 ) ) AS CNT_CONFIRM
			, COUNT( DECODE( A.APRV_YN, 'Y', 1 ) ) AS CNT_APRV
			, COUNT( * ) AS CNT
		FROM TBL_CONST_DAILY_RPT1 A
		WHERE 1=1
		AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '') AND REPLACE( #{WORK_DT_E}, '/', '')
		<if test="CONTRACT_CODE != null">
		AND A.CONTRACT_CODE = #{CONTRACT_CODE}
		</if>
		<if test="VENDOR_CODE != null">
		AND A.VENDOR_CODE = #{VENDOR_CODE}
		</if>
		GROUP BY A.CONTRACT_CODE, A.VENDOR_CODE, A.WORK_DT
		UNION ALL
		SELECT
			  A.CONTRACT_CODE
			, A.VENDOR_CODE
			, A.WORK_DT
			, COUNT( DECODE( A.CONFIRM_YN, 'Y', 1 ) ) AS CNT_CONFIRM
			, COUNT( DECODE( A.APRV_YN, 'Y', 1 ) ) AS CNT_APRV
			, COUNT( * ) AS CNT
		FROM TBL_CONST_DAILY_RPT2 A
		WHERE 1=1
		AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '') AND REPLACE( #{WORK_DT_E}, '/', '')
		<if test="CONTRACT_CODE != null">
		AND A.CONTRACT_CODE = #{CONTRACT_CODE}
		</if>
		<if test="VENDOR_CODE != null">
		AND A.VENDOR_CODE = #{VENDOR_CODE}
		</if>
		GROUP BY A.CONTRACT_CODE, A.VENDOR_CODE, A.WORK_DT
		UNION ALL
		SELECT
			  A.CONTRACT_CODE
			, A.VENDOR_CODE
			, A.WORK_DT
			, COUNT( DECODE( A.CONFIRM_YN, 'Y', 1 ) ) AS CNT_CONFIRM
			, COUNT( DECODE( A.APRV_YN, 'Y', 1 ) ) AS CNT_APRV
			, COUNT( * ) AS CNT
		FROM TBL_CONST_DAILY_RPT3 A
		WHERE 1=1
		AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '') AND REPLACE( #{WORK_DT_E}, '/', '')
		<if test="CONTRACT_CODE != null">
		AND A.CONTRACT_CODE = #{CONTRACT_CODE}
		</if>
		<if test="VENDOR_CODE != null">
		AND A.VENDOR_CODE = #{VENDOR_CODE}
		</if>
		GROUP BY A.CONTRACT_CODE, A.VENDOR_CODE, A.WORK_DT
	) A
	INNER JOIN TBL_CONSTRUCTION_SUBC B
		ON A.CONTRACT_CODE = B.CONTRACT_CODE
		AND A.VENDOR_CODE = B.VENDOR_CODE
		<if test="PAY_STANDARD != null">
		AND B.PAY_STANDARD = #{PAY_STANDARD}
		</if>
	WHERE 1=1
) X
WHERE 1=1
<if test="APRV_CHK != null">
AND X.APRV_CHK = #{APRV_CHK}
</if>
</select>

<select id="pre_select_zcs_ipt2_month_rpt1" resultType="Integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_month_rpt1 */
SELECT COUNT(*)
FROM TBL_CONSTRUCTION_MONTHLY_RPT1 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</select>

<select id="select_zcs_ipt2_month_rpt1" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt1 */
SELECT
	  ROW_NUMBER() OVER( ORDER BY TO_CHAR( TO_DATE( A.WORK_START_DT, 'YYYY/MM/DD' ), 'YYYY/MM/DD' ) DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'Y' AS DBYN
	, A.BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, A.SEQ
	, A.ORDER_NUMBER AS ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS AS WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE AS COST_CODE /* 코스트센터 */
	, A.COST_NAME AS COST_NAME /* 코스트센터명 */
	, TO_CHAR( TO_DATE( A.WORK_START_DT, 'YYYY/MM/DD' ), 'YYYY/MM/DD' ) AS WORK_START_DT /*시작일자 */
	, A.WORK_START_TIME AS WORK_START_TIME /*시작시간 */
	, TO_CHAR( TO_DATE( A.WORK_END_DT, 'YYYY/MM/DD' ), 'YYYY/MM/DD' ) AS WORK_END_DT /*종료일자 */
	, A.WORK_END_TIME AS WORK_END_TIME /*종료시간 */
	, A.MANHOUR AS MANHOUR /*공수 */
	, A.MANHOUR_CORRECTION AS MANHOUR_CORRECTION /*보정 */
	, A.MANHOUR_SUM AS MANHOUR_SUM /*공수합계 */
	, A.MEMO AS MEMO /* 비고 */
	, A.SECTION_START_DT /* 월보_작업시작일 */
	, A.SECTION_END_DT /* 월보_작업종료일 */
FROM TBL_CONSTRUCTION_MONTHLY_RPT1 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
-- AND REPLACE( A.WORK_START_DT, '/', '' ) BETWEEN REPLACE( '${WORK_DT_S}', '/', '' ) AND REPLACE( '${WORK_DT_E}', '/', '' ) /* 2021-04-19 jamerl - 최승빈 : 도급월보 데이터를 가져오는 경우는 작업 시작일자 조건 제외 */
</select>

<select id="select_zcs_ipt2_month_rpt1_new" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt1_new */
SELECT
	  ROW_NUMBER() OVER( ORDER BY A.WORK_DT DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'N' AS DBYN
	, REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, NULL AS SEQ
	, A.ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE /* 코스트센터 */
	, A.COST_NAME /* 코스트센터명 */
	, A.WORK_START_DT /* 시작일자 */
	, A.WORK_START_TIME /* 시작시간 */
	, A.WORK_END_DT /* 종료일자 */
	, A.WORK_END_TIME /* 종료시간 */
	, A.MANHOUR /* 공수 */
	, A.MANHOUR_CORRECTION /* 보정 */
	, A.MANHOUR_SUM /* 공수합계 */
	, A.MEMO /* 비고 */
	, #{WORK_DT_S} AS SECTION_START_DT /* 월보_작업시작일 */
	, #{WORK_DT_E} AS SECTION_END_DT /* 월보_작업종료일 */
FROM TBL_CONST_DAILY_RPT1 A
WHERE 1=1
AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '' ) AND REPLACE( #{WORK_DT_E}, '/', '' )
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.APRV_YN = 'Y' /* 승인 */
</select>

<select id="select_zcs_ipt2_month_rpt1_commute" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt1_commute */
SELECT
	A.COMMUTE AS COMMUTE,
	A.COMMUTE_CORRECTION AS COMMUTE_CORRECTION,
	A.COMMUTE_SUM AS COMMUTE_SUM,
	A.SUBTRACTION AS SUBTRACTION
FROM TBL_CONSTR_MONTHLY_RPT1_CMT A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</select>

<select id="select_zcs_ipt2_month_rpt1_commute_new" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt1_commute_new */
SELECT
	COUNT(A.SABUN) AS COMMUTE,
	0 AS COMMUTE_CORRECTION,
	COUNT(A.SABUN) AS COMMUTE_SUM
FROM TBL_ACCESS A
INNER JOIN T_SECOM_PERSON B
	ON A.SABUN = B.SABUN
	AND B.TEAM = #{VENDOR_NAME}
WHERE 1=1
AND A.A_START_DATE IS NOT NULL
AND A.A_START_DATE BETWEEN TO_DATE( REPLACE( #{WORK_DT_S}, '/', '' ) || '000000', 'YYYYMMDDHH24MISS' ) AND TO_DATE( REPLACE( #{WORK_DT_E}, '/', '' ) || '235959', 'YYYYMMDDHH24MISS' )
</select>

<delete id="delete_zcs_ipt2_month_rpt1">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_month_rpt1 */
DELETE FROM TBL_CONSTRUCTION_MONTHLY_RPT1 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</delete>

<delete id="delete_zcs_ipt2_month_rpt1_commute">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_month_rpt1_commute */
DELETE FROM TBL_CONSTR_MONTHLY_RPT1_CMT A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</delete>

<update id="merge_zcs_ipt2_month_rpt1">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_month_rpt1 */
MERGE INTO TBL_CONSTRUCTION_MONTHLY_RPT1 A
USING (
	SELECT
		  REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{CONTRACT_CODE} AS CONTRACT_CODE
		<choose>
			<when test='"Y".equalsIgnoreCase( DBYN )'>
		, #{SEQ} AS SEQ /* DB 데이터 */
			</when>
			<otherwise>
		, (
			SELECT NVL( MAX( SEQ + 1 ), 1 ) FROM TBL_CONSTRUCTION_MONTHLY_RPT1
			WHERE 1=1
			AND BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
			AND VENDOR_CODE = #{VENDOR_CODE}
			AND CONTRACT_CODE = #{CONTRACT_CODE}
		) AS SEQ /* 행추가 데이터 */
			</otherwise>
		</choose>
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, SUBSTR( REPLACE( #{WORK_START_DT}, '/', ''), 1, 4 ) AS YYYY
		, SUBSTR( REPLACE( #{WORK_START_DT}, '/', ''), 5, 2 ) AS MM
		, SUBSTR( REPLACE( #{WORK_START_DT}, '/', ''), 7, 2 ) AS DD
		, #{WORK_START_DT} AS WORK_START_DT
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_DT} AS WORK_END_DT
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{MANHOUR} AS MANHOUR
		, #{MANHOUR_CORRECTION} AS MANHOUR_CORRECTION
		, #{MANHOUR_SUM} AS MANHOUR_SUM
		, #{MEMO} AS MEMO
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
		, #{SECTION_START_DT} AS SECTION_START_DT
		, #{SECTION_END_DT} AS SECTION_END_DT
	FROM DUAL
) B
ON (
		A.BASE_YYYYMM = B.BASE_YYYYMM
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.SEQ = B.SEQ
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYYMM,
	VENDOR_CODE,
	CONTRACT_CODE,
	SEQ,
	ORDER_NUMBER,
	WORK_CONTENTS,
	COST_CODE,
	COST_NAME,
	YYYY,
	MM,
	DD,
	WORK_START_DT,
	WORK_START_TIME,
	WORK_END_DT,
	WORK_END_TIME,
	MANHOUR,
	MANHOUR_CORRECTION,
	MANHOUR_SUM,
	MEMO,
	REG_EMP,
	REG_DATE, SECTION_START_DT, SECTION_END_DT
) VALUES (
	B.BASE_YYYYMM,
	B.VENDOR_CODE,
	B.CONTRACT_CODE,
	B.SEQ,
	B.ORDER_NUMBER,
	B.WORK_CONTENTS,
	B.COST_CODE,
	B.COST_NAME,
	B.YYYY,
	B.MM,
	B.DD,
	B.WORK_START_DT,
	B.WORK_START_TIME,
	B.WORK_END_DT,
	B.WORK_END_TIME,
	B.MANHOUR,
	B.MANHOUR_CORRECTION,
	B.MANHOUR_SUM,
	B.MEMO,
	B.REG_EMP,
	B.REG_DATE, B.SECTION_START_DT, B.SECTION_END_DT
)
WHEN MATCHED THEN
UPDATE SET
	MANHOUR_CORRECTION = B.MANHOUR_CORRECTION,
	MANHOUR_SUM = B.MANHOUR_SUM,
	MEMO = B.MEMO,
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<update id="merge_zcs_ipt2_month_rpt1_commute">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_month_rpt1_commute */
MERGE INTO TBL_CONSTR_MONTHLY_RPT1_CMT A
USING (
	SELECT
		REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM,
		#{VENDOR_CODE} AS VENDOR_CODE,
		#{CONTRACT_CODE} AS CONTRACT_CODE,
		#{COMMUTE} AS COMMUTE,
		#{COMMUTE_CORRECTION} AS COMMUTE_CORRECTION,
		#{COMMUTE_SUM} AS COMMUTE_SUM,
		#{SUBTRACTION} AS SUBTRACTION,
		#{s_emp_code} AS REG_EMP,
		SYSDATE AS REG_DATE,
		#{s_emp_code} AS UPD_EMP,
		SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.BASE_YYYYMM = B.BASE_YYYYMM
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYYMM,
	VENDOR_CODE,
	CONTRACT_CODE,
	COMMUTE,
	COMMUTE_CORRECTION,
	COMMUTE_SUM,
	SUBTRACTION,
	REG_EMP,
	REG_DATE
) VALUES (
	B.BASE_YYYYMM,
	B.VENDOR_CODE,
	B.CONTRACT_CODE,
	B.COMMUTE,
	B.COMMUTE_CORRECTION,
	B.COMMUTE_SUM,
	B.SUBTRACTION,
	B.REG_EMP,
	B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	COMMUTE_CORRECTION = B.COMMUTE_CORRECTION,
	COMMUTE_SUM = B.COMMUTE_SUM,
	SUBTRACTION = B.SUBTRACTION,
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<select id="pre_select_zcs_ipt2_month_rpt2" resultType="Integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_month_rpt2 */
SELECT COUNT(*)
FROM TBL_CONSTRUCTION_MONTHLY_RPT2 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</select>

<select id="pre_select_zcs_ipt2_month_rpt2_tag" resultType="Integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_month_rpt2_tag */
SELECT COUNT(*)
FROM TBL_CONST_MONTHLY_RPT2_TAG A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</select>

<select id="select_zcs_ipt2_month_rpt2" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt2 */
SELECT
	  ROW_NUMBER() OVER( ORDER BY TO_CHAR( TO_DATE( A.YYYY || '/' || A.MM || '/' || A.DD, 'YYYY/MM/DD' ), 'YYYY/MM/DD' ) DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'Y' AS DBYN
	, A.BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, A.SEQ
	, A.YYYY AS VIEW_Y
	, A.MM AS VIEW_M
	, A.DD AS VIEW_D
	, A.YYYY || '/' || A.MM || '/' || A.DD AS WORK_DT /* 작업일자 */
	, A.WORK_START_TIME /* 시작시간 */
	, A.WORK_END_TIME /* 종료시간 */
	, A.ORDER_NUMBER AS ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS AS WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE AS COST_CODE /* 코스트센터 */
	, A.COST_NAME AS COST_NAME /* 코스트센터명 */
	, A.QTY /* 작업수량 */
	, A.SECTION_START_DT
	, A.SECTION_END_DT
FROM TBL_CONSTRUCTION_MONTHLY_RPT2 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
-- AND REPLACE( A.YYYY || '/' || A.MM || '/' || A.DD, '/', '' ) BETWEEN REPLACE( '${WORK_DT_S}', '/', '' ) AND REPLACE( '${WORK_DT_E}', '/', '' ) /* 2021-04-19 jamerl - 최승빈 : 도급월보 데이터를 가져오는 경우는 작업 시작일자 조건 제외 */
</select>

<select id="select_zcs_ipt2_month_rpt2_new" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt2_new */
SELECT
	  ROW_NUMBER() OVER( ORDER BY A.WORK_DT DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'N' AS DBYN
	, REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, NULL AS SEQ
	, TO_CHAR( TO_DATE( A.WORK_DT, 'YYYYMMDD' ), 'YYYY' ) AS VIEW_Y
	, TO_CHAR( TO_DATE( A.WORK_DT, 'YYYYMMDD' ), 'MM' ) AS VIEW_M
	, TO_CHAR( TO_DATE( A.WORK_DT, 'YYYYMMDD' ), 'DD' ) AS VIEW_D
	, A.WORK_DT /* 작업일자 */
	, A.WORK_START_TIME /* 시작시간 */
	, A.WORK_END_TIME /* 종료시간 */
	, A.ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE /* 코스트센터 */
	, A.COST_NAME /* 코스트센터명 */
	, A.QTY /* 작업수량 */
	, #{WORK_DT_S} AS SECTION_START_DT /* 월보_작업시작일 */
	, #{WORK_DT_E} AS SECTION_END_DT /* 월보_작업종료일 */
FROM TBL_CONST_DAILY_RPT2 A
WHERE 1=1
AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '' ) AND REPLACE( #{WORK_DT_E}, '/', '' )
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.APRV_YN = 'Y' /* 승인 */
</select>

<select id="select_zcs_ipt2_month_rpt2_tag" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt2_tag */
SELECT
	  ROW_NUMBER() OVER( ORDER BY A.WORK_DT DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'Y' AS DBYN
	, A.BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, A.SEQ
	, A.ORDER_NUMBER AS ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS AS WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE AS COST_CODE /* 코스트센터 */
	, A.COST_NAME AS COST_NAME /* 코스트센터명 */
	, SUBSTR( REPLACE( A.WORK_DT, '/', ''), 1, 4 ) AS YYYY
	, SUBSTR( REPLACE( A.WORK_DT, '/', ''), 5, 2 ) AS MM
	, SUBSTR( REPLACE( A.WORK_DT, '/', ''), 7, 2 ) AS DD
	, A.WORK_DT
	, A.WORK_START_DT AS WORK_START_DT /*시작일자 */
	, A.WORK_START_TIME AS WORK_START_TIME /*시작시간 */
	, A.WORK_END_DT AS WORK_END_DT /*종료일자 */
	, A.WORK_END_TIME AS WORK_END_TIME /*종료시간 */
	, A.MANHOUR AS MANHOUR /*공수 */
	, A.MANHOUR_CORRECTION AS MANHOUR_CORRECTION /*보정 */
	, A.MANHOUR_SUM AS MANHOUR_SUM /*공수합계 */
	, '' AS MEMO /* 비고 */
--	, A.MEMO AS MEMO /* 비고 */
FROM TBL_CONST_MONTHLY_RPT2_TAG A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
-- AND REPLACE( A.YYYY || '/' || A.MM || '/' || A.DD, '/', '' ) BETWEEN REPLACE( '${WORK_DT_S}', '/', '' ) AND REPLACE( '${WORK_DT_E}', '/', '' ) /* 2021-04-19 jamerl - 최승빈 : 도급월보 데이터를 가져오는 경우는 작업 시작일자 조건 제외 */
</select>

<select id="select_zcs_ipt2_month_rpt2_tag_new" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt2_tag_new */
SELECT
	  ROW_NUMBER() OVER( ORDER BY A.WORK_DT DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'N' AS DBYN
	, REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, NULL AS SEQ
	, A.ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE /* 코스트센터 */
	, A.COST_NAME /* 코스트센터명 */
	, SUBSTR( REPLACE( A.WORK_DT, '/', ''), 1, 4 ) AS YYYY
	, SUBSTR( REPLACE( A.WORK_DT, '/', ''), 5, 2 ) AS MM
	, SUBSTR( REPLACE( A.WORK_DT, '/', ''), 7, 2 ) AS DD
	, A.WORK_DT
	, A.WORK_START_DT /* 시작일자 */
	, A.WORK_START_TIME /* 시작시간 */
	, A.WORK_END_DT /* 종료일자 */
	, A.WORK_END_TIME /* 종료시간 */
	, A.MANHOUR /* 공수 */
	, A.MANHOUR_CORRECTION /* 보정 */
	, A.MANHOUR_SUM /* 공수합계 */
	, A.MEMO /* 비고 */
FROM TBL_CONST_DAILY_RPT2_TAG A
WHERE 1=1
AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '' ) AND REPLACE( #{WORK_DT_E}, '/', '' )
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.APRV_YN = 'Y' /* 승인 */
</select>

<delete id="delete_zcs_ipt2_month_rpt2">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_month_rpt2 */
DELETE FROM TBL_CONSTRUCTION_MONTHLY_RPT2 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</delete>

<delete id="delete_zcs_ipt2_month_rpt2_tag">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_month_rpt2_tag */
DELETE FROM TBL_CONST_MONTHLY_RPT2_TAG A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</delete>

<update id="merge_zcs_ipt2_month_rpt2">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_month_rpt2 */
MERGE INTO TBL_CONSTRUCTION_MONTHLY_RPT2 A
USING (
	SELECT
		  REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{CONTRACT_CODE} AS CONTRACT_CODE
		<choose>
			<when test='"Y".equalsIgnoreCase( DBYN )'>
		, #{SEQ} AS SEQ /* DB 데이터 */
			</when>
			<otherwise>
		, (
			SELECT NVL( MAX( SEQ + 1 ), 1 ) FROM TBL_CONSTRUCTION_MONTHLY_RPT2
			WHERE 1=1
			AND BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
			AND VENDOR_CODE = #{VENDOR_CODE}
			AND CONTRACT_CODE = #{CONTRACT_CODE}
		) AS SEQ /* 행추가 데이터 */
			</otherwise>
		</choose>
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, SUBSTR( REPLACE( #{WORK_DT}, '/', ''), 1, 4 ) AS YYYY
		, SUBSTR( REPLACE( #{WORK_DT}, '/', ''), 5, 2 ) AS MM
		, SUBSTR( REPLACE( #{WORK_DT}, '/', ''), 7, 2 ) AS DD
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{QTY} AS QTY
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
		, #{SECTION_START_DT} AS SECTION_START_DT
		, #{SECTION_END_DT} AS SECTION_END_DT
	FROM DUAL
) B
ON (
		A.BASE_YYYYMM = B.BASE_YYYYMM
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.SEQ = B.SEQ
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYYMM,
	VENDOR_CODE,
	CONTRACT_CODE,
	SEQ,
	ORDER_NUMBER,
	WORK_CONTENTS,
	COST_CODE,
	COST_NAME,
	YYYY,
	MM,
	DD,
	WORK_START_TIME,
	WORK_END_TIME,
	QTY,
	REG_EMP,
	REG_DATE, SECTION_START_DT, SECTION_END_DT
) VALUES (
	B.BASE_YYYYMM,
	B.VENDOR_CODE,
	B.CONTRACT_CODE,
	B.SEQ,
	B.ORDER_NUMBER,
	B.WORK_CONTENTS,
	B.COST_CODE,
	B.COST_NAME,
	B.YYYY,
	B.MM,
	B.DD,
	B.WORK_START_TIME,
	B.WORK_END_TIME,
	B.QTY,
	B.REG_EMP,
	B.REG_DATE, B.SECTION_START_DT, B.SECTION_END_DT
)
WHEN MATCHED THEN
UPDATE SET
	QTY = B.QTY,
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<update id="merge_zcs_ipt2_month_rpt2_tag">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_month_rpt2_tag */
MERGE INTO TBL_CONST_MONTHLY_RPT2_TAG A
USING (
	SELECT
		  REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{CONTRACT_CODE} AS CONTRACT_CODE
		<choose>
			<when test='"Y".equalsIgnoreCase( DBYN )'>
		, #{SEQ} AS SEQ /* DB 데이터 */
			</when>
			<otherwise>
		, (
			SELECT NVL( MAX( SEQ + 1 ), 1 ) FROM TBL_CONST_MONTHLY_RPT2_TAG
			WHERE 1=1
			AND BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
			AND VENDOR_CODE = #{VENDOR_CODE}
			AND CONTRACT_CODE = #{CONTRACT_CODE}
		) AS SEQ /* 행추가 데이터 */
			</otherwise>
		</choose>
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, #{WORK_DT} AS WORK_DT
		, #{WORK_START_DT} AS WORK_START_DT
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_DT} AS WORK_END_DT
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{MANHOUR} AS MANHOUR
		, #{MANHOUR_CORRECTION} AS MANHOUR_CORRECTION
		, #{MANHOUR_SUM} AS MANHOUR_SUM
		, #{MEMO} AS MEMO
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
	FROM DUAL
) B
ON (
		A.BASE_YYYYMM = B.BASE_YYYYMM
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.SEQ = B.SEQ
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYYMM,
	VENDOR_CODE,
	CONTRACT_CODE,
	SEQ,
	ORDER_NUMBER,
	WORK_CONTENTS,
	COST_CODE,
	COST_NAME,
	WORK_DT,
	WORK_START_DT,
	WORK_START_TIME,
	WORK_END_DT,
	WORK_END_TIME,
	MANHOUR,
	MANHOUR_CORRECTION,
	MANHOUR_SUM,
	REG_EMP,
	REG_DATE
) VALUES (
	B.BASE_YYYYMM,
	B.VENDOR_CODE,
	B.CONTRACT_CODE,
	B.SEQ,
	B.ORDER_NUMBER,
	B.WORK_CONTENTS,
	B.COST_CODE,
	B.COST_NAME,
	B.WORK_DT,
	B.WORK_START_DT,
	B.WORK_START_TIME,
	B.WORK_END_DT,
	B.WORK_END_TIME,
	B.MANHOUR, /* 공수 합계 */
	B.MANHOUR_CORRECTION, /* 공수 합계 */
	B.MANHOUR_SUM, /* 공수 합계 */
	B.REG_EMP,
	B.REG_DATE
)
WHEN MATCHED THEN
UPDATE SET
	MANHOUR = B.MANHOUR_SUM, /* 공수 합계 */
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<select id="pre_select_zcs_ipt2_month_rpt3" resultType="Integer">
/* oracle.yp_zcs_ipt2.pre_select_zcs_ipt2_month_rpt3 */
SELECT COUNT(*)
FROM TBL_CONSTRUCTION_MONTHLY_RPT3 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</select>

<select id="select_zcs_ipt2_month_rpt3" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt3 */
SELECT
	  ROW_NUMBER() OVER( ORDER BY TO_CHAR( TO_DATE( A.YYYY || '/' || A.MM || '/' || A.DD, 'YYYY/MM/DD' ), 'YYYY/MM/DD' ) DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'Y' AS DBYN
	, A.BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, A.SEQ
	, A.ORDER_NUMBER AS ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS AS WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE AS COST_CODE /* 코스트센터 */
	, A.COST_NAME AS COST_NAME /* 코스트센터명 */
	, A.YYYY || '/' || A.MM || '/' || A.DD AS WORK_START_DT /*시작일자 */
	, A.WORK_START_TIME AS WORK_START_TIME /*시작시간 */
	, A.YYYY || '/' || A.MM || '/' || A.DD AS WORK_END_DT /*종료일자 */
	, A.WORK_END_TIME AS WORK_END_TIME /*종료시간 */
	, A.MANHOUR_ORIGINAL AS MANHOUR /*공수 */
	, A.MANHOUR_CORRECTION AS MANHOUR_CORRECTION /*보정 */
	, A.MANHOUR AS MANHOUR_SUM /*공수합계 */
	, '' AS MEMO /* 비고 */
--	, A.MEMO AS MEMO /* 비고 */
	, A.SECTION_START_DT /* 월보_작업시작일 */
	, A.SECTION_END_DT /* 월보_작업종료일 */
FROM TBL_CONSTRUCTION_MONTHLY_RPT3 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '' )
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
-- AND REPLACE( A.YYYY || '/' || A.MM || '/' || A.DD, '/', '' ) BETWEEN REPLACE( '${WORK_DT_S}', '/', '' ) AND REPLACE( '${WORK_DT_E}', '/', '' ) /* 2021-04-19 jamerl - 최승빈 : 도급월보 데이터를 가져오는 경우는 작업 시작일자 조건 제외 */
</select>

<select id="select_zcs_ipt2_month_rpt3_new" resultType="HashMap">
/* oracle.yp_zcs_ipt2.select_zcs_ipt2_month_rpt3_new */
SELECT
	  ROW_NUMBER() OVER( ORDER BY A.WORK_DT DESC, A.ORDER_NUMBER, A.COST_CODE ) AS RN
	, 'N' AS DBYN
	, REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
	, A.VENDOR_CODE
	, A.CONTRACT_CODE
	, NULL AS SEQ
	, A.ORDER_NUMBER /* 오더번호 */
	, A.WORK_CONTENTS /* 작업내역 */
	, A.COST_CODE /* 코스트센터 */
	, A.COST_NAME /* 코스트센터명 */
	, A.WORK_START_DT /* 시작일자 */
	, A.WORK_START_TIME /* 시작시간 */
	, A.WORK_END_DT /* 종료일자 */
	, A.WORK_END_TIME /* 종료시간 */
	, A.MANHOUR /* 공수 */
	, A.MANHOUR_CORRECTION /* 보정 */
	, A.MANHOUR_SUM /* 공수합계 */
	, A.MEMO /* 비고 */
	, #{WORK_DT_S} AS SECTION_START_DT /* 월보_작업시작일 */
	, #{WORK_DT_E} AS SECTION_END_DT /* 월보_작업종료일 */
FROM TBL_CONST_DAILY_RPT3 A
WHERE 1=1
AND A.WORK_DT BETWEEN REPLACE( #{WORK_DT_S}, '/', '' ) AND REPLACE( #{WORK_DT_E}, '/', '' )
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.APRV_YN = 'Y' /* 승인 */
</select>

<delete id="delete_zcs_ipt2_month_rpt3">
/* oracle.yp_zcs_ipt2.delete_zcs_ipt2_month_rpt3 */
DELETE FROM TBL_CONSTRUCTION_MONTHLY_RPT3 A
WHERE 1=1
AND A.BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
AND A.VENDOR_CODE = #{VENDOR_CODE}
AND A.CONTRACT_CODE = #{CONTRACT_CODE}
</delete>

<update id="merge_zcs_ipt2_month_rpt3">
/* oracle.yp_zcs_ipt2.merge_zcs_ipt2_month_rpt3 */
MERGE INTO TBL_CONSTRUCTION_MONTHLY_RPT3 A
USING (
	SELECT
		  REPLACE( #{BASE_YYYYMM}, '/', '') AS BASE_YYYYMM
		, #{VENDOR_CODE} AS VENDOR_CODE
		, #{CONTRACT_CODE} AS CONTRACT_CODE
		<choose>
			<when test='"Y".equalsIgnoreCase( DBYN )'>
		, #{SEQ} AS SEQ /* DB 데이터 */
			</when>
			<otherwise>
		, (
			SELECT NVL( MAX( SEQ + 1 ), 1 ) FROM TBL_CONSTRUCTION_MONTHLY_RPT3
			WHERE 1=1
			AND BASE_YYYYMM = REPLACE( #{BASE_YYYYMM}, '/', '')
			AND VENDOR_CODE = #{VENDOR_CODE}
			AND CONTRACT_CODE = #{CONTRACT_CODE}
		) AS SEQ /* 행추가 데이터 */
			</otherwise>
		</choose>
		, #{ORDER_NUMBER} AS ORDER_NUMBER
		, #{WORK_CONTENTS} AS WORK_CONTENTS
		, #{COST_CODE} AS COST_CODE
		, #{COST_NAME} AS COST_NAME
		, SUBSTR( REPLACE( #{WORK_START_DT}, '/', ''), 1, 4 ) AS YYYY
		, SUBSTR( REPLACE( #{WORK_START_DT}, '/', ''), 5, 2 ) AS MM
		, SUBSTR( REPLACE( #{WORK_START_DT}, '/', ''), 7, 2 ) AS DD
		, #{WORK_START_DT} AS WORK_START_DT
		, #{WORK_START_TIME} AS WORK_START_TIME
		, #{WORK_END_DT} AS WORK_END_DT
		, #{WORK_END_TIME} AS WORK_END_TIME
		, #{MANHOUR} AS MANHOUR
		, #{MANHOUR_CORRECTION} AS MANHOUR_CORRECTION
		, #{MANHOUR_SUM} AS MANHOUR_SUM
		, #{MEMO} AS MEMO
		, #{s_emp_code} AS REG_EMP
		, SYSDATE AS REG_DATE
		, #{s_emp_code} AS UPD_EMP
		, SYSDATE AS UPD_DATE
		, #{SECTION_START_DT} AS SECTION_START_DT
		, #{SECTION_END_DT} AS SECTION_END_DT
	FROM DUAL
) B
ON (
		A.BASE_YYYYMM = B.BASE_YYYYMM
	AND A.VENDOR_CODE = B.VENDOR_CODE
	AND A.CONTRACT_CODE = B.CONTRACT_CODE
	AND A.SEQ = B.SEQ
)
WHEN NOT MATCHED THEN
INSERT (
	BASE_YYYYMM,
	VENDOR_CODE,
	CONTRACT_CODE,
	SEQ,
	ORDER_NUMBER,
	WORK_CONTENTS,
	COST_CODE,
	COST_NAME,
	YYYY,
	MM,
	DD,
	WORK_START_TIME,
	WORK_END_TIME,
	MANHOUR_ORIGINAL,
	MANHOUR_CORRECTION,
	MANHOUR,
	REG_EMP,
	REG_DATE, SECTION_START_DT, SECTION_END_DT
) VALUES (
	B.BASE_YYYYMM,
	B.VENDOR_CODE,
	B.CONTRACT_CODE,
	B.SEQ,
	B.ORDER_NUMBER,
	B.WORK_CONTENTS,
	B.COST_CODE,
	B.COST_NAME,
	B.YYYY,
	B.MM,
	B.DD,
	B.WORK_START_TIME,
	B.WORK_END_TIME,
	B.MANHOUR, /* 공수 합계 */
	B.MANHOUR_CORRECTION, /* 공수 합계 */
	B.MANHOUR_SUM, /* 공수 합계 */
	B.REG_EMP,
	B.REG_DATE, B.SECTION_START_DT, B.SECTION_END_DT
)
WHEN MATCHED THEN
UPDATE SET
	MANHOUR = B.MANHOUR_SUM, /* 공수 합계 */
	UPD_EMP = B.UPD_EMP,
	UPD_DATE = B.UPD_DATE
</update>

<update id="update_tbl_wk_access_aufnr_unexpected">
/* oracle.yp_zcs_ipt2.update_tbl_wk_access_aufnr_unexpected */
UPDATE TBL_WK_ACCESS A SET
	A.AUFNR = (
		SELECT #{ORDER_NUMBER}
		FROM TBL_WK_ACCESS B
		INNER JOIN T_SECOM_PERSON C
			ON B.CARD_NO = C.CARDNO
			AND B.SABUN = C.SABUN
			AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
			AND C.TEAM = #{VENDOR_NAME}
		WHERE 1=1
		AND B.AUFNR = #{OLD_ORDER_NUMBER}
		AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
		GROUP BY B.AUFNR
	)
WHERE EXISTS (
	SELECT 0
	FROM (
		SELECT
			  B.AUFNR
			, B.W_START_DATE
		FROM TBL_WK_ACCESS B
		INNER JOIN T_SECOM_PERSON C
			ON B.CARD_NO = C.CARDNO
			AND B.SABUN = C.SABUN
			AND C.CARDTYPE = '5' /* 정비용역 */ /* 운영반영시 주석해제 */
			AND C.TEAM = #{VENDOR_NAME}
		WHERE 1=1
		AND B.AUFNR = #{OLD_ORDER_NUMBER}
		AND TO_CHAR( B.W_START_DATE, 'YYYYMMDD') = REPLACE( #{WORK_DT}, '/', '' )
	) B
	WHERE A.AUFNR = B.AUFNR
	AND A.W_START_DATE = B.W_START_DATE
)
</update>

</mapper>